[2025-04-25T02:36:45.193Z] [Server Config] Loaded PORT: 3001
[2025-04-25T02:36:45.196Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T02:36:45.200Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T02:36:45.200Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T02:36:45.204Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T02:37:00.415Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T02:37:00.416Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T02:37:01.096Z] [Server Start] Initializing loaders...
[2025-04-25T02:37:01.096Z] [Loader] Starting application loading process...
[2025-04-25T02:37:01.096Z] [Loader DB] Attempting database connection...
[2025-04-25T02:37:01.097Z] [Database] Attempting MongoDB connection...
[2025-04-25T02:37:01.957Z] [Database] MongoDB Connected Successfully.
[2025-04-25T02:37:01.957Z] [Loader DB] Database connection successful.
[2025-04-25T02:37:01.957Z] [Loader] Database loaded.
[2025-04-25T02:37:01.958Z] [History Service] Initialized.
[2025-04-25T02:37:01.958Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T02:37:01.958Z] [Loader] Services initialized.
[2025-04-25T02:37:01.964Z] [Express] Mounted API routes at /api
[2025-04-25T02:37:01.964Z] [Express] Registered Not Found handler.
[2025-04-25T02:37:01.964Z] [Express] Registered Global Error handler.
[2025-04-25T02:37:01.965Z] [Express] Express app configured.
[2025-04-25T02:37:01.966Z] [Loader] Express loaded.
[2025-04-25T02:37:01.966Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T02:37:01.972Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T02:37:01.973Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T02:37:01.973Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T02:37:01.973Z] [Loader] Socket.IO loaded.
[2025-04-25T02:37:01.973Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T02:37:01.974Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T02:37:02.052Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T02:37:02.053Z] [Loader] Jobs scheduled.
[2025-04-25T02:37:02.054Z] [Loader] Performing initial log analysis...
[2025-04-25T02:37:02.056Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T02:37:02.509Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T02:37:02.512Z] [Loader] Initial log analysis completed.
[2025-04-25T02:37:02.513Z] [Loader] All loaders completed successfully.
[2025-04-25T02:37:02.519Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T02:37:02.520Z] üîó Access the server at: http://localhost:3001
[2025-04-25T02:37:02.521Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T02:37:02.521Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T03:30:00.486Z] [Cron] Running scheduled log analysis...
[2025-04-25T03:30:00.504Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T03:30:00.738Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T03:30:00.742Z] [Cron] Log analysis finished and results broadcasted.
[2025-04-25T04:06:43.427Z] [Socket Auth MW] Attempting auth for socket TTPvQV6CCaT7CDQ_AAAD. Token provided: true
[2025-04-25T04:06:43.451Z] [Socket Auth MW] Token signature validated successfully for socket TTPvQV6CCaT7CDQ_AAAD.
[2025-04-25T04:06:43.455Z] [Socket.IO TTPvQV6CCaT7CDQ_AAAD] Client connected. Token present: true
[2025-04-25T04:06:43.455Z] [Socket.IO TTPvQV6CCaT7CDQ_AAAD] Attempting to fetch user info using token...
[2025-04-25T04:06:43.456Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T04:06:43.697Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:06:43.698Z] [Socket.IO TTPvQV6CCaT7CDQ_AAAD] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T04:06:43.698Z] [Socket.IO TTPvQV6CCaT7CDQ_AAAD] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T04:06:43.700Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:06:43.919Z] [History Service] Found 6 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:06:43.921Z] [Socket.IO TTPvQV6CCaT7CDQ_AAAD] Sent initial conversation list (6 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:06:43.921Z] [Socket.IO TTPvQV6CCaT7CDQ_AAAD] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T04:06:43.923Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:06:43.923Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Core event handlers registered.
[2025-04-25T04:06:50.902Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Event 'load_conversation' received for ID: 6808c6b8af360b2a2e0d3fb2, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:06:50.903Z] [History Service] Getting history for conversationId: 6808c6b8af360b2a2e0d3fb2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:06:50.904Z] [History Service] Applying message limit: 50
[2025-04-25T04:06:51.041Z] [History Service] Found history for conversationId: 6808c6b8af360b2a2e0d3fb2. Message count: 32
[2025-04-25T04:06:51.043Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Sent history for conversation 6808c6b8af360b2a2e0d3fb2. Set as active.
[2025-04-25T04:07:09.545Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554029545] Event 'send_message' received: UserInput="H·ªôi ngh·ªã t·ªï ch·ª©c v√†o...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=6808c6b8af360b2a2e0d3fb2
[2025-04-25T04:07:09.546Z] [History Service] Getting history for conversationId: 6808c6b8af360b2a2e0d3fb2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:07:09.547Z] [History Service] Applying message limit: 50
[2025-04-25T04:07:09.633Z] [History Service] Found history for conversationId: 6808c6b8af360b2a2e0d3fb2. Message count: 32
[2025-04-25T04:07:09.634Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554029545] Fetched 32 history items for conv 6808c6b8af360b2a2e0d3fb2.
[2025-04-25T04:07:09.638Z] --- [MsgHandler-1745554029545 Socket TTPvQV6CCaT7CDQ_AAAD] Handling STREAMING input: "H·ªôi ngh·ªã t·ªï ch·ª©c v√†o ng√†y n√†o", Lang: en ---
[2025-04-25T04:07:09.638Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:07:09.639Z] [MsgHandler-1745554029545] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:07:09.640Z] [MsgHandler-1745554029545 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:09.640Z] [MsgHandler-1745554029545 History Init - TTPvQV6CCaT7CDQ_AAAD] Added user turn. Size: 33
[2025-04-25T04:07:09.641Z] --- [MsgHandler-1745554029545 HostAgent Turn 1 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting initial response from HostAgent ---
[2025-04-25T04:07:09.641Z] [MsgHandler-1745554029545 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:09.641Z] [MsgHandler-1745554029545 History T1 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 33
[2025-04-25T04:07:09.644Z] [GeminiService] Received history with 33 items before mapping (for stream).
[2025-04-25T04:07:09.645Z] [GeminiService] Mapped history (SDK Content[]) with 33 items (for stream).
[2025-04-25T04:07:09.645Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:07:09.645Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:07:09.646Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:07:09.646Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:07:09.647Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:07:09.647Z] [GeminiService Stream] Preparing stream request with 33 Content items.
[2025-04-25T04:07:09.647Z]   - No valid next turn added, sending only history.
[2025-04-25T04:07:11.556Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:07:11.556Z] [MsgHandler-1745554029545 Stream T1 Direct - TTPvQV6CCaT7CDQ_AAAD] HostAgent provided stream directly. Processing...
[2025-04-25T04:07:11.557Z] [MsgHandler-1745554029545 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Starting... (Emit final: true)
[2025-04-25T04:07:11.558Z] [MsgHandler-1745554029545 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:11.559Z] [MsgHandler-1745554029545 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:11.601Z] [MsgHandler-1745554029545 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:11.649Z] [MsgHandler-1745554029545 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:11.661Z] [MsgHandler-1745554029545 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Finished. Length: 64
[2025-04-25T04:07:11.661Z] [MsgHandler-1745554029545 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Emitting final chat_result via safeEmit.
[2025-04-25T04:07:11.662Z] [MsgHandler-1745554029545 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_result, Type: result
[2025-04-25T04:07:11.662Z] [MsgHandler-1745554029545 History T1 Direct Done - TTPvQV6CCaT7CDQ_AAAD] Appended initial HostAgent response. Size: 34
[2025-04-25T04:07:11.663Z] --- [MsgHandler-1745554029545 TTPvQV6CCaT7CDQ_AAAD Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:07:11.663Z] [MsgHandler-1745554029545 Save History Check] History to save. Size: 34.
[2025-04-25T04:07:11.664Z] [History Service] Updating history for conversationId: 6808c6b8af360b2a2e0d3fb2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 34
[2025-04-25T04:07:11.872Z] [History Service] Successfully updated history for conversationId: 6808c6b8af360b2a2e0d3fb2. Modified: true
[2025-04-25T04:07:11.872Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554029545] Successfully updated history in DB for conv 6808c6b8af360b2a2e0d3fb2.
[2025-04-25T04:07:11.874Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:07:12.034Z] [History Service] Found 6 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:07:12.035Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:07:20.732Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Event 'load_conversation' received for ID: 6808c37faf360b2a2e0d3f99, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:07:20.732Z] [History Service] Getting history for conversationId: 6808c37faf360b2a2e0d3f99, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:07:20.732Z] [History Service] Applying message limit: 50
[2025-04-25T04:07:20.818Z] [History Service] Found history for conversationId: 6808c37faf360b2a2e0d3f99. Message count: 14
[2025-04-25T04:07:20.819Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Sent history for conversation 6808c37faf360b2a2e0d3f99. Set as active.
[2025-04-25T04:07:21.484Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Event 'load_conversation' received for ID: 6808c6b8af360b2a2e0d3fb2, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:07:21.485Z] [History Service] Getting history for conversationId: 6808c6b8af360b2a2e0d3fb2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:07:21.485Z] [History Service] Applying message limit: 50
[2025-04-25T04:07:21.570Z] [History Service] Found history for conversationId: 6808c6b8af360b2a2e0d3fb2. Message count: 34
[2025-04-25T04:07:21.571Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Sent history for conversation 6808c6b8af360b2a2e0d3fb2. Set as active.
[2025-04-25T04:07:22.366Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Event 'start_new_conversation' received for user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:07:22.366Z] [History Service] Explicitly creating new conversation for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:07:22.428Z] [History Service] Created new conversationId: 680b0a7a267cbec76631b556 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:07:22.428Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Started new conversation 680b0a7a267cbec76631b556. Set as active.
[2025-04-25T04:07:22.429Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:07:22.552Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:07:22.553Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after new conversation start.
[2025-04-25T04:07:26.799Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554046799] Event 'send_message' received: UserInput="HEllo...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:07:26.800Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:07:26.800Z] [History Service] Applying message limit: 50
[2025-04-25T04:07:26.854Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 0
[2025-04-25T04:07:26.854Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554046799] Fetched 0 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:07:26.854Z] --- [MsgHandler-1745554046799 Socket TTPvQV6CCaT7CDQ_AAAD] Handling STREAMING input: "HEllo", Lang: en ---
[2025-04-25T04:07:26.854Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:07:26.855Z] [MsgHandler-1745554046799] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:07:26.855Z] [MsgHandler-1745554046799 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:26.856Z] [MsgHandler-1745554046799 History Init - TTPvQV6CCaT7CDQ_AAAD] Added user turn. Size: 1
[2025-04-25T04:07:26.856Z] --- [MsgHandler-1745554046799 HostAgent Turn 1 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting initial response from HostAgent ---
[2025-04-25T04:07:26.857Z] [MsgHandler-1745554046799 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:26.861Z] [MsgHandler-1745554046799 History T1 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 1
[2025-04-25T04:07:26.867Z] [GeminiService] Received history with 1 items before mapping (for stream).
[2025-04-25T04:07:26.868Z] [GeminiService] Mapped history (SDK Content[]) with 1 items (for stream).
[2025-04-25T04:07:26.870Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:07:26.870Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:07:26.871Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:07:26.871Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:07:26.872Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:07:26.873Z] [GeminiService Stream] Preparing stream request with 1 Content items.
[2025-04-25T04:07:26.873Z]   - No valid next turn added, sending only history.
[2025-04-25T04:07:28.500Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:07:28.500Z] [MsgHandler-1745554046799 Stream T1 Direct - TTPvQV6CCaT7CDQ_AAAD] HostAgent provided stream directly. Processing...
[2025-04-25T04:07:28.500Z] [MsgHandler-1745554046799 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Starting... (Emit final: true)
[2025-04-25T04:07:28.501Z] [MsgHandler-1745554046799 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:28.501Z] [MsgHandler-1745554046799 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:28.596Z] [MsgHandler-1745554046799 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:28.611Z] [MsgHandler-1745554046799 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:28.624Z] [MsgHandler-1745554046799 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Finished. Length: 102
[2025-04-25T04:07:28.624Z] [MsgHandler-1745554046799 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Emitting final chat_result via safeEmit.
[2025-04-25T04:07:28.625Z] [MsgHandler-1745554046799 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_result, Type: result
[2025-04-25T04:07:28.625Z] [MsgHandler-1745554046799 History T1 Direct Done - TTPvQV6CCaT7CDQ_AAAD] Appended initial HostAgent response. Size: 2
[2025-04-25T04:07:28.626Z] --- [MsgHandler-1745554046799 TTPvQV6CCaT7CDQ_AAAD Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:07:28.626Z] [MsgHandler-1745554046799 Save History Check] History to save. Size: 2.
[2025-04-25T04:07:28.626Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 2
[2025-04-25T04:07:28.675Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:07:28.676Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554046799] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:07:28.676Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:07:28.798Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:07:28.799Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:07:44.398Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554064398] Event 'send_message' received: UserInput="H·ªôi ngh·ªã INFOCOMP t·ªï...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:07:44.398Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:07:44.399Z] [History Service] Applying message limit: 50
[2025-04-25T04:07:44.460Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 2
[2025-04-25T04:07:44.460Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554064398] Fetched 2 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:07:44.461Z] --- [MsgHandler-1745554064398 Socket TTPvQV6CCaT7CDQ_AAAD] Handling STREAMING input: "H·ªôi ngh·ªã INFOCOMP t·ªï ch·ª©c ·ªü ƒë√¢u v√† ng√†y n√†o ?", Lang: en ---
[2025-04-25T04:07:44.461Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:07:44.461Z] [MsgHandler-1745554064398] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:07:44.462Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:44.463Z] [MsgHandler-1745554064398 History Init - TTPvQV6CCaT7CDQ_AAAD] Added user turn. Size: 3
[2025-04-25T04:07:44.464Z] --- [MsgHandler-1745554064398 HostAgent Turn 1 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting initial response from HostAgent ---
[2025-04-25T04:07:44.465Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:44.465Z] [MsgHandler-1745554064398 History T1 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 3
[2025-04-25T04:07:44.465Z] [GeminiService] Received history with 3 items before mapping (for stream).
[2025-04-25T04:07:44.465Z] [GeminiService] Mapped history (SDK Content[]) with 3 items (for stream).
[2025-04-25T04:07:44.466Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:07:44.466Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:07:44.466Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:07:44.466Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:07:44.467Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:07:44.467Z] [GeminiService Stream] Preparing stream request with 3 Content items.
[2025-04-25T04:07:44.467Z]   - No valid next turn added, sending only history.
[2025-04-25T04:07:46.230Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:07:46.230Z] [MsgHandler-1745554064398 HostAgent T1 - TTPvQV6CCaT7CDQ_AAAD] HostAgent requested function call: routeToAgent
[2025-04-25T04:07:46.231Z] [MsgHandler-1745554064398 History T1 Prep - TTPvQV6CCaT7CDQ_AAAD] Appended HostAgent FC request. Size: 4
[2025-04-25T04:07:46.231Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:46.233Z] --- [MsgHandler-1745554064398 SubAgent Call Start - TTPvQV6CCaT7CDQ_AAAD] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T04:07:46.234Z] --- [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 Socket TTPvQV6CCaT7CDQ_AAAD] Calling Sub Agent: ConferenceAgent, Task: c4f7db56-6813-4b7b-aeb1-963936711699 ---
[2025-04-25T04:07:46.234Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: en
[2025-04-25T04:07:46.235Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234] Sending request to ConferenceAgent LLM.
[2025-04-25T04:07:46.236Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:07:46.236Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:07:46.236Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:07:46.236Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:07:46.237Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:07:46.237Z] Tools provided: ["getConferences","followUnfollowItem"]
[2025-04-25T04:07:46.237Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:07:46.238Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:07:46.238Z]   - No valid next turn added, sending only history.
[2025-04-25T04:07:47.170Z] Model Finish Reason: STOP
[2025-04-25T04:07:47.170Z] Model requested function call: getConferences
[2025-04-25T04:07:47.170Z] Arguments: {"searchQuery":"acronym=INFOCOMP&mode=detail&perPage=5&page=1"}
[2025-04-25T04:07:47.171Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T04:07:47.171Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234] ConferenceAgent requested function call: getConferences
[2025-04-25T04:07:47.172Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 TTPvQV6CCaT7CDQ_AAAD] FunctionRegistry: Attempting execution: getConferences
[2025-04-25T04:07:47.172Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 Status Stub] Step: function_call, Msg: Received request to call function: getConferences
[2025-04-25T04:07:47.173Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 TTPvQV6CCaT7CDQ_AAAD] Handler: GetConferences, Args: {"searchQuery":"acronym=INFOCOMP&mode=detail&perPage=5&page=1"}
[2025-04-25T04:07:47.173Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 Status Stub] Step: validating_function_args, Msg: Validating arguments for getConferences...
[2025-04-25T04:07:47.174Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 Status Stub] Step: retrieving_info, Msg: Retrieving conference data...
[2025-04-25T04:07:47.175Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=INFOCOMP&mode=detail&perPage=5&page=1
[2025-04-25T04:07:47.403Z] Backend API Success for conference. Data length: 8144
[2025-04-25T04:07:47.405Z] Transforming conference data with Markdown. Search query: acronym=INFOCOMP&mode=detail&perPage=5&page=1
[2025-04-25T04:07:47.424Z] Conference data transformed successfully.
[2025-04-25T04:07:47.424Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 TTPvQV6CCaT7CDQ_AAAD] API result: Success=true
[2025-04-25T04:07:47.425Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 Status Stub] Step: data_found, Msg: Successfully retrieved and processed conference data.
[2025-04-25T04:07:47.425Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 TTPvQV6CCaT7CDQ_AAAD] FunctionRegistry: Execution finished for getConferences.
[2025-04-25T04:07:47.425Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234 Status Stub] Step: processing_function_result, Msg: Received result from getConferences.
[2025-04-25T04:07:47.425Z] [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234] Function getConferences executed. Result: **Meta:**
- **Current page:** 1
- **Per page:** 5
- **Total items:** 1
- **Total page:** 1
- **Prev ...
[2025-04-25T04:07:47.426Z] --- [MsgHandler-1745554064398-Sub-ConferenceAgent-1745554066234] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T04:07:47.426Z] --- [MsgHandler-1745554064398 SubAgent Call End - TTPvQV6CCaT7CDQ_AAAD] ConferenceAgent finished. Status: success ---
[2025-04-25T04:07:47.426Z] [MsgHandler-1745554064398 History T1 Done - TTPvQV6CCaT7CDQ_AAAD] Appended function/routing response to Host history. Size: 5
[2025-04-25T04:07:47.426Z] --- [MsgHandler-1745554064398 HostAgent Turn 2 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting final stream from HostAgent ---
[2025-04-25T04:07:47.427Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:47.427Z] [MsgHandler-1745554064398 History T2 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 5
[2025-04-25T04:07:47.428Z] [GeminiService] Received history with 5 items before mapping (for stream).
[2025-04-25T04:07:47.428Z] [GeminiService] Mapped history (SDK Content[]) with 5 items (for stream).
[2025-04-25T04:07:47.429Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:07:47.429Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:07:47.430Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:07:47.430Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:07:47.430Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:07:47.431Z] [GeminiService Stream] Preparing stream request with 5 Content items.
[2025-04-25T04:07:47.431Z]   - No valid next turn added, sending only history.
[2025-04-25T04:07:47.975Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:07:47.976Z] [MsgHandler-1745554064398 Stream T2 - TTPvQV6CCaT7CDQ_AAAD] Processing final stream from HostAgent...
[2025-04-25T04:07:47.976Z] [MsgHandler-1745554064398 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Starting... (Emit final: true)
[2025-04-25T04:07:47.977Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:07:47.977Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:48.087Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:48.172Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:07:48.184Z] [MsgHandler-1745554064398 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Finished. Length: 158
[2025-04-25T04:07:48.184Z] [MsgHandler-1745554064398 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Emitting final chat_result via safeEmit.
[2025-04-25T04:07:48.185Z] [MsgHandler-1745554064398 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_result, Type: result
[2025-04-25T04:07:48.185Z] [MsgHandler-1745554064398 History T2 Done - TTPvQV6CCaT7CDQ_AAAD] Appended final HostAgent response. Size: 6
[2025-04-25T04:07:48.185Z] --- [MsgHandler-1745554064398 TTPvQV6CCaT7CDQ_AAAD Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:07:48.185Z] [MsgHandler-1745554064398 Save History Check] History to save. Size: 6.
[2025-04-25T04:07:48.186Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 6
[2025-04-25T04:07:48.240Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:07:48.241Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554064398] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:07:48.241Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:07:48.376Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:07:48.377Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:08:19.263Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554099263] Event 'send_message' received: UserInput="M·ªü b·∫£n ƒë·ªì cho h·ªôi ng...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:08:19.263Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:08:19.264Z] [History Service] Applying message limit: 50
[2025-04-25T04:08:19.317Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 6
[2025-04-25T04:08:19.318Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554099263] Fetched 6 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:08:19.318Z] --- [MsgHandler-1745554099263 Socket TTPvQV6CCaT7CDQ_AAAD] Handling STREAMING input: "M·ªü b·∫£n ƒë·ªì cho h·ªôi ngh·ªã tr√™n", Lang: en ---
[2025-04-25T04:08:19.318Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:08:19.319Z] [MsgHandler-1745554099263] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:08:19.319Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:19.320Z] [MsgHandler-1745554099263 History Init - TTPvQV6CCaT7CDQ_AAAD] Added user turn. Size: 7
[2025-04-25T04:08:19.320Z] --- [MsgHandler-1745554099263 HostAgent Turn 1 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting initial response from HostAgent ---
[2025-04-25T04:08:19.320Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:19.320Z] [MsgHandler-1745554099263 History T1 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 7
[2025-04-25T04:08:19.321Z] [GeminiService] Received history with 7 items before mapping (for stream).
[2025-04-25T04:08:19.321Z] [GeminiService] Mapped history (SDK Content[]) with 7 items (for stream).
[2025-04-25T04:08:19.321Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:08:19.322Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:08:19.322Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:08:19.322Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:08:19.322Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:08:19.322Z] [GeminiService Stream] Preparing stream request with 7 Content items.
[2025-04-25T04:08:19.323Z]   - No valid next turn added, sending only history.
[2025-04-25T04:08:20.256Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:08:20.257Z] [MsgHandler-1745554099263 HostAgent T1 - TTPvQV6CCaT7CDQ_AAAD] HostAgent requested function call: routeToAgent
[2025-04-25T04:08:20.257Z] [MsgHandler-1745554099263 History T1 Prep - TTPvQV6CCaT7CDQ_AAAD] Appended HostAgent FC request. Size: 8
[2025-04-25T04:08:20.258Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:20.258Z] --- [MsgHandler-1745554099263 SubAgent Call Start - TTPvQV6CCaT7CDQ_AAAD] Calling NavigationAgent via callSubAgent ---
[2025-04-25T04:08:20.258Z] --- [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 Socket TTPvQV6CCaT7CDQ_AAAD] Calling Sub Agent: NavigationAgent, Task: 9176dc5e-3835-43a2-ab55-a4e5fcebe7f0 ---
[2025-04-25T04:08:20.258Z] [Language Config] Using configuration for Agent: NavigationAgent, Language: en
[2025-04-25T04:08:20.259Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258] Sending request to NavigationAgent LLM.
[2025-04-25T04:08:20.259Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:08:20.259Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:08:20.259Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:08:20.260Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:08:20.260Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:08:20.261Z] Tools provided: ["navigation","openGoogleMap"]
[2025-04-25T04:08:20.261Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:08:20.262Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:08:20.262Z]   - No valid next turn added, sending only history.
[2025-04-25T04:08:21.892Z] Model Finish Reason: STOP
[2025-04-25T04:08:21.892Z] Model requested function call: openGoogleMap
[2025-04-25T04:08:21.892Z] Arguments: {"location":"Valencia, Spain"}
[2025-04-25T04:08:21.893Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258] Received result from NavigationAgent LLM: Status requires_function_call
[2025-04-25T04:08:21.893Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258] NavigationAgent requested function call: openGoogleMap
[2025-04-25T04:08:21.894Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 TTPvQV6CCaT7CDQ_AAAD] FunctionRegistry: Attempting execution: openGoogleMap
[2025-04-25T04:08:21.895Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 Status Stub] Step: function_call, Msg: Received request to call function: openGoogleMap
[2025-04-25T04:08:21.896Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 TTPvQV6CCaT7CDQ_AAAD] Handler: OpenGoogleMap, Args: {"location":"Valencia, Spain"}
[2025-04-25T04:08:21.896Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 Status Stub] Step: validating_map_location, Msg: Validating location argument...
[2025-04-25T04:08:21.896Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 TTPvQV6CCaT7CDQ_AAAD] OpenGoogleMap: Valid location string: Valencia, Spain
[2025-04-25T04:08:21.896Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 Status Stub] Step: map_action_prepared, Msg: Google Maps action prepared.
[2025-04-25T04:08:21.897Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 TTPvQV6CCaT7CDQ_AAAD] FunctionRegistry: Execution finished for openGoogleMap.
[2025-04-25T04:08:21.897Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258 Status Stub] Step: processing_function_result, Msg: Received result from openGoogleMap.
[2025-04-25T04:08:21.897Z] [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258] Function openGoogleMap executed. Result: Map action acknowledged. Google Maps will be opened for the location: "Valencia, Spain"....
[2025-04-25T04:08:21.897Z] --- [MsgHandler-1745554099263-Sub-NavigationAgent-1745554100258] Sub Agent NavigationAgent finished. Status: success ---
[2025-04-25T04:08:21.898Z] --- [MsgHandler-1745554099263 SubAgent Call End - TTPvQV6CCaT7CDQ_AAAD] NavigationAgent finished. Status: success ---
[2025-04-25T04:08:21.898Z] [MsgHandler-1745554099263 TTPvQV6CCaT7CDQ_AAAD] Stored frontendAction from NavigationAgent.
[2025-04-25T04:08:21.898Z] [MsgHandler-1745554099263 History T1 Done - TTPvQV6CCaT7CDQ_AAAD] Appended function/routing response to Host history. Size: 9
[2025-04-25T04:08:21.899Z] --- [MsgHandler-1745554099263 HostAgent Turn 2 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting final stream from HostAgent ---
[2025-04-25T04:08:21.899Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:21.899Z] [MsgHandler-1745554099263 History T2 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 9
[2025-04-25T04:08:21.899Z] [GeminiService] Received history with 9 items before mapping (for stream).
[2025-04-25T04:08:21.900Z] [GeminiService] Mapped history (SDK Content[]) with 9 items (for stream).
[2025-04-25T04:08:21.900Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:08:21.900Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:08:21.900Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:08:21.901Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:08:21.901Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:08:21.901Z] [GeminiService Stream] Preparing stream request with 9 Content items.
[2025-04-25T04:08:21.901Z]   - No valid next turn added, sending only history.
[2025-04-25T04:08:22.521Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:08:22.521Z] [MsgHandler-1745554099263 Stream T2 - TTPvQV6CCaT7CDQ_AAAD] Processing final stream from HostAgent...
[2025-04-25T04:08:22.521Z] [MsgHandler-1745554099263 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Starting... (Emit final: true)
[2025-04-25T04:08:22.522Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:22.522Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:08:22.579Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:08:22.589Z] [MsgHandler-1745554099263 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Finished. Length: 45
[2025-04-25T04:08:22.589Z] [MsgHandler-1745554099263 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Emitting final chat_result via safeEmit.
[2025-04-25T04:08:22.589Z] [MsgHandler-1745554099263 TTPvQV6CCaT7CDQ_AAAD] Attaching frontendAction to final stream event: {"type":"openMap","location":"Valencia, Spain"}
[2025-04-25T04:08:22.590Z] [MsgHandler-1745554099263 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_result, Type: result
[2025-04-25T04:08:22.590Z] [MsgHandler-1745554099263 History T2 Done - TTPvQV6CCaT7CDQ_AAAD] Appended final HostAgent response. Size: 10
[2025-04-25T04:08:22.590Z] --- [MsgHandler-1745554099263 TTPvQV6CCaT7CDQ_AAAD Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:08:22.591Z] [MsgHandler-1745554099263 Save History Check] History to save. Size: 10.
[2025-04-25T04:08:22.591Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 10
[2025-04-25T04:08:22.647Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:08:22.647Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554099263] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:08:22.647Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:08:22.771Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:08:22.772Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:08:43.433Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554123433] Event 'send_message' received: UserInput="M·ªü website h·ªôi ngh·ªã ...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:08:43.434Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:08:43.434Z] [History Service] Applying message limit: 50
[2025-04-25T04:08:43.485Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 10
[2025-04-25T04:08:43.486Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554123433] Fetched 10 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:08:43.486Z] --- [MsgHandler-1745554123433 Socket TTPvQV6CCaT7CDQ_AAAD] Handling STREAMING input: "M·ªü website h·ªôi ngh·ªã lu√¥n", Lang: en ---
[2025-04-25T04:08:43.486Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:08:43.486Z] [MsgHandler-1745554123433] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:08:43.487Z] [MsgHandler-1745554123433 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:43.487Z] [MsgHandler-1745554123433 History Init - TTPvQV6CCaT7CDQ_AAAD] Added user turn. Size: 11
[2025-04-25T04:08:43.487Z] --- [MsgHandler-1745554123433 HostAgent Turn 1 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting initial response from HostAgent ---
[2025-04-25T04:08:43.488Z] [MsgHandler-1745554123433 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:43.488Z] [MsgHandler-1745554123433 History T1 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 11
[2025-04-25T04:08:43.488Z] [GeminiService] Received history with 11 items before mapping (for stream).
[2025-04-25T04:08:43.489Z] [GeminiService] Mapped history (SDK Content[]) with 11 items (for stream).
[2025-04-25T04:08:43.489Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:08:43.489Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:08:43.489Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:08:43.489Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:08:43.489Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:08:43.490Z] [GeminiService Stream] Preparing stream request with 11 Content items.
[2025-04-25T04:08:43.490Z]   - No valid next turn added, sending only history.
[2025-04-25T04:08:45.367Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:08:45.368Z] [MsgHandler-1745554123433 HostAgent T1 - TTPvQV6CCaT7CDQ_AAAD] HostAgent requested function call: routeToAgent
[2025-04-25T04:08:45.368Z] [MsgHandler-1745554123433 History T1 Prep - TTPvQV6CCaT7CDQ_AAAD] Appended HostAgent FC request. Size: 12
[2025-04-25T04:08:45.369Z] [MsgHandler-1745554123433 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:45.369Z] --- [MsgHandler-1745554123433 SubAgent Call Start - TTPvQV6CCaT7CDQ_AAAD] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T04:08:45.369Z] --- [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 Socket TTPvQV6CCaT7CDQ_AAAD] Calling Sub Agent: ConferenceAgent, Task: daf78336-b06a-455b-ad61-7a08d5ac56b9 ---
[2025-04-25T04:08:45.369Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: en
[2025-04-25T04:08:45.370Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369] Sending request to ConferenceAgent LLM.
[2025-04-25T04:08:45.370Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:08:45.370Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:08:45.370Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:08:45.371Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:08:45.371Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:08:45.371Z] Tools provided: ["getConferences","followUnfollowItem"]
[2025-04-25T04:08:45.371Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:08:45.371Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:08:45.371Z]   - No valid next turn added, sending only history.
[2025-04-25T04:08:47.138Z] Model Finish Reason: STOP
[2025-04-25T04:08:47.138Z] Model requested function call: getConferences
[2025-04-25T04:08:47.138Z] Arguments: {"searchQuery":"title=International+Conference+on+Advanced+Communications+and+Computation&perPage=5&page=1&mode=detail"}
[2025-04-25T04:08:47.138Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T04:08:47.139Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369] ConferenceAgent requested function call: getConferences
[2025-04-25T04:08:47.139Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 TTPvQV6CCaT7CDQ_AAAD] FunctionRegistry: Attempting execution: getConferences
[2025-04-25T04:08:47.139Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 Status Stub] Step: function_call, Msg: Received request to call function: getConferences
[2025-04-25T04:08:47.140Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 TTPvQV6CCaT7CDQ_AAAD] Handler: GetConferences, Args: {"searchQuery":"title=International+Conference+on+Advanced+Communications+and+Computation&perPage=5&page=1&mode=detail"}
[2025-04-25T04:08:47.140Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 Status Stub] Step: validating_function_args, Msg: Validating arguments for getConferences...
[2025-04-25T04:08:47.140Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 Status Stub] Step: retrieving_info, Msg: Retrieving conference data...
[2025-04-25T04:08:47.141Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?title=International+Conference+on+Advanced+Communications+and+Computation&perPage=5&page=1&mode=detail
[2025-04-25T04:08:47.272Z] Backend API Success for conference. Data length: 8144
[2025-04-25T04:08:47.272Z] Transforming conference data with Markdown. Search query: title=International+Conference+on+Advanced+Communications+and+Computation&perPage=5&page=1&mode=detail
[2025-04-25T04:08:47.281Z] Conference data transformed successfully.
[2025-04-25T04:08:47.281Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 TTPvQV6CCaT7CDQ_AAAD] API result: Success=true
[2025-04-25T04:08:47.282Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 Status Stub] Step: data_found, Msg: Successfully retrieved and processed conference data.
[2025-04-25T04:08:47.282Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 TTPvQV6CCaT7CDQ_AAAD] FunctionRegistry: Execution finished for getConferences.
[2025-04-25T04:08:47.282Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369 Status Stub] Step: processing_function_result, Msg: Received result from getConferences.
[2025-04-25T04:08:47.282Z] [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369] Function getConferences executed. Result: **Meta:**
- **Current page:** 1
- **Per page:** 5
- **Total items:** 1
- **Total page:** 1
- **Prev ...
[2025-04-25T04:08:47.283Z] --- [MsgHandler-1745554123433-Sub-ConferenceAgent-1745554125369] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T04:08:47.283Z] --- [MsgHandler-1745554123433 SubAgent Call End - TTPvQV6CCaT7CDQ_AAAD] ConferenceAgent finished. Status: success ---
[2025-04-25T04:08:47.283Z] [MsgHandler-1745554123433 History T1 Done - TTPvQV6CCaT7CDQ_AAAD] Appended function/routing response to Host history. Size: 13
[2025-04-25T04:08:47.283Z] --- [MsgHandler-1745554123433 HostAgent Turn 2 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting final stream from HostAgent ---
[2025-04-25T04:08:47.284Z] [MsgHandler-1745554123433 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:08:47.284Z] [MsgHandler-1745554123433 History T2 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 13
[2025-04-25T04:08:47.284Z] [GeminiService] Received history with 13 items before mapping (for stream).
[2025-04-25T04:08:47.285Z] [GeminiService] Mapped history (SDK Content[]) with 13 items (for stream).
[2025-04-25T04:08:47.285Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:08:47.285Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:08:47.285Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:08:47.285Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:08:47.286Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:08:47.286Z] [GeminiService Stream] Preparing stream request with 13 Content items.
[2025-04-25T04:08:47.286Z]   - No valid next turn added, sending only history.
[2025-04-25T04:08:48.213Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:08:48.214Z] [MsgHandler-1745554123433 Error T2 - TTPvQV6CCaT7CDQ_AAAD] HostAgent requested another function call unexpectedly.
[2025-04-25T04:08:48.214Z] [MsgHandler-1745554123433 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_error, Type: error
[2025-04-25T04:08:48.215Z] --- [MsgHandler-1745554123433 TTPvQV6CCaT7CDQ_AAAD Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:08:48.215Z] [MsgHandler-1745554123433 Save History Check] History to save. Size: 14.
[2025-04-25T04:08:48.215Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 14
[2025-04-25T04:08:48.294Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:08:48.295Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554123433] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:08:48.295Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:08:48.416Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:08:48.417Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:09:22.599Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554162599] Event 'send_message' received: UserInput="M·ªü cho t√¥i website c...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:09:22.599Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:09:22.600Z] [History Service] Applying message limit: 50
[2025-04-25T04:09:22.645Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 14
[2025-04-25T04:09:22.645Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554162599] Fetched 14 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:09:22.645Z] --- [MsgHandler-1745554162599 Socket TTPvQV6CCaT7CDQ_AAAD] Handling STREAMING input: "M·ªü cho t√¥i website c·ªßa h·ªôi ngh·ªã", Lang: en ---
[2025-04-25T04:09:22.646Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:09:22.646Z] [MsgHandler-1745554162599] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:09:22.646Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:09:22.647Z] [MsgHandler-1745554162599 History Init - TTPvQV6CCaT7CDQ_AAAD] Added user turn. Size: 15
[2025-04-25T04:09:22.647Z] --- [MsgHandler-1745554162599 HostAgent Turn 1 Start - TTPvQV6CCaT7CDQ_AAAD] Requesting initial response from HostAgent ---
[2025-04-25T04:09:22.647Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:09:22.647Z] [MsgHandler-1745554162599 History T1 Send - TTPvQV6CCaT7CDQ_AAAD] Host History Size: 15
[2025-04-25T04:09:22.648Z] [GeminiService] Received history with 15 items before mapping (for stream).
[2025-04-25T04:09:22.648Z] [GeminiService] Mapped history (SDK Content[]) with 15 items (for stream).
[2025-04-25T04:09:22.648Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:09:22.648Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:09:22.648Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:09:22.649Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:09:22.649Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:09:22.649Z] [GeminiService Stream] Preparing stream request with 15 Content items.
[2025-04-25T04:09:22.649Z]   - No valid next turn added, sending only history.
[2025-04-25T04:09:24.347Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:09:24.347Z] [MsgHandler-1745554162599 Stream T1 Direct - TTPvQV6CCaT7CDQ_AAAD] HostAgent provided stream directly. Processing...
[2025-04-25T04:09:24.348Z] [MsgHandler-1745554162599 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Starting... (Emit final: true)
[2025-04-25T04:09:24.348Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: status_update, Type: status
[2025-04-25T04:09:24.349Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:09:24.418Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:09:24.553Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:09:24.651Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_update, Type: partial_result
[2025-04-25T04:09:24.666Z] [MsgHandler-1745554162599 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Finished. Length: 194
[2025-04-25T04:09:24.667Z] [MsgHandler-1745554162599 Stream Processing - TTPvQV6CCaT7CDQ_AAAD] Emitting final chat_result via safeEmit.
[2025-04-25T04:09:24.667Z] [MsgHandler-1745554162599 Emit Sent - TTPvQV6CCaT7CDQ_AAAD] Event: chat_result, Type: result
[2025-04-25T04:09:24.668Z] [MsgHandler-1745554162599 History T1 Direct Done - TTPvQV6CCaT7CDQ_AAAD] Appended initial HostAgent response. Size: 16
[2025-04-25T04:09:24.668Z] --- [MsgHandler-1745554162599 TTPvQV6CCaT7CDQ_AAAD Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:09:24.669Z] [MsgHandler-1745554162599 Save History Check] History to save. Size: 16.
[2025-04-25T04:09:24.669Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 16
[2025-04-25T04:09:24.738Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:09:24.738Z] [Socket TTPvQV6CCaT7CDQ_AAAD MsgHandler-1745554162599] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:09:24.738Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:09:24.876Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:09:24.877Z] [Socket TTPvQV6CCaT7CDQ_AAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:15:13.180Z] [Server Config] Loaded PORT: 3001
[2025-04-25T04:15:13.181Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T04:15:13.182Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T04:15:13.184Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:15:13.186Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:15:21.875Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T04:15:21.876Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:15:22.352Z] [Server Start] Initializing loaders...
[2025-04-25T04:15:22.352Z] [Loader] Starting application loading process...
[2025-04-25T04:15:22.353Z] [Loader DB] Attempting database connection...
[2025-04-25T04:15:22.353Z] [Database] Attempting MongoDB connection...
[2025-04-25T04:15:23.141Z] [Database] MongoDB Connected Successfully.
[2025-04-25T04:15:23.142Z] [Loader DB] Database connection successful.
[2025-04-25T04:15:23.142Z] [Loader] Database loaded.
[2025-04-25T04:15:23.142Z] [History Service] Initialized.
[2025-04-25T04:15:23.143Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:15:23.143Z] [Loader] Services initialized.
[2025-04-25T04:15:23.151Z] [Express] Mounted API routes at /api
[2025-04-25T04:15:23.151Z] [Express] Registered Not Found handler.
[2025-04-25T04:15:23.152Z] [Express] Registered Global Error handler.
[2025-04-25T04:15:23.152Z] [Express] Express app configured.
[2025-04-25T04:15:23.153Z] [Loader] Express loaded.
[2025-04-25T04:15:23.154Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T04:15:23.160Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T04:15:23.160Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T04:15:23.160Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T04:15:23.160Z] [Loader] Socket.IO loaded.
[2025-04-25T04:15:23.161Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T04:15:23.161Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T04:15:23.206Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T04:15:23.207Z] [Loader] Jobs scheduled.
[2025-04-25T04:15:23.207Z] [Loader] Performing initial log analysis...
[2025-04-25T04:15:23.209Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T04:15:23.330Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T04:15:23.331Z] [Loader] Initial log analysis completed.
[2025-04-25T04:15:23.331Z] [Loader] All loaders completed successfully.
[2025-04-25T04:15:23.336Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T04:15:23.336Z] üîó Access the server at: http://localhost:3001
[2025-04-25T04:15:23.337Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:15:23.337Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T04:15:24.083Z] [Socket Auth MW] Attempting auth for socket OXxFFwlPA_SNDfdaAAAB. Token provided: true
[2025-04-25T04:15:24.089Z] [Socket Auth MW] Token signature validated successfully for socket OXxFFwlPA_SNDfdaAAAB.
[2025-04-25T04:15:24.091Z] [Socket.IO OXxFFwlPA_SNDfdaAAAB] Client connected. Token present: true
[2025-04-25T04:15:24.092Z] [Socket.IO OXxFFwlPA_SNDfdaAAAB] Attempting to fetch user info using token...
[2025-04-25T04:15:24.092Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T04:15:24.355Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:15:24.355Z] [Socket.IO OXxFFwlPA_SNDfdaAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T04:15:24.355Z] [Socket.IO OXxFFwlPA_SNDfdaAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T04:15:24.356Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:15:24.554Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:15:24.556Z] [Socket.IO OXxFFwlPA_SNDfdaAAAB] Sent initial conversation list (7 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:15:24.556Z] [Socket.IO OXxFFwlPA_SNDfdaAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T04:15:24.558Z] [Socket OXxFFwlPA_SNDfdaAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:15:24.558Z] [Socket OXxFFwlPA_SNDfdaAAAB] Core event handlers registered.
[2025-04-25T04:15:25.702Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'load_conversation' received for ID: 6808c6b8af360b2a2e0d3fb2, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:15:25.703Z] [History Service] Getting history for conversationId: 6808c6b8af360b2a2e0d3fb2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:15:25.704Z] [History Service] Applying message limit: 50
[2025-04-25T04:15:25.819Z] [History Service] Found history for conversationId: 6808c6b8af360b2a2e0d3fb2. Message count: 34
[2025-04-25T04:15:25.821Z] [Socket OXxFFwlPA_SNDfdaAAAB] Sent history for conversation 6808c6b8af360b2a2e0d3fb2. Set as active.
[2025-04-25T04:15:26.910Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'load_conversation' received for ID: 680b0a7a267cbec76631b556, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:15:26.910Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:15:26.911Z] [History Service] Applying message limit: 50
[2025-04-25T04:15:26.962Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 16
[2025-04-25T04:15:26.963Z] [Socket OXxFFwlPA_SNDfdaAAAB] Sent history for conversation 680b0a7a267cbec76631b556. Set as active.
[2025-04-25T04:15:30.795Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'clear_conversation' received for ID: 680b0a7a267cbec76631b556, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:15:30.795Z] [History Service] Attempting to clear messages for conversationId: 680b0a7a267cbec76631b556 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:15:30.865Z] [History Service] Successfully cleared messages for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:15:30.865Z] [Socket OXxFFwlPA_SNDfdaAAAB] Successfully processed message clearing for conversation 680b0a7a267cbec76631b556.
[2025-04-25T04:15:30.866Z] [Socket OXxFFwlPA_SNDfdaAAAB] Cleared conversation 680b0a7a267cbec76631b556 was active. Emitting empty history.
[2025-04-25T04:15:30.866Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:15:31.011Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:15:31.012Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after clearing of 680b0a7a267cbec76631b556.
[2025-04-25T04:15:33.150Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'load_conversation' received for ID: 6808c6b8af360b2a2e0d3fb2, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:15:33.150Z] [History Service] Getting history for conversationId: 6808c6b8af360b2a2e0d3fb2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:15:33.151Z] [History Service] Applying message limit: 50
[2025-04-25T04:15:33.248Z] [History Service] Found history for conversationId: 6808c6b8af360b2a2e0d3fb2. Message count: 34
[2025-04-25T04:15:33.250Z] [Socket OXxFFwlPA_SNDfdaAAAB] Sent history for conversation 6808c6b8af360b2a2e0d3fb2. Set as active.
[2025-04-25T04:15:34.200Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'load_conversation' received for ID: 680b0a7a267cbec76631b556, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:15:34.201Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:15:34.201Z] [History Service] Applying message limit: 50
[2025-04-25T04:15:34.251Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 0
[2025-04-25T04:15:34.252Z] [Socket OXxFFwlPA_SNDfdaAAAB] Sent history for conversation 680b0a7a267cbec76631b556. Set as active.
[2025-04-25T04:15:38.941Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554538941] Event 'send_message' received: UserInput="HEllo...", Streaming=false, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:15:38.942Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:15:38.942Z] [History Service] Applying message limit: 50
[2025-04-25T04:15:38.993Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 0
[2025-04-25T04:15:38.993Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554538941] Fetched 0 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:15:38.995Z] --- [MsgHandler-1745554538941 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "HEllo", Lang: en ---
[2025-04-25T04:15:38.995Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:15:38.996Z] [MsgHandler-1745554538941 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:15:38.997Z] --- [MsgHandler-1745554538941 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 1) ---
[2025-04-25T04:15:38.997Z] [MsgHandler-1745554538941 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:15:38.998Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:15:38.999Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:15:38.999Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:15:38.999Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:15:38.999Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:15:39.000Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:15:39.000Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:15:39.000Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:15:39.000Z]   - No valid next turn added, sending only history.
[2025-04-25T04:15:39.879Z] Model Finish Reason: STOP
[2025-04-25T04:15:39.880Z] Model generated final text response: Hello! How can I help you today with the Global Conference & Journal Hub?
...
[2025-04-25T04:15:39.880Z] [MsgHandler-1745554538941 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Received final_text.
[2025-04-25T04:15:39.882Z] [MsgHandler-1745554538941 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:15:39.885Z] [MsgHandler-1745554538941 History Check - Final] Appended final HostAgent response. History size: 2
[2025-04-25T04:15:39.886Z] [MsgHandler-1745554538941 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:15:39.887Z] --- [MsgHandler-1745554538941 Socket OXxFFwlPA_SNDfdaAAAB Lang: en] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:15:39.892Z] [MsgHandler-1745554538941 Save History Check] History to save. Size: 2.
[2025-04-25T04:15:39.895Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 2
[2025-04-25T04:15:39.981Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:15:39.981Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554538941] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:15:39.981Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:15:40.125Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:15:40.126Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:16:03.696Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554563696] Event 'send_message' received: UserInput="website c·ªßa h·ªôi ngh·ªã...", Streaming=false, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:16:03.697Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:16:03.697Z] [History Service] Applying message limit: 50
[2025-04-25T04:16:03.749Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 2
[2025-04-25T04:16:03.749Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554563696] Fetched 2 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:03.749Z] --- [MsgHandler-1745554563696 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "website c·ªßa h·ªôi ngh·ªã INFOCOMP l√† g√¨", Lang: en ---
[2025-04-25T04:16:03.749Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:16:03.750Z] [MsgHandler-1745554563696 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:03.751Z] --- [MsgHandler-1745554563696 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 3) ---
[2025-04-25T04:16:03.751Z] [MsgHandler-1745554563696 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:03.752Z] [GeminiService] Received history with 3 items before mapping.
[2025-04-25T04:16:03.752Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 3 items.
[2025-04-25T04:16:03.752Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:03.753Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:03.753Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:03.753Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:03.754Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:03.755Z] [GeminiService] Sending total 3 Content items to API.
[2025-04-25T04:16:03.755Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:05.997Z] Model Finish Reason: STOP
[2025-04-25T04:16:05.997Z] Model requested function call: routeToAgent
[2025-04-25T04:16:05.997Z] Arguments: {"taskDescription":"Find the website URL for the INFOCOMP conference.","inputData":"What is the website of the INFOCOMP conference?","targetAgent":"ConferenceAgent"}
[2025-04-25T04:16:05.997Z] [MsgHandler-1745554563696 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Requested function call: routeToAgent
[2025-04-25T04:16:05.998Z] [MsgHandler-1745554563696 History Check - Host FC Prep 1] Appended HostAgent FC request. History size: 4
[2025-04-25T04:16:05.998Z] [MsgHandler-1745554563696 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:06.000Z] --- [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: ConferenceAgent, Task: 0592ffa0-5be5-43f2-92bf-3724952b9629 ---
[2025-04-25T04:16:06.000Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: en
[2025-04-25T04:16:06.001Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000] Sending request to ConferenceAgent LLM.
[2025-04-25T04:16:06.001Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:16:06.001Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:16:06.001Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:06.002Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:06.002Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:06.002Z] Tools provided: ["getConferences","followUnfollowItem"]
[2025-04-25T04:16:06.002Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:06.002Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:16:06.003Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:06.775Z] Model Finish Reason: STOP
[2025-04-25T04:16:06.776Z] Model requested function call: getConferences
[2025-04-25T04:16:06.776Z] Arguments: {"searchQuery":"acronym=INFOCOMP&perPage=5&page=1"}
[2025-04-25T04:16:06.778Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T04:16:06.778Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000] ConferenceAgent requested function call: getConferences
[2025-04-25T04:16:06.779Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Attempting execution: getConferences
[2025-04-25T04:16:06.779Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 Status Stub] Step: function_call, Msg: Received request to call function: getConferences
[2025-04-25T04:16:06.780Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 OXxFFwlPA_SNDfdaAAAB] Handler: GetConferences, Args: {"searchQuery":"acronym=INFOCOMP&perPage=5&page=1"}
[2025-04-25T04:16:06.780Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 Status Stub] Step: validating_function_args, Msg: Validating arguments for getConferences...
[2025-04-25T04:16:06.781Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 Status Stub] Step: retrieving_info, Msg: Retrieving conference data...
[2025-04-25T04:16:06.781Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=INFOCOMP&perPage=5&page=1
[2025-04-25T04:16:06.912Z] Backend API Success for conference. Data length: 982
[2025-04-25T04:16:06.914Z] Transforming conference data with Markdown. Search query: acronym=INFOCOMP&perPage=5&page=1
[2025-04-25T04:16:06.917Z] Conference data transformed successfully.
[2025-04-25T04:16:06.917Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 OXxFFwlPA_SNDfdaAAAB] API result: Success=true
[2025-04-25T04:16:06.918Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 Status Stub] Step: data_found, Msg: Successfully retrieved and processed conference data.
[2025-04-25T04:16:06.918Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Execution finished for getConferences.
[2025-04-25T04:16:06.918Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000 Status Stub] Step: processing_function_result, Msg: Received result from getConferences.
[2025-04-25T04:16:06.919Z] [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000] Function getConferences executed. Result: **Meta:**
- **Current page:** 1
- **Per page:** 5
- **Total items:** 1
- **Total page:** 1
- **Prev ...
[2025-04-25T04:16:06.919Z] --- [MsgHandler-1745554563696-Sub-ConferenceAgent-1745554566000] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T04:16:06.919Z] [MsgHandler-1745554563696 History Check - Host FC Done 1] Appended function/routing response. History size: 5
[2025-04-25T04:16:06.920Z] --- [MsgHandler-1745554563696 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Sending to Model (History size: 5) ---
[2025-04-25T04:16:06.920Z] [MsgHandler-1745554563696 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:06.925Z] [GeminiService] Received history with 5 items before mapping.
[2025-04-25T04:16:06.925Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 5 items.
[2025-04-25T04:16:06.925Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:16:06.926Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:06.926Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:06.926Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:06.926Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:06.927Z] [GeminiService] Sending total 5 Content items to API.
[2025-04-25T04:16:06.927Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:07.714Z] Model Finish Reason: STOP
[2025-04-25T04:16:07.714Z] Model generated final text response: The website for the International Conference on Advanced Communications and Computation (INFOCOMP) is: https://www.iaria.org/conferences/INFOCOMP.html
...
[2025-04-25T04:16:07.715Z] [MsgHandler-1745554563696 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Received final_text.
[2025-04-25T04:16:07.715Z] [MsgHandler-1745554563696 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:07.716Z] [MsgHandler-1745554563696 History Check - Final] Appended final HostAgent response. History size: 6
[2025-04-25T04:16:07.716Z] [MsgHandler-1745554563696 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:16:07.717Z] --- [MsgHandler-1745554563696 Socket OXxFFwlPA_SNDfdaAAAB Lang: en] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:16:07.717Z] [MsgHandler-1745554563696 Save History Check] History to save. Size: 6.
[2025-04-25T04:16:07.717Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 6
[2025-04-25T04:16:07.778Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:16:07.779Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554563696] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:07.779Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:16:07.923Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:16:07.924Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:16:17.083Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554577083] Event 'send_message' received: UserInput="oke m·ªü website tr√™n ...", Streaming=false, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:16:17.083Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:16:17.084Z] [History Service] Applying message limit: 50
[2025-04-25T04:16:17.135Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 6
[2025-04-25T04:16:17.136Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554577083] Fetched 6 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:17.136Z] --- [MsgHandler-1745554577083 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "oke m·ªü website tr√™n cho t√¥i", Lang: en ---
[2025-04-25T04:16:17.136Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:16:17.137Z] [MsgHandler-1745554577083 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:17.138Z] --- [MsgHandler-1745554577083 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 7) ---
[2025-04-25T04:16:17.142Z] [MsgHandler-1745554577083 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:17.149Z] [GeminiService] Received history with 7 items before mapping.
[2025-04-25T04:16:17.150Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 7 items.
[2025-04-25T04:16:17.152Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:17.160Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:17.162Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:17.165Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:17.166Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:17.167Z] [GeminiService] Sending total 7 Content items to API.
[2025-04-25T04:16:17.167Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:19.161Z] Model Finish Reason: STOP
[2025-04-25T04:16:19.161Z] Model requested function call: routeToAgent
[2025-04-25T04:16:19.161Z] Arguments: {"taskDescription":"Open the website URL: https://www.iaria.org/conferences/INFOCOMP.html in a new tab.","targetAgent":"NavigationAgent","inputData":"https://www.iaria.org/conferences/INFOCOMP.html"}
[2025-04-25T04:16:19.162Z] [MsgHandler-1745554577083 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Requested function call: routeToAgent
[2025-04-25T04:16:19.162Z] [MsgHandler-1745554577083 History Check - Host FC Prep 1] Appended HostAgent FC request. History size: 8
[2025-04-25T04:16:19.163Z] [MsgHandler-1745554577083 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:19.163Z] --- [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: NavigationAgent, Task: a6160986-b70b-4624-99e1-e7eb4fe447bf ---
[2025-04-25T04:16:19.163Z] [Language Config] Using configuration for Agent: NavigationAgent, Language: en
[2025-04-25T04:16:19.163Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163] Sending request to NavigationAgent LLM.
[2025-04-25T04:16:19.164Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:16:19.164Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:16:19.164Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:19.164Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:19.165Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:19.165Z] Tools provided: ["navigation","openGoogleMap"]
[2025-04-25T04:16:19.165Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:19.165Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:16:19.168Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:19.792Z] Model Finish Reason: STOP
[2025-04-25T04:16:19.792Z] Model requested function call: navigation
[2025-04-25T04:16:19.793Z] Arguments: {"url":"https://www.iaria.org/conferences/INFOCOMP.html"}
[2025-04-25T04:16:19.793Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163] Received result from NavigationAgent LLM: Status requires_function_call
[2025-04-25T04:16:19.793Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163] NavigationAgent requested function call: navigation
[2025-04-25T04:16:19.793Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Attempting execution: navigation
[2025-04-25T04:16:19.794Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 Status Stub] Step: function_call, Msg: Received request to call function: navigation
[2025-04-25T04:16:19.794Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 OXxFFwlPA_SNDfdaAAAB] Handler: Navigation, Args: {"url":"https://www.iaria.org/conferences/INFOCOMP.html"}
[2025-04-25T04:16:19.795Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 Status Stub] Step: validating_navigation_url, Msg: Validating navigation URL argument...
[2025-04-25T04:16:19.795Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 OXxFFwlPA_SNDfdaAAAB] Navigation: Valid target URL: https://www.iaria.org/conferences/INFOCOMP.html
[2025-04-25T04:16:19.796Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 Status Stub] Step: navigation_action_prepared, Msg: Navigation action prepared.
[2025-04-25T04:16:19.796Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Execution finished for navigation.
[2025-04-25T04:16:19.796Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163 Status Stub] Step: processing_function_result, Msg: Received result from navigation.
[2025-04-25T04:16:19.796Z] [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163] Function navigation executed. Result: Navigation action acknowledged. The user will be directed to the requested page (https://www.iaria.o...
[2025-04-25T04:16:19.797Z] --- [MsgHandler-1745554577083-Sub-NavigationAgent-1745554579163] Sub Agent NavigationAgent finished. Status: success ---
[2025-04-25T04:16:19.797Z] [MsgHandler-1745554577083] Stored frontendAction returned from NavigationAgent.
[2025-04-25T04:16:19.797Z] [MsgHandler-1745554577083 History Check - Host FC Done 1] Appended function/routing response. History size: 9
[2025-04-25T04:16:19.797Z] --- [MsgHandler-1745554577083 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Sending to Model (History size: 9) ---
[2025-04-25T04:16:19.798Z] [MsgHandler-1745554577083 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:19.798Z] [GeminiService] Received history with 9 items before mapping.
[2025-04-25T04:16:19.798Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 9 items.
[2025-04-25T04:16:19.798Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:16:19.798Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:19.799Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:19.799Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:19.799Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:19.799Z] [GeminiService] Sending total 9 Content items to API.
[2025-04-25T04:16:19.799Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:20.595Z] Model Finish Reason: STOP
[2025-04-25T04:16:20.595Z] Model generated final text response: OK. I have opened the website for you.
...
[2025-04-25T04:16:20.596Z] [MsgHandler-1745554577083 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Received final_text.
[2025-04-25T04:16:20.596Z] [MsgHandler-1745554577083 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:20.596Z] [MsgHandler-1745554577083 History Check - Final] Appended final HostAgent response. History size: 10
[2025-04-25T04:16:20.597Z] [MsgHandler-1745554577083 OXxFFwlPA_SNDfdaAAAB] Attaching frontendAction to final event: {"type":"navigate","url":"https://www.iaria.org/conferences/INFOCOMP.html"}
[2025-04-25T04:16:20.597Z] [MsgHandler-1745554577083 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:16:20.597Z] --- [MsgHandler-1745554577083 Socket OXxFFwlPA_SNDfdaAAAB Lang: en] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:16:20.598Z] [MsgHandler-1745554577083 Save History Check] History to save. Size: 10.
[2025-04-25T04:16:20.598Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 10
[2025-04-25T04:16:20.662Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:16:20.663Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554577083] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:20.663Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:16:20.815Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:16:20.817Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:16:42.359Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554602359] Event 'send_message' received: UserInput="B·∫°n c√≥ th·ªÉ m·ªü websit...", Streaming=false, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:16:42.359Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:16:42.360Z] [History Service] Applying message limit: 50
[2025-04-25T04:16:42.412Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 10
[2025-04-25T04:16:42.412Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554602359] Fetched 10 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:42.413Z] --- [MsgHandler-1745554602359 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "B·∫°n c√≥ th·ªÉ m·ªü website c·ªßa h·ªôi ngh·ªã ACCV cho t√¥i kh√¥ng ?", Lang: en ---
[2025-04-25T04:16:42.413Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:16:42.414Z] [MsgHandler-1745554602359 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:42.414Z] --- [MsgHandler-1745554602359 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 11) ---
[2025-04-25T04:16:42.415Z] [MsgHandler-1745554602359 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:42.415Z] [GeminiService] Received history with 11 items before mapping.
[2025-04-25T04:16:42.415Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 11 items.
[2025-04-25T04:16:42.416Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:42.416Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:42.416Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:42.417Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:42.417Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:42.417Z] [GeminiService] Sending total 11 Content items to API.
[2025-04-25T04:16:42.418Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:44.507Z] Model Finish Reason: STOP
[2025-04-25T04:16:44.508Z] Model requested function call: routeToAgent
[2025-04-25T04:16:44.508Z] Arguments: {"targetAgent":"ConferenceAgent","taskDescription":"Find the website URL for the ACCV conference.","inputData":"Could you please provide the website URL for the ACCV conference?"}
[2025-04-25T04:16:44.508Z] [MsgHandler-1745554602359 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Requested function call: routeToAgent
[2025-04-25T04:16:44.508Z] [MsgHandler-1745554602359 History Check - Host FC Prep 1] Appended HostAgent FC request. History size: 12
[2025-04-25T04:16:44.509Z] [MsgHandler-1745554602359 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:44.509Z] --- [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: ConferenceAgent, Task: 343232a0-2e24-4a71-a2ef-9d958d90bc8d ---
[2025-04-25T04:16:44.510Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: en
[2025-04-25T04:16:44.510Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509] Sending request to ConferenceAgent LLM.
[2025-04-25T04:16:44.512Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:16:44.512Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:16:44.513Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:44.513Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:44.514Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:44.514Z] Tools provided: ["getConferences","followUnfollowItem"]
[2025-04-25T04:16:44.516Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:44.516Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:16:44.516Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:45.482Z] Model Finish Reason: STOP
[2025-04-25T04:16:45.483Z] Model requested function call: getConferences
[2025-04-25T04:16:45.483Z] Arguments: {"searchQuery":"acronym=ACCV&perPage=5&page=1"}
[2025-04-25T04:16:45.483Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T04:16:45.483Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509] ConferenceAgent requested function call: getConferences
[2025-04-25T04:16:45.483Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Attempting execution: getConferences
[2025-04-25T04:16:45.484Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 Status Stub] Step: function_call, Msg: Received request to call function: getConferences
[2025-04-25T04:16:45.484Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 OXxFFwlPA_SNDfdaAAAB] Handler: GetConferences, Args: {"searchQuery":"acronym=ACCV&perPage=5&page=1"}
[2025-04-25T04:16:45.484Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 Status Stub] Step: validating_function_args, Msg: Validating arguments for getConferences...
[2025-04-25T04:16:45.484Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 Status Stub] Step: retrieving_info, Msg: Retrieving conference data...
[2025-04-25T04:16:45.485Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=ACCV&perPage=5&page=1
[2025-04-25T04:16:45.614Z] Backend API Success for conference. Data length: 1642
[2025-04-25T04:16:45.615Z] Transforming conference data with Markdown. Search query: acronym=ACCV&perPage=5&page=1
[2025-04-25T04:16:45.617Z] Conference data transformed successfully.
[2025-04-25T04:16:45.617Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 OXxFFwlPA_SNDfdaAAAB] API result: Success=true
[2025-04-25T04:16:45.617Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 Status Stub] Step: data_found, Msg: Successfully retrieved and processed conference data.
[2025-04-25T04:16:45.618Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Execution finished for getConferences.
[2025-04-25T04:16:45.618Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509 Status Stub] Step: processing_function_result, Msg: Received result from getConferences.
[2025-04-25T04:16:45.618Z] [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509] Function getConferences executed. Result: **Meta:**
- **Current page:** 1
- **Per page:** 5
- **Total items:** 1
- **Total page:** 1
- **Prev ...
[2025-04-25T04:16:45.618Z] --- [MsgHandler-1745554602359-Sub-ConferenceAgent-1745554604509] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T04:16:45.619Z] [MsgHandler-1745554602359 History Check - Host FC Done 1] Appended function/routing response. History size: 13
[2025-04-25T04:16:45.619Z] --- [MsgHandler-1745554602359 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Sending to Model (History size: 13) ---
[2025-04-25T04:16:45.619Z] [MsgHandler-1745554602359 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:45.620Z] [GeminiService] Received history with 13 items before mapping.
[2025-04-25T04:16:45.620Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 13 items.
[2025-04-25T04:16:45.622Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:16:45.622Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:45.622Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:45.623Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:45.623Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:45.623Z] [GeminiService] Sending total 13 Content items to API.
[2025-04-25T04:16:45.623Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:46.553Z] Model Finish Reason: STOP
[2025-04-25T04:16:46.554Z] Model generated final text response: The website for the Asian Conference on Computer Vision (ACCV) is: https://accv2024.org/. Would you like me to open it for you?
...
[2025-04-25T04:16:46.555Z] [MsgHandler-1745554602359 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Received final_text.
[2025-04-25T04:16:46.556Z] [MsgHandler-1745554602359 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:46.557Z] [MsgHandler-1745554602359 History Check - Final] Appended final HostAgent response. History size: 14
[2025-04-25T04:16:46.557Z] [MsgHandler-1745554602359 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:16:46.557Z] --- [MsgHandler-1745554602359 Socket OXxFFwlPA_SNDfdaAAAB Lang: en] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:16:46.557Z] [MsgHandler-1745554602359 Save History Check] History to save. Size: 14.
[2025-04-25T04:16:46.558Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 14
[2025-04-25T04:16:46.622Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:16:46.622Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554602359] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:46.622Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:16:46.764Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:16:46.765Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:16:50.641Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554610641] Event 'send_message' received: UserInput="yes...", Streaming=false, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:16:50.641Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:16:50.642Z] [History Service] Applying message limit: 50
[2025-04-25T04:16:50.693Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 14
[2025-04-25T04:16:50.693Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554610641] Fetched 14 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:50.694Z] --- [MsgHandler-1745554610641 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "yes", Lang: en ---
[2025-04-25T04:16:50.694Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:16:50.695Z] [MsgHandler-1745554610641 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:50.695Z] --- [MsgHandler-1745554610641 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 15) ---
[2025-04-25T04:16:50.695Z] [MsgHandler-1745554610641 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:50.696Z] [GeminiService] Received history with 15 items before mapping.
[2025-04-25T04:16:50.696Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 15 items.
[2025-04-25T04:16:50.700Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:50.701Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:50.701Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:50.701Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:50.702Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:50.702Z] [GeminiService] Sending total 15 Content items to API.
[2025-04-25T04:16:50.702Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:52.578Z] Model Finish Reason: STOP
[2025-04-25T04:16:52.578Z] Model requested function call: routeToAgent
[2025-04-25T04:16:52.579Z] Arguments: {"targetAgent":"NavigationAgent","taskDescription":"Open the website URL: https://accv2024.org/ in a new tab.","inputData":"https://accv2024.org/"}
[2025-04-25T04:16:52.579Z] [MsgHandler-1745554610641 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Requested function call: routeToAgent
[2025-04-25T04:16:52.579Z] [MsgHandler-1745554610641 History Check - Host FC Prep 1] Appended HostAgent FC request. History size: 16
[2025-04-25T04:16:52.580Z] [MsgHandler-1745554610641 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:52.580Z] --- [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: NavigationAgent, Task: 99ceb556-664e-447b-8517-4bda8199d9d9 ---
[2025-04-25T04:16:52.581Z] [Language Config] Using configuration for Agent: NavigationAgent, Language: en
[2025-04-25T04:16:52.581Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580] Sending request to NavigationAgent LLM.
[2025-04-25T04:16:52.581Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:16:52.581Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:16:52.581Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:16:52.581Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:52.582Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:52.582Z] Tools provided: ["navigation","openGoogleMap"]
[2025-04-25T04:16:52.582Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:52.582Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:16:52.582Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:53.335Z] Model Finish Reason: STOP
[2025-04-25T04:16:53.336Z] Model requested function call: navigation
[2025-04-25T04:16:53.336Z] Arguments: {"url":"https://accv2024.org/"}
[2025-04-25T04:16:53.336Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580] Received result from NavigationAgent LLM: Status requires_function_call
[2025-04-25T04:16:53.337Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580] NavigationAgent requested function call: navigation
[2025-04-25T04:16:53.337Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Attempting execution: navigation
[2025-04-25T04:16:53.338Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 Status Stub] Step: function_call, Msg: Received request to call function: navigation
[2025-04-25T04:16:53.338Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 OXxFFwlPA_SNDfdaAAAB] Handler: Navigation, Args: {"url":"https://accv2024.org/"}
[2025-04-25T04:16:53.338Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 Status Stub] Step: validating_navigation_url, Msg: Validating navigation URL argument...
[2025-04-25T04:16:53.339Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 OXxFFwlPA_SNDfdaAAAB] Navigation: Valid target URL: https://accv2024.org/
[2025-04-25T04:16:53.339Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 Status Stub] Step: navigation_action_prepared, Msg: Navigation action prepared.
[2025-04-25T04:16:53.340Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Execution finished for navigation.
[2025-04-25T04:16:53.340Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580 Status Stub] Step: processing_function_result, Msg: Received result from navigation.
[2025-04-25T04:16:53.340Z] [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580] Function navigation executed. Result: Navigation action acknowledged. The user will be directed to the requested page (https://accv2024.or...
[2025-04-25T04:16:53.340Z] --- [MsgHandler-1745554610641-Sub-NavigationAgent-1745554612580] Sub Agent NavigationAgent finished. Status: success ---
[2025-04-25T04:16:53.340Z] [MsgHandler-1745554610641] Stored frontendAction returned from NavigationAgent.
[2025-04-25T04:16:53.341Z] [MsgHandler-1745554610641 History Check - Host FC Done 1] Appended function/routing response. History size: 17
[2025-04-25T04:16:53.341Z] --- [MsgHandler-1745554610641 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Sending to Model (History size: 17) ---
[2025-04-25T04:16:53.341Z] [MsgHandler-1745554610641 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:53.341Z] [GeminiService] Received history with 17 items before mapping.
[2025-04-25T04:16:53.342Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 17 items.
[2025-04-25T04:16:53.342Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:16:53.342Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:16:53.342Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:16:53.343Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:16:53.343Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:16:53.343Z] [GeminiService] Sending total 17 Content items to API.
[2025-04-25T04:16:53.343Z]   - No valid next turn added, sending only history.
[2025-04-25T04:16:54.091Z] Model Finish Reason: STOP
[2025-04-25T04:16:54.091Z] Model generated final text response: I have opened the ACCV conference website for you.
...
[2025-04-25T04:16:54.091Z] [MsgHandler-1745554610641 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 2: Received final_text.
[2025-04-25T04:16:54.092Z] [MsgHandler-1745554610641 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:16:54.092Z] [MsgHandler-1745554610641 History Check - Final] Appended final HostAgent response. History size: 18
[2025-04-25T04:16:54.092Z] [MsgHandler-1745554610641 OXxFFwlPA_SNDfdaAAAB] Attaching frontendAction to final event: {"type":"navigate","url":"https://accv2024.org/"}
[2025-04-25T04:16:54.093Z] [MsgHandler-1745554610641 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:16:54.093Z] --- [MsgHandler-1745554610641 Socket OXxFFwlPA_SNDfdaAAAB Lang: en] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:16:54.093Z] [MsgHandler-1745554610641 Save History Check] History to save. Size: 18.
[2025-04-25T04:16:54.093Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 18
[2025-04-25T04:16:54.161Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:16:54.161Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554610641] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:16:54.161Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:16:54.307Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:16:54.308Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:17:17.910Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554637910] Event 'send_message' received: UserInput="M·ªü website h·ªôi ngh·ªã ...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:17:17.910Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:17:17.910Z] [History Service] Applying message limit: 50
[2025-04-25T04:17:17.963Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 18
[2025-04-25T04:17:17.964Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554637910] Fetched 18 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:17:17.965Z] --- [MsgHandler-1745554637910 Socket OXxFFwlPA_SNDfdaAAAB] Handling STREAMING input: "M·ªü website h·ªôi ngh·ªã SIROCCO", Lang: en ---
[2025-04-25T04:17:17.966Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:17:17.966Z] [MsgHandler-1745554637910] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:17:17.967Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:17.967Z] [MsgHandler-1745554637910 History Init - OXxFFwlPA_SNDfdaAAAB] Added user turn. Size: 19
[2025-04-25T04:17:17.968Z] --- [MsgHandler-1745554637910 HostAgent Turn 1 Start - OXxFFwlPA_SNDfdaAAAB] Requesting initial response from HostAgent ---
[2025-04-25T04:17:17.968Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:17.968Z] [MsgHandler-1745554637910 History T1 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 19
[2025-04-25T04:17:17.970Z] [GeminiService] Received history with 19 items before mapping (for stream).
[2025-04-25T04:17:17.970Z] [GeminiService] Mapped history (SDK Content[]) with 19 items (for stream).
[2025-04-25T04:17:17.971Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:17:17.971Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:17.971Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:17.971Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:17:17.972Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:17.972Z] [GeminiService Stream] Preparing stream request with 19 Content items.
[2025-04-25T04:17:17.972Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:19.012Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:17:19.013Z] [MsgHandler-1745554637910 HostAgent T1 - OXxFFwlPA_SNDfdaAAAB] HostAgent requested function call: routeToAgent
[2025-04-25T04:17:19.013Z] [MsgHandler-1745554637910 History T1 Prep - OXxFFwlPA_SNDfdaAAAB] Appended HostAgent FC request. Size: 20
[2025-04-25T04:17:19.014Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:19.014Z] --- [MsgHandler-1745554637910 SubAgent Call Start - OXxFFwlPA_SNDfdaAAAB] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T04:17:19.014Z] --- [MsgHandler-1745554637910-Sub-ConferenceAgent-1745554639014 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: ConferenceAgent, Task: eab1b1ef-76d5-4462-8ec0-0b9caa260735 ---
[2025-04-25T04:17:19.014Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: en
[2025-04-25T04:17:19.015Z] [MsgHandler-1745554637910-Sub-ConferenceAgent-1745554639014] Sending request to ConferenceAgent LLM.
[2025-04-25T04:17:19.015Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:17:19.015Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:17:19.015Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:17:19.015Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:19.015Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:19.016Z] Tools provided: ["getConferences","followUnfollowItem"]
[2025-04-25T04:17:19.016Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:19.016Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:17:19.016Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:20.061Z] Model Finish Reason: STOP
[2025-04-25T04:17:20.061Z] Model generated final text response: The available tools lack the functionality to directly find the website URL for a conference. I can search for the SIROCCO conference, but I can't extract the website URL from the conference details. Would you like me to search for the SIROCCO conference?
...
[2025-04-25T04:17:20.061Z] [MsgHandler-1745554637910-Sub-ConferenceAgent-1745554639014] Received result from ConferenceAgent LLM: Status final_text
[2025-04-25T04:17:20.062Z] [MsgHandler-1745554637910-Sub-ConferenceAgent-1745554639014] ConferenceAgent provided direct text response (unexpected for PoC): The available tools lack the functionality to directly find the website URL for a conference. I can search for the SIROCCO conference, but I can't extract the website URL from the conference details. Would you like me to search for the SIROCCO conference?

[2025-04-25T04:17:20.062Z] --- [MsgHandler-1745554637910-Sub-ConferenceAgent-1745554639014] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T04:17:20.062Z] --- [MsgHandler-1745554637910 SubAgent Call End - OXxFFwlPA_SNDfdaAAAB] ConferenceAgent finished. Status: success ---
[2025-04-25T04:17:20.062Z] [MsgHandler-1745554637910 History T1 Done - OXxFFwlPA_SNDfdaAAAB] Appended function/routing response to Host history. Size: 21
[2025-04-25T04:17:20.063Z] --- [MsgHandler-1745554637910 HostAgent Turn 2 Start - OXxFFwlPA_SNDfdaAAAB] Requesting final stream from HostAgent ---
[2025-04-25T04:17:20.063Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:20.063Z] [MsgHandler-1745554637910 History T2 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 21
[2025-04-25T04:17:20.064Z] [GeminiService] Received history with 21 items before mapping (for stream).
[2025-04-25T04:17:20.064Z] [GeminiService] Mapped history (SDK Content[]) with 21 items (for stream).
[2025-04-25T04:17:20.064Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:17:20.064Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:20.065Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:20.065Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:17:20.066Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:20.066Z] [GeminiService Stream] Preparing stream request with 21 Content items.
[2025-04-25T04:17:20.066Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:20.727Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:17:20.727Z] [MsgHandler-1745554637910 Stream T2 - OXxFFwlPA_SNDfdaAAAB] Processing final stream from HostAgent...
[2025-04-25T04:17:20.728Z] [MsgHandler-1745554637910 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Starting... (Emit final: true)
[2025-04-25T04:17:20.729Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:20.729Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:20.792Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:20.866Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:20.881Z] [MsgHandler-1745554637910 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Finished. Length: 135
[2025-04-25T04:17:20.881Z] [MsgHandler-1745554637910 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T04:17:20.882Z] [MsgHandler-1745554637910 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:17:20.882Z] [MsgHandler-1745554637910 History T2 Done - OXxFFwlPA_SNDfdaAAAB] Appended final HostAgent response. Size: 22
[2025-04-25T04:17:20.882Z] --- [MsgHandler-1745554637910 OXxFFwlPA_SNDfdaAAAB Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:17:20.883Z] [MsgHandler-1745554637910 Save History Check] History to save. Size: 22.
[2025-04-25T04:17:20.883Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 22
[2025-04-25T04:17:20.947Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:17:20.947Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554637910] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:17:20.948Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:17:21.091Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:17:21.091Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:17:32.091Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554652091] Event 'send_message' received: UserInput="Oke...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:17:32.092Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:17:32.092Z] [History Service] Applying message limit: 50
[2025-04-25T04:17:32.144Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 22
[2025-04-25T04:17:32.144Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554652091] Fetched 22 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:17:32.145Z] --- [MsgHandler-1745554652091 Socket OXxFFwlPA_SNDfdaAAAB] Handling STREAMING input: "Oke", Lang: en ---
[2025-04-25T04:17:32.145Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:17:32.145Z] [MsgHandler-1745554652091] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:17:32.146Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:32.147Z] [MsgHandler-1745554652091 History Init - OXxFFwlPA_SNDfdaAAAB] Added user turn. Size: 23
[2025-04-25T04:17:32.147Z] --- [MsgHandler-1745554652091 HostAgent Turn 1 Start - OXxFFwlPA_SNDfdaAAAB] Requesting initial response from HostAgent ---
[2025-04-25T04:17:32.147Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:32.147Z] [MsgHandler-1745554652091 History T1 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 23
[2025-04-25T04:17:32.148Z] [GeminiService] Received history with 23 items before mapping (for stream).
[2025-04-25T04:17:32.148Z] [GeminiService] Mapped history (SDK Content[]) with 23 items (for stream).
[2025-04-25T04:17:32.148Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:17:32.148Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:32.148Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:32.149Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:17:32.149Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:32.149Z] [GeminiService Stream] Preparing stream request with 23 Content items.
[2025-04-25T04:17:32.149Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:34.015Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:17:34.016Z] [MsgHandler-1745554652091 HostAgent T1 - OXxFFwlPA_SNDfdaAAAB] HostAgent requested function call: routeToAgent
[2025-04-25T04:17:34.016Z] [MsgHandler-1745554652091 History T1 Prep - OXxFFwlPA_SNDfdaAAAB] Appended HostAgent FC request. Size: 24
[2025-04-25T04:17:34.017Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:34.017Z] --- [MsgHandler-1745554652091 SubAgent Call Start - OXxFFwlPA_SNDfdaAAAB] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T04:17:34.017Z] --- [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: ConferenceAgent, Task: d02af107-7e9e-4ca4-bb3d-0d5eb597a53b ---
[2025-04-25T04:17:34.017Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: en
[2025-04-25T04:17:34.018Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017] Sending request to ConferenceAgent LLM.
[2025-04-25T04:17:34.018Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:17:34.019Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:17:34.020Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:17:34.020Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:34.020Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:34.021Z] Tools provided: ["getConferences","followUnfollowItem"]
[2025-04-25T04:17:34.021Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:34.021Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:17:34.022Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:34.873Z] Model Finish Reason: STOP
[2025-04-25T04:17:34.873Z] Model requested function call: getConferences
[2025-04-25T04:17:34.873Z] Arguments: {"searchQuery":"acronym=SIROCCO&perPage=5&page=1"}
[2025-04-25T04:17:34.874Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T04:17:34.874Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017] ConferenceAgent requested function call: getConferences
[2025-04-25T04:17:34.874Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Attempting execution: getConferences
[2025-04-25T04:17:34.874Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 Status Stub] Step: function_call, Msg: Received request to call function: getConferences
[2025-04-25T04:17:34.875Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 OXxFFwlPA_SNDfdaAAAB] Handler: GetConferences, Args: {"searchQuery":"acronym=SIROCCO&perPage=5&page=1"}
[2025-04-25T04:17:34.875Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 Status Stub] Step: validating_function_args, Msg: Validating arguments for getConferences...
[2025-04-25T04:17:34.875Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 Status Stub] Step: retrieving_info, Msg: Retrieving conference data...
[2025-04-25T04:17:34.875Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=SIROCCO&perPage=5&page=1
[2025-04-25T04:17:35.015Z] Backend API Success for conference. Data length: 1546
[2025-04-25T04:17:35.015Z] Transforming conference data with Markdown. Search query: acronym=SIROCCO&perPage=5&page=1
[2025-04-25T04:17:35.017Z] Conference data transformed successfully.
[2025-04-25T04:17:35.017Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 OXxFFwlPA_SNDfdaAAAB] API result: Success=true
[2025-04-25T04:17:35.019Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 Status Stub] Step: data_found, Msg: Successfully retrieved and processed conference data.
[2025-04-25T04:17:35.020Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Execution finished for getConferences.
[2025-04-25T04:17:35.020Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017 Status Stub] Step: processing_function_result, Msg: Received result from getConferences.
[2025-04-25T04:17:35.020Z] [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017] Function getConferences executed. Result: **Meta:**
- **Current page:** 1
- **Per page:** 5
- **Total items:** 1
- **Total page:** 1
- **Prev ...
[2025-04-25T04:17:35.020Z] --- [MsgHandler-1745554652091-Sub-ConferenceAgent-1745554654017] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T04:17:35.021Z] --- [MsgHandler-1745554652091 SubAgent Call End - OXxFFwlPA_SNDfdaAAAB] ConferenceAgent finished. Status: success ---
[2025-04-25T04:17:35.021Z] [MsgHandler-1745554652091 History T1 Done - OXxFFwlPA_SNDfdaAAAB] Appended function/routing response to Host history. Size: 25
[2025-04-25T04:17:35.021Z] --- [MsgHandler-1745554652091 HostAgent Turn 2 Start - OXxFFwlPA_SNDfdaAAAB] Requesting final stream from HostAgent ---
[2025-04-25T04:17:35.022Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:35.022Z] [MsgHandler-1745554652091 History T2 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 25
[2025-04-25T04:17:35.022Z] [GeminiService] Received history with 25 items before mapping (for stream).
[2025-04-25T04:17:35.023Z] [GeminiService] Mapped history (SDK Content[]) with 25 items (for stream).
[2025-04-25T04:17:35.023Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:17:35.023Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:35.023Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:35.023Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:17:35.024Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:35.024Z] [GeminiService Stream] Preparing stream request with 25 Content items.
[2025-04-25T04:17:35.024Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:35.646Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:17:35.647Z] [MsgHandler-1745554652091 Stream T2 - OXxFFwlPA_SNDfdaAAAB] Processing final stream from HostAgent...
[2025-04-25T04:17:35.647Z] [MsgHandler-1745554652091 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Starting... (Emit final: true)
[2025-04-25T04:17:35.647Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:35.648Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:35.729Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:35.795Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:35.916Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:36.036Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:36.221Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:36.264Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:36.283Z] [MsgHandler-1745554652091 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Finished. Length: 524
[2025-04-25T04:17:36.283Z] [MsgHandler-1745554652091 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T04:17:36.284Z] [MsgHandler-1745554652091 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:17:36.285Z] [MsgHandler-1745554652091 History T2 Done - OXxFFwlPA_SNDfdaAAAB] Appended final HostAgent response. Size: 26
[2025-04-25T04:17:36.286Z] --- [MsgHandler-1745554652091 OXxFFwlPA_SNDfdaAAAB Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:17:36.286Z] [MsgHandler-1745554652091 Save History Check] History to save. Size: 26.
[2025-04-25T04:17:36.287Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 26
[2025-04-25T04:17:36.358Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:17:36.359Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554652091] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:17:36.359Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:17:36.506Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:17:36.507Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:17:40.473Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554660473] Event 'send_message' received: UserInput="Yes...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0a7a267cbec76631b556
[2025-04-25T04:17:40.473Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:17:40.473Z] [History Service] Applying message limit: 50
[2025-04-25T04:17:40.526Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 26
[2025-04-25T04:17:40.526Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554660473] Fetched 26 history items for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:17:40.526Z] --- [MsgHandler-1745554660473 Socket OXxFFwlPA_SNDfdaAAAB] Handling STREAMING input: "Yes", Lang: en ---
[2025-04-25T04:17:40.527Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:17:40.527Z] [MsgHandler-1745554660473] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:17:40.527Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:40.528Z] [MsgHandler-1745554660473 History Init - OXxFFwlPA_SNDfdaAAAB] Added user turn. Size: 27
[2025-04-25T04:17:40.528Z] --- [MsgHandler-1745554660473 HostAgent Turn 1 Start - OXxFFwlPA_SNDfdaAAAB] Requesting initial response from HostAgent ---
[2025-04-25T04:17:40.528Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:40.528Z] [MsgHandler-1745554660473 History T1 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 27
[2025-04-25T04:17:40.529Z] [GeminiService] Received history with 27 items before mapping (for stream).
[2025-04-25T04:17:40.529Z] [GeminiService] Mapped history (SDK Content[]) with 27 items (for stream).
[2025-04-25T04:17:40.529Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:17:40.530Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:40.530Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:40.530Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:17:40.530Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:40.531Z] [GeminiService Stream] Preparing stream request with 27 Content items.
[2025-04-25T04:17:40.531Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:41.559Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:17:41.559Z] [MsgHandler-1745554660473 HostAgent T1 - OXxFFwlPA_SNDfdaAAAB] HostAgent requested function call: routeToAgent
[2025-04-25T04:17:41.560Z] [MsgHandler-1745554660473 History T1 Prep - OXxFFwlPA_SNDfdaAAAB] Appended HostAgent FC request. Size: 28
[2025-04-25T04:17:41.560Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:41.560Z] --- [MsgHandler-1745554660473 SubAgent Call Start - OXxFFwlPA_SNDfdaAAAB] Calling NavigationAgent via callSubAgent ---
[2025-04-25T04:17:41.561Z] --- [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: NavigationAgent, Task: d089b3cc-8833-49ee-82e5-582764122488 ---
[2025-04-25T04:17:41.561Z] [Language Config] Using configuration for Agent: NavigationAgent, Language: en
[2025-04-25T04:17:41.561Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561] Sending request to NavigationAgent LLM.
[2025-04-25T04:17:41.561Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:17:41.562Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:17:41.562Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:17:41.562Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:41.563Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:41.564Z] Tools provided: ["navigation","openGoogleMap"]
[2025-04-25T04:17:41.564Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:41.565Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:17:41.565Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:42.407Z] Model Finish Reason: STOP
[2025-04-25T04:17:42.407Z] Model requested function call: navigation
[2025-04-25T04:17:42.407Z] Arguments: {"url":"https://www.torontomu.ca/sirocco-2025/"}
[2025-04-25T04:17:42.408Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561] Received result from NavigationAgent LLM: Status requires_function_call
[2025-04-25T04:17:42.408Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561] NavigationAgent requested function call: navigation
[2025-04-25T04:17:42.408Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Attempting execution: navigation
[2025-04-25T04:17:42.408Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 Status Stub] Step: function_call, Msg: Received request to call function: navigation
[2025-04-25T04:17:42.409Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 OXxFFwlPA_SNDfdaAAAB] Handler: Navigation, Args: {"url":"https://www.torontomu.ca/sirocco-2025/"}
[2025-04-25T04:17:42.409Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 Status Stub] Step: validating_navigation_url, Msg: Validating navigation URL argument...
[2025-04-25T04:17:42.409Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 OXxFFwlPA_SNDfdaAAAB] Navigation: Valid target URL: https://www.torontomu.ca/sirocco-2025/
[2025-04-25T04:17:42.409Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 Status Stub] Step: navigation_action_prepared, Msg: Navigation action prepared.
[2025-04-25T04:17:42.409Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Execution finished for navigation.
[2025-04-25T04:17:42.410Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561 Status Stub] Step: processing_function_result, Msg: Received result from navigation.
[2025-04-25T04:17:42.410Z] [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561] Function navigation executed. Result: Navigation action acknowledged. The user will be directed to the requested page (https://www.toronto...
[2025-04-25T04:17:42.410Z] --- [MsgHandler-1745554660473-Sub-NavigationAgent-1745554661561] Sub Agent NavigationAgent finished. Status: success ---
[2025-04-25T04:17:42.410Z] --- [MsgHandler-1745554660473 SubAgent Call End - OXxFFwlPA_SNDfdaAAAB] NavigationAgent finished. Status: success ---
[2025-04-25T04:17:42.411Z] [MsgHandler-1745554660473 OXxFFwlPA_SNDfdaAAAB] Stored frontendAction from NavigationAgent.
[2025-04-25T04:17:42.411Z] [MsgHandler-1745554660473 History T1 Done - OXxFFwlPA_SNDfdaAAAB] Appended function/routing response to Host history. Size: 29
[2025-04-25T04:17:42.411Z] --- [MsgHandler-1745554660473 HostAgent Turn 2 Start - OXxFFwlPA_SNDfdaAAAB] Requesting final stream from HostAgent ---
[2025-04-25T04:17:42.412Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:42.412Z] [MsgHandler-1745554660473 History T2 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 29
[2025-04-25T04:17:42.413Z] [GeminiService] Received history with 29 items before mapping (for stream).
[2025-04-25T04:17:42.413Z] [GeminiService] Mapped history (SDK Content[]) with 29 items (for stream).
[2025-04-25T04:17:42.413Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:17:42.414Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:17:42.414Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:17:42.414Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:17:42.415Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:17:42.415Z] [GeminiService Stream] Preparing stream request with 29 Content items.
[2025-04-25T04:17:42.416Z]   - No valid next turn added, sending only history.
[2025-04-25T04:17:42.975Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:17:42.975Z] [MsgHandler-1745554660473 Stream T2 - OXxFFwlPA_SNDfdaAAAB] Processing final stream from HostAgent...
[2025-04-25T04:17:42.976Z] [MsgHandler-1745554660473 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Starting... (Emit final: true)
[2025-04-25T04:17:42.976Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:17:42.976Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:43.029Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:17:43.044Z] [MsgHandler-1745554660473 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Finished. Length: 58
[2025-04-25T04:17:43.044Z] [MsgHandler-1745554660473 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T04:17:43.045Z] [MsgHandler-1745554660473 OXxFFwlPA_SNDfdaAAAB] Attaching frontendAction to final stream event: {"type":"navigate","url":"https://www.torontomu.ca/sirocco-2025/"}
[2025-04-25T04:17:43.045Z] [MsgHandler-1745554660473 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:17:43.046Z] [MsgHandler-1745554660473 History T2 Done - OXxFFwlPA_SNDfdaAAAB] Appended final HostAgent response. Size: 30
[2025-04-25T04:17:43.046Z] --- [MsgHandler-1745554660473 OXxFFwlPA_SNDfdaAAAB Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:17:43.046Z] [MsgHandler-1745554660473 Save History Check] History to save. Size: 30.
[2025-04-25T04:17:43.046Z] [History Service] Updating history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 30
[2025-04-25T04:17:43.115Z] [History Service] Successfully updated history for conversationId: 680b0a7a267cbec76631b556. Modified: true
[2025-04-25T04:17:43.115Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554660473] Successfully updated history in DB for conv 680b0a7a267cbec76631b556.
[2025-04-25T04:17:43.115Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:17:43.263Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:17:43.264Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:19:59.015Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'load_conversation' received for ID: 6808c6b8af360b2a2e0d3fb2, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:19:59.016Z] [History Service] Getting history for conversationId: 6808c6b8af360b2a2e0d3fb2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:19:59.016Z] [History Service] Applying message limit: 50
[2025-04-25T04:19:59.119Z] [History Service] Found history for conversationId: 6808c6b8af360b2a2e0d3fb2. Message count: 34
[2025-04-25T04:19:59.121Z] [Socket OXxFFwlPA_SNDfdaAAAB] Sent history for conversation 6808c6b8af360b2a2e0d3fb2. Set as active.
[2025-04-25T04:19:59.375Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'load_conversation' received for ID: 680b0a7a267cbec76631b556, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:19:59.375Z] [History Service] Getting history for conversationId: 680b0a7a267cbec76631b556, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:19:59.376Z] [History Service] Applying message limit: 50
[2025-04-25T04:19:59.433Z] [History Service] Found history for conversationId: 680b0a7a267cbec76631b556. Message count: 30
[2025-04-25T04:19:59.434Z] [Socket OXxFFwlPA_SNDfdaAAAB] Sent history for conversation 680b0a7a267cbec76631b556. Set as active.
[2025-04-25T04:20:05.190Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'load_conversation' received for ID: 6808895a0497292069e64084, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:20:05.190Z] [History Service] Getting history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:20:05.191Z] [History Service] Applying message limit: 50
[2025-04-25T04:20:05.241Z] [History Service] Found history for conversationId: 6808895a0497292069e64084. Message count: 16
[2025-04-25T04:20:05.242Z] [Socket OXxFFwlPA_SNDfdaAAAB] Sent history for conversation 6808895a0497292069e64084. Set as active.
[2025-04-25T04:20:21.632Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554821632] Event 'send_message' received: UserInput="B·∫°n ƒë√£ li·ªát k√™ c√°c h...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=6808895a0497292069e64084
[2025-04-25T04:20:21.633Z] [History Service] Getting history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:20:21.633Z] [History Service] Applying message limit: 50
[2025-04-25T04:20:21.684Z] [History Service] Found history for conversationId: 6808895a0497292069e64084. Message count: 16
[2025-04-25T04:20:21.684Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554821632] Fetched 16 history items for conv 6808895a0497292069e64084.
[2025-04-25T04:20:21.684Z] --- [MsgHandler-1745554821632 Socket OXxFFwlPA_SNDfdaAAAB] Handling STREAMING input: "B·∫°n ƒë√£ li·ªát k√™ c√°c h·ªôi ngh·ªã n√†o ?", Lang: en ---
[2025-04-25T04:20:21.685Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:20:21.685Z] [MsgHandler-1745554821632] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:20:21.685Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:21.686Z] [MsgHandler-1745554821632 History Init - OXxFFwlPA_SNDfdaAAAB] Added user turn. Size: 17
[2025-04-25T04:20:21.686Z] --- [MsgHandler-1745554821632 HostAgent Turn 1 Start - OXxFFwlPA_SNDfdaAAAB] Requesting initial response from HostAgent ---
[2025-04-25T04:20:21.686Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:21.686Z] [MsgHandler-1745554821632 History T1 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 17
[2025-04-25T04:20:21.687Z] [GeminiService] Received history with 17 items before mapping (for stream).
[2025-04-25T04:20:21.687Z] [GeminiService] Mapped history (SDK Content[]) with 17 items (for stream).
[2025-04-25T04:20:21.687Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:20:21.687Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:20:21.687Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:20:21.688Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:20:21.688Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:20:21.688Z] [GeminiService Stream] Preparing stream request with 17 Content items.
[2025-04-25T04:20:21.688Z]   - No valid next turn added, sending only history.
[2025-04-25T04:20:22.486Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:20:22.486Z] [MsgHandler-1745554821632 Stream T1 Direct - OXxFFwlPA_SNDfdaAAAB] HostAgent provided stream directly. Processing...
[2025-04-25T04:20:22.487Z] [MsgHandler-1745554821632 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Starting... (Emit final: true)
[2025-04-25T04:20:22.487Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:22.487Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:22.618Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:22.747Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:22.904Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:22.917Z] [MsgHandler-1745554821632 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Finished. Length: 251
[2025-04-25T04:20:22.918Z] [MsgHandler-1745554821632 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T04:20:22.918Z] [MsgHandler-1745554821632 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:20:22.918Z] [MsgHandler-1745554821632 History T1 Direct Done - OXxFFwlPA_SNDfdaAAAB] Appended initial HostAgent response. Size: 18
[2025-04-25T04:20:22.919Z] --- [MsgHandler-1745554821632 OXxFFwlPA_SNDfdaAAAB Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:20:22.919Z] [MsgHandler-1745554821632 Save History Check] History to save. Size: 18.
[2025-04-25T04:20:22.919Z] [History Service] Updating history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 18
[2025-04-25T04:20:22.989Z] [History Service] Successfully updated history for conversationId: 6808895a0497292069e64084. Modified: true
[2025-04-25T04:20:22.989Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554821632] Successfully updated history in DB for conv 6808895a0497292069e64084.
[2025-04-25T04:20:22.990Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:20:23.129Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:20:23.130Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:20:31.097Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554831097] Event 'send_message' received: UserInput="ƒë√∫ng v·∫≠y...", Streaming=true, Lang=en, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=6808895a0497292069e64084
[2025-04-25T04:20:31.098Z] [History Service] Getting history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:20:31.098Z] [History Service] Applying message limit: 50
[2025-04-25T04:20:31.147Z] [History Service] Found history for conversationId: 6808895a0497292069e64084. Message count: 18
[2025-04-25T04:20:31.148Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554831097] Fetched 18 history items for conv 6808895a0497292069e64084.
[2025-04-25T04:20:31.148Z] --- [MsgHandler-1745554831097 Socket OXxFFwlPA_SNDfdaAAAB] Handling STREAMING input: "ƒë√∫ng v·∫≠y", Lang: en ---
[2025-04-25T04:20:31.148Z] [Language Config] Using configuration for Agent: HostAgent, Language: en
[2025-04-25T04:20:31.148Z] [MsgHandler-1745554831097] Using HostAgent Config (Lang: en). Tools: routeToAgent
[2025-04-25T04:20:31.149Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:31.149Z] [MsgHandler-1745554831097 History Init - OXxFFwlPA_SNDfdaAAAB] Added user turn. Size: 19
[2025-04-25T04:20:31.149Z] --- [MsgHandler-1745554831097 HostAgent Turn 1 Start - OXxFFwlPA_SNDfdaAAAB] Requesting initial response from HostAgent ---
[2025-04-25T04:20:31.149Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:31.150Z] [MsgHandler-1745554831097 History T1 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 19
[2025-04-25T04:20:31.150Z] [GeminiService] Received history with 19 items before mapping (for stream).
[2025-04-25T04:20:31.150Z] [GeminiService] Mapped history (SDK Content[]) with 19 items (for stream).
[2025-04-25T04:20:31.150Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:20:31.150Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:20:31.151Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:20:31.151Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:20:31.151Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:20:31.151Z] [GeminiService Stream] Preparing stream request with 19 Content items.
[2025-04-25T04:20:31.151Z]   - No valid next turn added, sending only history.
[2025-04-25T04:20:33.073Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T04:20:33.074Z] [MsgHandler-1745554831097 HostAgent T1 - OXxFFwlPA_SNDfdaAAAB] HostAgent requested function call: routeToAgent
[2025-04-25T04:20:33.074Z] [MsgHandler-1745554831097 History T1 Prep - OXxFFwlPA_SNDfdaAAAB] Appended HostAgent FC request. Size: 20
[2025-04-25T04:20:33.075Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:33.075Z] --- [MsgHandler-1745554831097 SubAgent Call Start - OXxFFwlPA_SNDfdaAAAB] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T04:20:33.075Z] --- [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 Socket OXxFFwlPA_SNDfdaAAAB] Calling Sub Agent: ConferenceAgent, Task: 37f99184-a8e5-4fe9-b7cf-49033be91646 ---
[2025-04-25T04:20:33.076Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: en
[2025-04-25T04:20:33.076Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075] Sending request to ConferenceAgent LLM.
[2025-04-25T04:20:33.077Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T04:20:33.077Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T04:20:33.077Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:20:33.078Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:20:33.078Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:20:33.078Z] Tools provided: ["getConferences","followUnfollowItem"]
[2025-04-25T04:20:33.079Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:20:33.079Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T04:20:33.079Z]   - No valid next turn added, sending only history.
[2025-04-25T04:20:33.864Z] Model Finish Reason: STOP
[2025-04-25T04:20:33.865Z] Model requested function call: getConferences
[2025-04-25T04:20:33.865Z] Arguments: {"searchQuery":"country=United+States&perPage=5&page=1"}
[2025-04-25T04:20:33.865Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T04:20:33.865Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075] ConferenceAgent requested function call: getConferences
[2025-04-25T04:20:33.865Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Attempting execution: getConferences
[2025-04-25T04:20:33.866Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 Status Stub] Step: function_call, Msg: Received request to call function: getConferences
[2025-04-25T04:20:33.866Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 OXxFFwlPA_SNDfdaAAAB] Handler: GetConferences, Args: {"searchQuery":"country=United+States&perPage=5&page=1"}
[2025-04-25T04:20:33.866Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 Status Stub] Step: validating_function_args, Msg: Validating arguments for getConferences...
[2025-04-25T04:20:33.866Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 Status Stub] Step: retrieving_info, Msg: Retrieving conference data...
[2025-04-25T04:20:33.867Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?country=United+States&perPage=5&page=1
[2025-04-25T04:20:34.162Z] Backend API Success for conference. Data length: 5728
[2025-04-25T04:20:34.162Z] Transforming conference data with Markdown. Search query: country=United+States&perPage=5&page=1
[2025-04-25T04:20:34.170Z] Conference data transformed successfully.
[2025-04-25T04:20:34.170Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 OXxFFwlPA_SNDfdaAAAB] API result: Success=true
[2025-04-25T04:20:34.170Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 Status Stub] Step: data_found, Msg: Successfully retrieved and processed conference data.
[2025-04-25T04:20:34.170Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 OXxFFwlPA_SNDfdaAAAB] FunctionRegistry: Execution finished for getConferences.
[2025-04-25T04:20:34.171Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075 Status Stub] Step: processing_function_result, Msg: Received result from getConferences.
[2025-04-25T04:20:34.171Z] [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075] Function getConferences executed. Result: **Meta:**
- **Current page:** 1
- **Per page:** 5
- **Total items:** 134
- **Total page:** 27
- **Pr...
[2025-04-25T04:20:34.171Z] --- [MsgHandler-1745554831097-Sub-ConferenceAgent-1745554833075] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T04:20:34.171Z] --- [MsgHandler-1745554831097 SubAgent Call End - OXxFFwlPA_SNDfdaAAAB] ConferenceAgent finished. Status: success ---
[2025-04-25T04:20:34.171Z] [MsgHandler-1745554831097 History T1 Done - OXxFFwlPA_SNDfdaAAAB] Appended function/routing response to Host history. Size: 21
[2025-04-25T04:20:34.172Z] --- [MsgHandler-1745554831097 HostAgent Turn 2 Start - OXxFFwlPA_SNDfdaAAAB] Requesting final stream from HostAgent ---
[2025-04-25T04:20:34.172Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:34.172Z] [MsgHandler-1745554831097 History T2 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 21
[2025-04-25T04:20:34.172Z] [GeminiService] Received history with 21 items before mapping (for stream).
[2025-04-25T04:20:34.173Z] [GeminiService] Mapped history (SDK Content[]) with 21 items (for stream).
[2025-04-25T04:20:34.173Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T04:20:34.173Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:20:34.174Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:20:34.174Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:20:34.174Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:20:34.174Z] [GeminiService Stream] Preparing stream request with 21 Content items.
[2025-04-25T04:20:34.174Z]   - No valid next turn added, sending only history.
[2025-04-25T04:20:34.831Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:20:34.831Z] [MsgHandler-1745554831097 Stream T2 - OXxFFwlPA_SNDfdaAAAB] Processing final stream from HostAgent...
[2025-04-25T04:20:34.831Z] [MsgHandler-1745554831097 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Starting... (Emit final: true)
[2025-04-25T04:20:34.832Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:20:34.832Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:34.940Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:35.023Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:35.183Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:35.348Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:35.569Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:35.802Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:36.055Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:36.336Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:36.604Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:36.875Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:37.150Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:37.443Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:37.706Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:37.988Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:38.264Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:38.503Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:38.772Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:39.084Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:39.335Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:39.612Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:39.703Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:20:39.714Z] [MsgHandler-1745554831097 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Finished. Length: 3849
[2025-04-25T04:20:39.715Z] [MsgHandler-1745554831097 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T04:20:39.715Z] [MsgHandler-1745554831097 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:20:39.716Z] [MsgHandler-1745554831097 History T2 Done - OXxFFwlPA_SNDfdaAAAB] Appended final HostAgent response. Size: 22
[2025-04-25T04:20:39.716Z] --- [MsgHandler-1745554831097 OXxFFwlPA_SNDfdaAAAB Lang: en] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:20:39.716Z] [MsgHandler-1745554831097 Save History Check] History to save. Size: 22.
[2025-04-25T04:20:39.717Z] [History Service] Updating history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 22
[2025-04-25T04:20:39.785Z] [History Service] Successfully updated history for conversationId: 6808895a0497292069e64084. Modified: true
[2025-04-25T04:20:39.785Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554831097] Successfully updated history in DB for conv 6808895a0497292069e64084.
[2025-04-25T04:20:39.785Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:20:39.928Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:20:39.929Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:22:18.562Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554938562] Event 'send_message' received: UserInput="Hello...", Streaming=true, Lang=zh, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=6808895a0497292069e64084
[2025-04-25T04:22:18.563Z] [History Service] Getting history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:22:18.563Z] [History Service] Applying message limit: 50
[2025-04-25T04:22:18.657Z] [History Service] Found history for conversationId: 6808895a0497292069e64084. Message count: 22
[2025-04-25T04:22:18.657Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554938562] Fetched 22 history items for conv 6808895a0497292069e64084.
[2025-04-25T04:22:18.657Z] --- [MsgHandler-1745554938562 Socket OXxFFwlPA_SNDfdaAAAB] Handling STREAMING input: "Hello", Lang: zh ---
[2025-04-25T04:22:18.657Z] [Language Config] WARN: Config not found for language "zh" in agent "HostAgent". Falling back to default language "en" for this agent.
[2025-04-25T04:22:18.658Z] [MsgHandler-1745554938562] Using HostAgent Config (Lang: zh). Tools: routeToAgent
[2025-04-25T04:22:18.658Z] [MsgHandler-1745554938562 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:22:18.658Z] [MsgHandler-1745554938562 History Init - OXxFFwlPA_SNDfdaAAAB] Added user turn. Size: 23
[2025-04-25T04:22:18.659Z] --- [MsgHandler-1745554938562 HostAgent Turn 1 Start - OXxFFwlPA_SNDfdaAAAB] Requesting initial response from HostAgent ---
[2025-04-25T04:22:18.659Z] [MsgHandler-1745554938562 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:22:18.659Z] [MsgHandler-1745554938562 History T1 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 23
[2025-04-25T04:22:18.659Z] [GeminiService] Received history with 23 items before mapping (for stream).
[2025-04-25T04:22:18.660Z] [GeminiService] Mapped history (SDK Content[]) with 23 items (for stream).
[2025-04-25T04:22:18.660Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:22:18.660Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:22:18.660Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:22:18.660Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:22:18.661Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:22:18.661Z] [GeminiService Stream] Preparing stream request with 23 Content items.
[2025-04-25T04:22:18.661Z]   - No valid next turn added, sending only history.
[2025-04-25T04:22:19.645Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:22:19.646Z] [MsgHandler-1745554938562 Stream T1 Direct - OXxFFwlPA_SNDfdaAAAB] HostAgent provided stream directly. Processing...
[2025-04-25T04:22:19.646Z] [MsgHandler-1745554938562 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Starting... (Emit final: true)
[2025-04-25T04:22:19.647Z] [MsgHandler-1745554938562 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:22:19.647Z] [MsgHandler-1745554938562 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:22:19.743Z] [MsgHandler-1745554938562 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:22:19.755Z] [MsgHandler-1745554938562 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Finished. Length: 35
[2025-04-25T04:22:19.756Z] [MsgHandler-1745554938562 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T04:22:19.757Z] [MsgHandler-1745554938562 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:22:19.757Z] [MsgHandler-1745554938562 History T1 Direct Done - OXxFFwlPA_SNDfdaAAAB] Appended initial HostAgent response. Size: 24
[2025-04-25T04:22:19.757Z] --- [MsgHandler-1745554938562 OXxFFwlPA_SNDfdaAAAB Lang: zh] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:22:19.758Z] [MsgHandler-1745554938562 Save History Check] History to save. Size: 24.
[2025-04-25T04:22:19.758Z] [History Service] Updating history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 24
[2025-04-25T04:22:19.817Z] [History Service] Successfully updated history for conversationId: 6808895a0497292069e64084. Modified: true
[2025-04-25T04:22:19.818Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554938562] Successfully updated history in DB for conv 6808895a0497292069e64084.
[2025-04-25T04:22:19.818Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:22:19.962Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:22:19.963Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:22:49.833Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554969833] Event 'send_message' received: UserInput="sao b·∫°n kh√¥ng tr·∫£ l·ªù...", Streaming=false, Lang=zh, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=6808895a0497292069e64084
[2025-04-25T04:22:49.834Z] [History Service] Getting history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:22:49.834Z] [History Service] Applying message limit: 50
[2025-04-25T04:22:49.930Z] [History Service] Found history for conversationId: 6808895a0497292069e64084. Message count: 24
[2025-04-25T04:22:49.931Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554969833] Fetched 24 history items for conv 6808895a0497292069e64084.
[2025-04-25T04:22:49.931Z] --- [MsgHandler-1745554969833 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "sao b·∫°n kh√¥ng tr·∫£ l·ªùi b·∫±ng ti·∫øng trung", Lang: zh ---
[2025-04-25T04:22:49.931Z] [Language Config] WARN: Config not found for language "zh" in agent "HostAgent". Falling back to default language "en" for this agent.
[2025-04-25T04:22:49.932Z] [MsgHandler-1745554969833 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:22:49.932Z] --- [MsgHandler-1745554969833 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 25) ---
[2025-04-25T04:22:49.932Z] [MsgHandler-1745554969833 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:22:49.933Z] [GeminiService] Received history with 25 items before mapping.
[2025-04-25T04:22:49.933Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 25 items.
[2025-04-25T04:22:49.933Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:22:49.933Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:22:49.934Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:22:49.934Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:22:49.934Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:22:49.934Z] [GeminiService] Sending total 25 Content items to API.
[2025-04-25T04:22:49.934Z]   - No valid next turn added, sending only history.
[2025-04-25T04:22:51.038Z] Model Finish Reason: STOP
[2025-04-25T04:22:51.039Z] Model generated final text response: ÂæàÊä±Ê≠âÔºåÊàëÁõÆÂâçÂè™ËÉΩÁî®Ëã±ËØ≠ËøõË°å‰∫§ÊµÅ„ÄÇÊàëÂèØ‰ª•Áî®Ëã±ËØ≠‰∏∫ÊÇ®Êèê‰æõ‰ªª‰ΩïÂ∏ÆÂä©„ÄÇ
...
[2025-04-25T04:22:51.039Z] [MsgHandler-1745554969833 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Received final_text.
[2025-04-25T04:22:51.040Z] [MsgHandler-1745554969833 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:22:51.040Z] [MsgHandler-1745554969833 History Check - Final] Appended final HostAgent response. History size: 26
[2025-04-25T04:22:51.040Z] [MsgHandler-1745554969833 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:22:51.040Z] --- [MsgHandler-1745554969833 Socket OXxFFwlPA_SNDfdaAAAB Lang: zh] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:22:51.041Z] [MsgHandler-1745554969833 Save History Check] History to save. Size: 26.
[2025-04-25T04:22:51.041Z] [History Service] Updating history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 26
[2025-04-25T04:22:51.118Z] [History Service] Successfully updated history for conversationId: 6808895a0497292069e64084. Modified: true
[2025-04-25T04:22:51.118Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554969833] Successfully updated history in DB for conv 6808895a0497292069e64084.
[2025-04-25T04:22:51.119Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:22:51.264Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:22:51.265Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:23:18.742Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554998742] Event 'send_message' received: UserInput="b·∫°n l√† ai...", Streaming=false, Lang=zh, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=6808895a0497292069e64084
[2025-04-25T04:23:18.743Z] [History Service] Getting history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:23:18.743Z] [History Service] Applying message limit: 50
[2025-04-25T04:23:18.840Z] [History Service] Found history for conversationId: 6808895a0497292069e64084. Message count: 26
[2025-04-25T04:23:18.840Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554998742] Fetched 26 history items for conv 6808895a0497292069e64084.
[2025-04-25T04:23:18.840Z] --- [MsgHandler-1745554998742 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "b·∫°n l√† ai", Lang: zh ---
[2025-04-25T04:23:18.841Z] [Language Config] WARN: Config not found for language "zh" in agent "HostAgent". Falling back to default language "en" for this agent.
[2025-04-25T04:23:18.841Z] [MsgHandler-1745554998742 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:23:18.842Z] --- [MsgHandler-1745554998742 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 27) ---
[2025-04-25T04:23:18.842Z] [MsgHandler-1745554998742 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:23:18.842Z] [GeminiService] Received history with 27 items before mapping.
[2025-04-25T04:23:18.843Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 27 items.
[2025-04-25T04:23:18.843Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:23:18.843Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:23:18.843Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:23:18.843Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:23:18.843Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:23:18.844Z] [GeminiService] Sending total 27 Content items to API.
[2025-04-25T04:23:18.844Z]   - No valid next turn added, sending only history.
[2025-04-25T04:23:20.250Z] Model Finish Reason: STOP
[2025-04-25T04:23:20.250Z] Model generated final text response: T√¥i l√† HCMUS Orchestrator, m·ªôt ƒëi·ªÅu ph·ªëi vi√™n t√°c nh√¢n th√¥ng minh cho Global Conference & Journal Hub (GCJH). Vai tr√≤ ch√≠nh c·ªßa t√¥i l√† hi·ªÉu c√°c y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng, x√°c ƒë·ªãnh c√°c b∆∞·ªõc c·∫ßn thi·∫øt, chuy·ªÉn c√°c t√°c v·ª• ƒë·∫øn c√°c t√°c nh√¢n chuy√™n gia ph√π h·ª£p v√† t·ªïng h·ª£p c√°c ph·∫£n h·ªìi c·ªßa h·ªç cho b·∫°n.
...
[2025-04-25T04:23:20.250Z] [MsgHandler-1745554998742 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Received final_text.
[2025-04-25T04:23:20.251Z] [MsgHandler-1745554998742 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:23:20.251Z] [MsgHandler-1745554998742 History Check - Final] Appended final HostAgent response. History size: 28
[2025-04-25T04:23:20.252Z] [MsgHandler-1745554998742 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:23:20.252Z] --- [MsgHandler-1745554998742 Socket OXxFFwlPA_SNDfdaAAAB Lang: zh] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:23:20.252Z] [MsgHandler-1745554998742 Save History Check] History to save. Size: 28.
[2025-04-25T04:23:20.253Z] [History Service] Updating history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 28
[2025-04-25T04:23:20.316Z] [History Service] Successfully updated history for conversationId: 6808895a0497292069e64084. Modified: true
[2025-04-25T04:23:20.317Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745554998742] Successfully updated history in DB for conv 6808895a0497292069e64084.
[2025-04-25T04:23:20.317Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:23:20.457Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:23:20.457Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:23:49.271Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745555029271] Event 'send_message' received: UserInput="soa l·∫°i khong tr·∫£ l·ªù...", Streaming=false, Lang=zh, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=6808895a0497292069e64084
[2025-04-25T04:23:49.271Z] [History Service] Getting history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:23:49.272Z] [History Service] Applying message limit: 50
[2025-04-25T04:23:49.365Z] [History Service] Found history for conversationId: 6808895a0497292069e64084. Message count: 28
[2025-04-25T04:23:49.366Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745555029271] Fetched 28 history items for conv 6808895a0497292069e64084.
[2025-04-25T04:23:49.366Z] --- [MsgHandler-1745555029271 Socket OXxFFwlPA_SNDfdaAAAB] Handling NON-STREAMING input: "soa l·∫°i khong tr·∫£ l·ªùi ti·∫øng trung", Lang: zh ---
[2025-04-25T04:23:49.366Z] [Language Config] WARN: Config not found for language "zh" in agent "HostAgent". Falling back to default language "en" for this agent.
[2025-04-25T04:23:49.367Z] [MsgHandler-1745555029271 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:23:49.367Z] --- [MsgHandler-1745555029271 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Sending to Model (History size: 29) ---
[2025-04-25T04:23:49.368Z] [MsgHandler-1745555029271 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:23:49.369Z] [GeminiService] Received history with 29 items before mapping.
[2025-04-25T04:23:49.369Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 29 items.
[2025-04-25T04:23:49.369Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:23:49.369Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:23:49.369Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:23:49.370Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:23:49.370Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:23:49.370Z] [GeminiService] Sending total 29 Content items to API.
[2025-04-25T04:23:49.370Z]   - No valid next turn added, sending only history.
[2025-04-25T04:23:50.896Z] Model Finish Reason: STOP
[2025-04-25T04:23:50.897Z] Model generated final text response: T√¥i xin l·ªói v√¨ s·ª± b·∫•t ti·ªán n√†y. Hi·ªán t·∫°i, t√¥i ch·ªâ c√≥ th·ªÉ giao ti·∫øp b·∫±ng ti·∫øng Anh. T√¥i v·∫´n ƒëang trong qu√° tr√¨nh h·ªçc h·ªèi v√† ph√°t tri·ªÉn ƒë·ªÉ c√≥ th·ªÉ h·ªó tr·ª£ nhi·ªÅu ng√¥n ng·ªØ h∆°n trong t∆∞∆°ng lai. T√¥i r·∫•t ti·∫øc v√¨ kh√¥ng th·ªÉ ƒë√°p ·ª©ng y√™u c·∫ßu c·ªßa b·∫°n ngay b√¢y gi·ªù.
...
[2025-04-25T04:23:50.897Z] [MsgHandler-1745555029271 Socket OXxFFwlPA_SNDfdaAAAB] HostAgent Turn 1: Received final_text.
[2025-04-25T04:23:50.897Z] [MsgHandler-1745555029271 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:23:50.898Z] [MsgHandler-1745555029271 History Check - Final] Appended final HostAgent response. History size: 30
[2025-04-25T04:23:50.898Z] [MsgHandler-1745555029271 Socket Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:23:50.898Z] --- [MsgHandler-1745555029271 Socket OXxFFwlPA_SNDfdaAAAB Lang: zh] NON-STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:23:50.899Z] [MsgHandler-1745555029271 Save History Check] History to save. Size: 30.
[2025-04-25T04:23:50.899Z] [History Service] Updating history for conversationId: 6808895a0497292069e64084, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 30
[2025-04-25T04:23:50.965Z] [History Service] Successfully updated history for conversationId: 6808895a0497292069e64084. Modified: true
[2025-04-25T04:23:50.965Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745555029271] Successfully updated history in DB for conv 6808895a0497292069e64084.
[2025-04-25T04:23:50.965Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:23:51.116Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:23:51.116Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:24:36.052Z] [Socket OXxFFwlPA_SNDfdaAAAB] Event 'start_new_conversation' received for user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:24:36.052Z] [History Service] Explicitly creating new conversation for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:24:36.123Z] [History Service] Created new conversationId: 680b0e8479c060e4aef9d24e for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:24:36.125Z] [Socket OXxFFwlPA_SNDfdaAAAB] Started new conversation 680b0e8479c060e4aef9d24e. Set as active.
[2025-04-25T04:24:36.125Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:24:36.276Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:24:36.277Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after new conversation start.
[2025-04-25T04:24:48.033Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745555088033] Event 'send_message' received: UserInput="Ch√†o b·∫°n...", Streaming=true, Lang=zh, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b0e8479c060e4aef9d24e
[2025-04-25T04:24:48.034Z] [History Service] Getting history for conversationId: 680b0e8479c060e4aef9d24e, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T04:24:48.035Z] [History Service] Applying message limit: 50
[2025-04-25T04:24:48.095Z] [History Service] Found history for conversationId: 680b0e8479c060e4aef9d24e. Message count: 0
[2025-04-25T04:24:48.096Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745555088033] Fetched 0 history items for conv 680b0e8479c060e4aef9d24e.
[2025-04-25T04:24:48.096Z] --- [MsgHandler-1745555088033 Socket OXxFFwlPA_SNDfdaAAAB] Handling STREAMING input: "Ch√†o b·∫°n", Lang: zh ---
[2025-04-25T04:24:48.096Z] [Language Config] WARN: Config not found for language "zh" in agent "HostAgent". Falling back to default language "en" for this agent.
[2025-04-25T04:24:48.096Z] [MsgHandler-1745555088033] Using HostAgent Config (Lang: zh). Tools: routeToAgent
[2025-04-25T04:24:48.097Z] [MsgHandler-1745555088033 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:24:48.097Z] [MsgHandler-1745555088033 History Init - OXxFFwlPA_SNDfdaAAAB] Added user turn. Size: 1
[2025-04-25T04:24:48.098Z] --- [MsgHandler-1745555088033 HostAgent Turn 1 Start - OXxFFwlPA_SNDfdaAAAB] Requesting initial response from HostAgent ---
[2025-04-25T04:24:48.098Z] [MsgHandler-1745555088033 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:24:48.098Z] [MsgHandler-1745555088033 History T1 Send - OXxFFwlPA_SNDfdaAAAB] Host History Size: 1
[2025-04-25T04:24:48.099Z] [GeminiService] Received history with 1 items before mapping (for stream).
[2025-04-25T04:24:48.099Z] [GeminiService] Mapped history (SDK Content[]) with 1 items (for stream).
[2025-04-25T04:24:48.099Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T04:24:48.099Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T04:24:48.099Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:24:48.100Z] Tools provided: ["routeToAgent"]
[2025-04-25T04:24:48.100Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T04:24:48.100Z] [GeminiService Stream] Preparing stream request with 1 Content items.
[2025-04-25T04:24:48.100Z]   - No valid next turn added, sending only history.
[2025-04-25T04:24:48.938Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T04:24:48.939Z] [MsgHandler-1745555088033 Stream T1 Direct - OXxFFwlPA_SNDfdaAAAB] HostAgent provided stream directly. Processing...
[2025-04-25T04:24:48.939Z] [MsgHandler-1745555088033 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Starting... (Emit final: true)
[2025-04-25T04:24:48.940Z] [MsgHandler-1745555088033 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: status_update, Type: status
[2025-04-25T04:24:48.940Z] [MsgHandler-1745555088033 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:24:49.067Z] [MsgHandler-1745555088033 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_update, Type: partial_result
[2025-04-25T04:24:49.092Z] [MsgHandler-1745555088033 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Finished. Length: 35
[2025-04-25T04:24:49.092Z] [MsgHandler-1745555088033 Stream Processing - OXxFFwlPA_SNDfdaAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T04:24:49.093Z] [MsgHandler-1745555088033 Emit Sent - OXxFFwlPA_SNDfdaAAAB] Event: chat_result, Type: result
[2025-04-25T04:24:49.093Z] [MsgHandler-1745555088033 History T1 Direct Done - OXxFFwlPA_SNDfdaAAAB] Appended initial HostAgent response. Size: 2
[2025-04-25T04:24:49.107Z] --- [MsgHandler-1745555088033 OXxFFwlPA_SNDfdaAAAB Lang: zh] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T04:24:49.115Z] [MsgHandler-1745555088033 Save History Check] History to save. Size: 2.
[2025-04-25T04:24:49.119Z] [History Service] Updating history for conversationId: 680b0e8479c060e4aef9d24e, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 2
[2025-04-25T04:24:49.182Z] [History Service] Successfully updated history for conversationId: 680b0e8479c060e4aef9d24e. Modified: true
[2025-04-25T04:24:49.183Z] [Socket OXxFFwlPA_SNDfdaAAAB MsgHandler-1745555088033] Successfully updated history in DB for conv 680b0e8479c060e4aef9d24e.
[2025-04-25T04:24:49.183Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:24:49.326Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:24:49.327Z] [Socket OXxFFwlPA_SNDfdaAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T04:30:00.887Z] [Cron] Running scheduled log analysis...
[2025-04-25T04:30:00.888Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T04:30:01.030Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T04:30:01.033Z] [Cron] Log analysis finished and results broadcasted.
[2025-04-25T04:34:22.152Z] [Server Config] Loaded PORT: 3001
[2025-04-25T04:34:22.155Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T04:34:22.156Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T04:34:22.156Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:34:22.156Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:34:31.028Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T04:34:31.029Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:34:31.617Z] [Server Start] Initializing loaders...
[2025-04-25T04:34:31.617Z] [Loader] Starting application loading process...
[2025-04-25T04:34:31.618Z] [Loader DB] Attempting database connection...
[2025-04-25T04:34:31.618Z] [Database] Attempting MongoDB connection...
[2025-04-25T04:34:32.351Z] [Database] MongoDB Connected Successfully.
[2025-04-25T04:34:32.351Z] [Loader DB] Database connection successful.
[2025-04-25T04:34:32.352Z] [Loader] Database loaded.
[2025-04-25T04:34:32.352Z] [History Service] Initialized.
[2025-04-25T04:34:32.352Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:34:32.353Z] [Loader] Services initialized.
[2025-04-25T04:34:32.359Z] [Express] Mounted API routes at /api
[2025-04-25T04:34:32.360Z] [Express] Registered Not Found handler.
[2025-04-25T04:34:32.360Z] [Express] Registered Global Error handler.
[2025-04-25T04:34:32.360Z] [Express] Express app configured.
[2025-04-25T04:34:32.362Z] [Loader] Express loaded.
[2025-04-25T04:34:32.362Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T04:34:32.366Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T04:34:32.367Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T04:34:32.367Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T04:34:32.367Z] [Loader] Socket.IO loaded.
[2025-04-25T04:34:32.368Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T04:34:32.368Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T04:34:32.407Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T04:34:32.407Z] [Loader] Jobs scheduled.
[2025-04-25T04:34:32.407Z] [Loader] Performing initial log analysis...
[2025-04-25T04:34:32.408Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T04:34:32.518Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T04:34:32.519Z] [Loader] Initial log analysis completed.
[2025-04-25T04:34:32.519Z] [Loader] All loaders completed successfully.
[2025-04-25T04:34:32.526Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T04:34:32.526Z] üîó Access the server at: http://localhost:3001
[2025-04-25T04:34:32.527Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:34:32.527Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T04:34:33.021Z] [Socket Auth MW] Attempting auth for socket 559OLSLmX3g9OoAoAAAB. Token provided: true
[2025-04-25T04:34:33.026Z] [Socket Auth MW] Token signature validated successfully for socket 559OLSLmX3g9OoAoAAAB.
[2025-04-25T04:34:33.029Z] [Socket.IO 559OLSLmX3g9OoAoAAAB] Client connected. Token present: true
[2025-04-25T04:34:33.029Z] [Socket.IO 559OLSLmX3g9OoAoAAAB] Attempting to fetch user info using token...
[2025-04-25T04:34:33.030Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T04:34:33.224Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:34:33.225Z] [Socket.IO 559OLSLmX3g9OoAoAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T04:34:33.225Z] [Socket.IO 559OLSLmX3g9OoAoAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T04:34:33.226Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:34:33.386Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:34:33.388Z] [Socket.IO 559OLSLmX3g9OoAoAAAB] Sent initial conversation list (8 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:34:33.389Z] [Socket.IO 559OLSLmX3g9OoAoAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T04:34:33.390Z] [Socket 559OLSLmX3g9OoAoAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:34:33.391Z] [Socket 559OLSLmX3g9OoAoAAAB] Core event handlers registered.
[2025-04-25T04:39:35.274Z] [Server Config] Loaded PORT: 3001
[2025-04-25T04:39:35.276Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T04:39:35.276Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T04:39:35.277Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:39:35.278Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:39:42.587Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T04:39:42.588Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:39:43.109Z] [Server Start] Initializing loaders...
[2025-04-25T04:39:43.110Z] [Loader] Starting application loading process...
[2025-04-25T04:39:43.110Z] [Loader DB] Attempting database connection...
[2025-04-25T04:39:43.111Z] [Database] Attempting MongoDB connection...
[2025-04-25T04:39:43.854Z] [Database] MongoDB Connected Successfully.
[2025-04-25T04:39:43.855Z] [Loader DB] Database connection successful.
[2025-04-25T04:39:43.855Z] [Loader] Database loaded.
[2025-04-25T04:39:43.856Z] [History Service] Initialized.
[2025-04-25T04:39:43.856Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:39:43.857Z] [Loader] Services initialized.
[2025-04-25T04:39:43.863Z] [Express] Mounted API routes at /api
[2025-04-25T04:39:43.863Z] [Express] Registered Not Found handler.
[2025-04-25T04:39:43.863Z] [Express] Registered Global Error handler.
[2025-04-25T04:39:43.864Z] [Express] Express app configured.
[2025-04-25T04:39:43.865Z] [Loader] Express loaded.
[2025-04-25T04:39:43.866Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T04:39:43.870Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T04:39:43.870Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T04:39:43.870Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T04:39:43.870Z] [Loader] Socket.IO loaded.
[2025-04-25T04:39:43.871Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T04:39:43.871Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T04:39:43.909Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T04:39:43.909Z] [Loader] Jobs scheduled.
[2025-04-25T04:39:43.910Z] [Loader] Performing initial log analysis...
[2025-04-25T04:39:43.911Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T04:39:44.025Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T04:39:44.026Z] [Loader] Initial log analysis completed.
[2025-04-25T04:39:44.026Z] [Loader] All loaders completed successfully.
[2025-04-25T04:39:44.030Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T04:39:44.031Z] üîó Access the server at: http://localhost:3001
[2025-04-25T04:39:44.031Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:39:44.032Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T04:39:47.020Z] [Socket Auth MW] Attempting auth for socket wVH48gExT3vbeHrvAAAB. Token provided: true
[2025-04-25T04:39:47.026Z] [Socket Auth MW] Token signature validated successfully for socket wVH48gExT3vbeHrvAAAB.
[2025-04-25T04:39:47.028Z] [Socket.IO wVH48gExT3vbeHrvAAAB] Client connected. Token present: true
[2025-04-25T04:39:47.028Z] [Socket.IO wVH48gExT3vbeHrvAAAB] Attempting to fetch user info using token...
[2025-04-25T04:39:47.029Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T04:39:47.220Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:39:47.220Z] [Socket.IO wVH48gExT3vbeHrvAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T04:39:47.220Z] [Socket.IO wVH48gExT3vbeHrvAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T04:39:47.221Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:39:47.397Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:39:47.398Z] [Socket.IO wVH48gExT3vbeHrvAAAB] Sent initial conversation list (8 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:39:47.399Z] [Socket.IO wVH48gExT3vbeHrvAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T04:39:47.400Z] [Socket wVH48gExT3vbeHrvAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:39:47.401Z] [Socket wVH48gExT3vbeHrvAAAB] Core event handlers registered.
[2025-04-25T04:42:03.543Z] [Server Config] Loaded PORT: 3001
[2025-04-25T04:42:03.545Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T04:42:03.545Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T04:42:03.546Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:42:03.546Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:42:11.125Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T04:42:11.126Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:42:11.557Z] [Server Start] Initializing loaders...
[2025-04-25T04:42:11.557Z] [Loader] Starting application loading process...
[2025-04-25T04:42:11.558Z] [Loader DB] Attempting database connection...
[2025-04-25T04:42:11.558Z] [Database] Attempting MongoDB connection...
[2025-04-25T04:42:12.240Z] [Database] MongoDB Connected Successfully.
[2025-04-25T04:42:12.241Z] [Loader DB] Database connection successful.
[2025-04-25T04:42:12.241Z] [Loader] Database loaded.
[2025-04-25T04:42:12.241Z] [History Service] Initialized.
[2025-04-25T04:42:12.242Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:42:12.242Z] [Loader] Services initialized.
[2025-04-25T04:42:12.248Z] [Express] Mounted API routes at /api
[2025-04-25T04:42:12.248Z] [Express] Registered Not Found handler.
[2025-04-25T04:42:12.249Z] [Express] Registered Global Error handler.
[2025-04-25T04:42:12.249Z] [Express] Express app configured.
[2025-04-25T04:42:12.250Z] [Loader] Express loaded.
[2025-04-25T04:42:12.251Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T04:42:12.255Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T04:42:12.255Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T04:42:12.256Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T04:42:12.256Z] [Loader] Socket.IO loaded.
[2025-04-25T04:42:12.256Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T04:42:12.257Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T04:42:12.290Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T04:42:12.291Z] [Loader] Jobs scheduled.
[2025-04-25T04:42:12.291Z] [Loader] Performing initial log analysis...
[2025-04-25T04:42:12.292Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T04:42:12.466Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T04:42:12.466Z] [Loader] Initial log analysis completed.
[2025-04-25T04:42:12.467Z] [Loader] All loaders completed successfully.
[2025-04-25T04:42:12.472Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T04:42:12.473Z] üîó Access the server at: http://localhost:3001
[2025-04-25T04:42:12.474Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:42:12.474Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T04:42:15.044Z] [Socket Auth MW] Attempting auth for socket kbWe4uZVICsps-6LAAAB. Token provided: true
[2025-04-25T04:42:15.050Z] [Socket Auth MW] Token signature validated successfully for socket kbWe4uZVICsps-6LAAAB.
[2025-04-25T04:42:15.051Z] [Socket.IO kbWe4uZVICsps-6LAAAB] Client connected. Token present: true
[2025-04-25T04:42:15.052Z] [Socket.IO kbWe4uZVICsps-6LAAAB] Attempting to fetch user info using token...
[2025-04-25T04:42:15.052Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T04:42:15.157Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:42:15.157Z] [Socket.IO kbWe4uZVICsps-6LAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T04:42:15.157Z] [Socket.IO kbWe4uZVICsps-6LAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T04:42:15.160Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:42:15.360Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:42:15.361Z] [Socket.IO kbWe4uZVICsps-6LAAAB] Sent initial conversation list (8 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:42:15.362Z] [Socket.IO kbWe4uZVICsps-6LAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T04:42:15.363Z] [Socket kbWe4uZVICsps-6LAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:42:15.363Z] [Socket kbWe4uZVICsps-6LAAAB] Core event handlers registered.
[2025-04-25T04:43:18.318Z] [Server Config] Loaded PORT: 3001
[2025-04-25T04:43:18.319Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T04:43:18.319Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T04:43:18.319Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:43:18.320Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:43:25.994Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T04:43:25.994Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T04:43:26.422Z] [Server Start] Initializing loaders...
[2025-04-25T04:43:26.422Z] [Loader] Starting application loading process...
[2025-04-25T04:43:26.423Z] [Loader DB] Attempting database connection...
[2025-04-25T04:43:26.424Z] [Database] Attempting MongoDB connection...
[2025-04-25T04:43:27.089Z] [Database] MongoDB Connected Successfully.
[2025-04-25T04:43:27.090Z] [Loader DB] Database connection successful.
[2025-04-25T04:43:27.090Z] [Loader] Database loaded.
[2025-04-25T04:43:27.090Z] [History Service] Initialized.
[2025-04-25T04:43:27.091Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T04:43:27.091Z] [Loader] Services initialized.
[2025-04-25T04:43:27.099Z] [Express] Mounted API routes at /api
[2025-04-25T04:43:27.100Z] [Express] Registered Not Found handler.
[2025-04-25T04:43:27.100Z] [Express] Registered Global Error handler.
[2025-04-25T04:43:27.101Z] [Express] Express app configured.
[2025-04-25T04:43:27.102Z] [Loader] Express loaded.
[2025-04-25T04:43:27.103Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T04:43:27.109Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T04:43:27.109Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T04:43:27.109Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T04:43:27.109Z] [Loader] Socket.IO loaded.
[2025-04-25T04:43:27.110Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T04:43:27.110Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T04:43:27.160Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T04:43:27.161Z] [Loader] Jobs scheduled.
[2025-04-25T04:43:27.161Z] [Loader] Performing initial log analysis...
[2025-04-25T04:43:27.165Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T04:43:27.285Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T04:43:27.286Z] [Loader] Initial log analysis completed.
[2025-04-25T04:43:27.286Z] [Loader] All loaders completed successfully.
[2025-04-25T04:43:27.290Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T04:43:27.291Z] üîó Access the server at: http://localhost:3001
[2025-04-25T04:43:27.291Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T04:43:27.291Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T04:43:32.023Z] [Socket Auth MW] Attempting auth for socket P1lbwcOp_mqIj41NAAAB. Token provided: true
[2025-04-25T04:43:32.029Z] [Socket Auth MW] Token signature validated successfully for socket P1lbwcOp_mqIj41NAAAB.
[2025-04-25T04:43:32.031Z] [Socket.IO P1lbwcOp_mqIj41NAAAB] Client connected. Token present: true
[2025-04-25T04:43:32.031Z] [Socket.IO P1lbwcOp_mqIj41NAAAB] Attempting to fetch user info using token...
[2025-04-25T04:43:32.031Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T04:43:32.170Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:43:32.170Z] [Socket.IO P1lbwcOp_mqIj41NAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T04:43:32.171Z] [Socket.IO P1lbwcOp_mqIj41NAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T04:43:32.171Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T04:43:32.405Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:43:32.407Z] [Socket.IO P1lbwcOp_mqIj41NAAAB] Sent initial conversation list (8 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T04:43:32.407Z] [Socket.IO P1lbwcOp_mqIj41NAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T04:43:32.409Z] [Socket P1lbwcOp_mqIj41NAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T04:43:32.409Z] [Socket P1lbwcOp_mqIj41NAAAB] Core event handlers registered.
[2025-04-25T05:05:06.711Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:05:06.719Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:05:06.721Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:05:06.721Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:05:06.727Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:05:13.976Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:05:13.977Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:05:14.361Z] [Server Start] Initializing loaders...
[2025-04-25T05:05:14.362Z] [Loader] Starting application loading process...
[2025-04-25T05:05:14.362Z] [Loader DB] Attempting database connection...
[2025-04-25T05:05:14.363Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:05:15.141Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:05:15.142Z] [Loader DB] Database connection successful.
[2025-04-25T05:05:15.142Z] [Loader] Database loaded.
[2025-04-25T05:05:15.143Z] [History Service] Initialized.
[2025-04-25T05:05:15.143Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:05:15.144Z] [Loader] Services initialized.
[2025-04-25T05:05:15.150Z] [Express] Mounted API routes at /api
[2025-04-25T05:05:15.151Z] [Express] Registered Not Found handler.
[2025-04-25T05:05:15.151Z] [Express] Registered Global Error handler.
[2025-04-25T05:05:15.151Z] [Express] Express app configured.
[2025-04-25T05:05:15.153Z] [Loader] Express loaded.
[2025-04-25T05:05:15.153Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:05:15.158Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:05:15.159Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:05:15.159Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:05:15.159Z] [Loader] Socket.IO loaded.
[2025-04-25T05:05:15.160Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:05:15.160Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:05:15.201Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:05:15.201Z] [Loader] Jobs scheduled.
[2025-04-25T05:05:15.202Z] [Loader] Performing initial log analysis...
[2025-04-25T05:05:15.204Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:05:15.360Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:05:15.360Z] [Loader] Initial log analysis completed.
[2025-04-25T05:05:15.361Z] [Loader] All loaders completed successfully.
[2025-04-25T05:05:15.365Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:05:15.366Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:05:15.366Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:05:15.369Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:05:18.034Z] [Socket Auth MW] Attempting auth for socket p9cRrUskM9-tez0kAAAB. Token provided: true
[2025-04-25T05:05:18.041Z] [Socket Auth MW] Token validation failed for socket p9cRrUskM9-tez0kAAAB. Reason: jwt expired
[2025-04-25T05:05:28.471Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:05:28.472Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:05:28.473Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:05:28.473Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:05:28.473Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:05:36.694Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:05:36.695Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:05:37.128Z] [Server Start] Initializing loaders...
[2025-04-25T05:05:37.128Z] [Loader] Starting application loading process...
[2025-04-25T05:05:37.128Z] [Loader DB] Attempting database connection...
[2025-04-25T05:05:37.131Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:05:37.819Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:05:37.819Z] [Loader DB] Database connection successful.
[2025-04-25T05:05:37.820Z] [Loader] Database loaded.
[2025-04-25T05:05:37.820Z] [History Service] Initialized.
[2025-04-25T05:05:37.821Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:05:37.821Z] [Loader] Services initialized.
[2025-04-25T05:05:37.827Z] [Express] Mounted API routes at /api
[2025-04-25T05:05:37.827Z] [Express] Registered Not Found handler.
[2025-04-25T05:05:37.828Z] [Express] Registered Global Error handler.
[2025-04-25T05:05:37.828Z] [Express] Express app configured.
[2025-04-25T05:05:37.829Z] [Loader] Express loaded.
[2025-04-25T05:05:37.830Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:05:37.835Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:05:37.835Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:05:37.835Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:05:37.836Z] [Loader] Socket.IO loaded.
[2025-04-25T05:05:37.836Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:05:37.836Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:05:37.932Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:05:37.936Z] [Loader] Jobs scheduled.
[2025-04-25T05:05:37.938Z] [Loader] Performing initial log analysis...
[2025-04-25T05:05:37.939Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:05:38.149Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:05:38.150Z] [Loader] Initial log analysis completed.
[2025-04-25T05:05:38.151Z] [Loader] All loaders completed successfully.
[2025-04-25T05:05:38.156Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:05:38.156Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:05:38.156Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:05:38.156Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:05:41.268Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:05:41.270Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:05:41.270Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:05:41.270Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:05:41.271Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:05:50.472Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:05:50.473Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:05:51.039Z] [Server Start] Initializing loaders...
[2025-04-25T05:05:51.040Z] [Loader] Starting application loading process...
[2025-04-25T05:05:51.042Z] [Loader DB] Attempting database connection...
[2025-04-25T05:05:51.043Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:05:51.812Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:05:51.813Z] [Loader DB] Database connection successful.
[2025-04-25T05:05:51.813Z] [Loader] Database loaded.
[2025-04-25T05:05:51.813Z] [History Service] Initialized.
[2025-04-25T05:05:51.814Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:05:51.814Z] [Loader] Services initialized.
[2025-04-25T05:05:51.820Z] [Express] Mounted API routes at /api
[2025-04-25T05:05:51.821Z] [Express] Registered Not Found handler.
[2025-04-25T05:05:51.821Z] [Express] Registered Global Error handler.
[2025-04-25T05:05:51.821Z] [Express] Express app configured.
[2025-04-25T05:05:51.823Z] [Loader] Express loaded.
[2025-04-25T05:05:51.823Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:05:51.827Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:05:51.828Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:05:51.828Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:05:51.828Z] [Loader] Socket.IO loaded.
[2025-04-25T05:05:51.829Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:05:51.829Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:05:51.869Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:05:51.870Z] [Loader] Jobs scheduled.
[2025-04-25T05:05:51.870Z] [Loader] Performing initial log analysis...
[2025-04-25T05:05:51.871Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:05:51.991Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:05:51.991Z] [Loader] Initial log analysis completed.
[2025-04-25T05:05:51.992Z] [Loader] All loaders completed successfully.
[2025-04-25T05:05:51.996Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:05:51.996Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:05:51.996Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:05:51.997Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:13:12.690Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:13:12.692Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:13:12.692Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:13:12.693Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:13:12.693Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:13:23.081Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:13:23.082Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:13:23.611Z] [Server Start] Initializing loaders...
[2025-04-25T05:13:23.612Z] [Loader] Starting application loading process...
[2025-04-25T05:13:23.613Z] [Loader DB] Attempting database connection...
[2025-04-25T05:13:23.614Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:13:24.500Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:13:24.501Z] [Loader DB] Database connection successful.
[2025-04-25T05:13:24.501Z] [Loader] Database loaded.
[2025-04-25T05:13:24.502Z] [History Service] Initialized.
[2025-04-25T05:13:24.502Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:13:24.503Z] [Loader] Services initialized.
[2025-04-25T05:13:24.509Z] [Express] Mounted API routes at /api
[2025-04-25T05:13:24.510Z] [Express] Registered Not Found handler.
[2025-04-25T05:13:24.510Z] [Express] Registered Global Error handler.
[2025-04-25T05:13:24.511Z] [Express] Express app configured.
[2025-04-25T05:13:24.512Z] [Loader] Express loaded.
[2025-04-25T05:13:24.513Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:13:24.519Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:13:24.520Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:13:24.520Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:13:24.520Z] [Loader] Socket.IO loaded.
[2025-04-25T05:13:24.521Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:13:24.521Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:13:24.578Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:13:24.579Z] [Loader] Jobs scheduled.
[2025-04-25T05:13:24.580Z] [Loader] Performing initial log analysis...
[2025-04-25T05:13:24.585Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:13:24.734Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:13:24.734Z] [Loader] Initial log analysis completed.
[2025-04-25T05:13:24.735Z] [Loader] All loaders completed successfully.
[2025-04-25T05:13:24.738Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:13:24.739Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:13:24.739Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:13:24.739Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:13:33.793Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:13:33.796Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:13:33.796Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:13:33.797Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:13:33.797Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:13:41.817Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:13:41.817Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:13:42.383Z] [Server Start] Initializing loaders...
[2025-04-25T05:13:42.384Z] [Loader] Starting application loading process...
[2025-04-25T05:13:42.386Z] [Loader DB] Attempting database connection...
[2025-04-25T05:13:42.387Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:13:43.244Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:13:43.245Z] [Loader DB] Database connection successful.
[2025-04-25T05:13:43.245Z] [Loader] Database loaded.
[2025-04-25T05:13:43.245Z] [History Service] Initialized.
[2025-04-25T05:13:43.246Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:13:43.246Z] [Loader] Services initialized.
[2025-04-25T05:13:43.254Z] [Express] Mounted API routes at /api
[2025-04-25T05:13:43.254Z] [Express] Registered Not Found handler.
[2025-04-25T05:13:43.255Z] [Express] Registered Global Error handler.
[2025-04-25T05:13:43.255Z] [Express] Express app configured.
[2025-04-25T05:13:43.257Z] [Loader] Express loaded.
[2025-04-25T05:13:43.257Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:13:43.263Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:13:43.263Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:13:43.263Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:13:43.264Z] [Loader] Socket.IO loaded.
[2025-04-25T05:13:43.264Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:13:43.264Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:13:43.368Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:13:43.371Z] [Loader] Jobs scheduled.
[2025-04-25T05:13:43.372Z] [Loader] Performing initial log analysis...
[2025-04-25T05:13:43.377Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:13:43.521Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:13:43.521Z] [Loader] Initial log analysis completed.
[2025-04-25T05:13:43.522Z] [Loader] All loaders completed successfully.
[2025-04-25T05:13:43.526Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:13:43.527Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:13:43.527Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:13:43.527Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:13:47.907Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:13:47.908Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:13:47.909Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:13:47.911Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:13:47.916Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:13:54.882Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:13:54.883Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:13:59.100Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:13:59.102Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:13:59.103Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:13:59.103Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:13:59.103Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:14:09.015Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:14:09.016Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:14:09.469Z] [Server Start] Initializing loaders...
[2025-04-25T05:14:09.470Z] [Loader] Starting application loading process...
[2025-04-25T05:14:09.470Z] [Loader DB] Attempting database connection...
[2025-04-25T05:14:09.471Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:14:10.114Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:14:10.114Z] [Loader DB] Database connection successful.
[2025-04-25T05:14:10.115Z] [Loader] Database loaded.
[2025-04-25T05:14:10.115Z] [History Service] Initialized.
[2025-04-25T05:14:10.116Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:14:10.116Z] [Loader] Services initialized.
[2025-04-25T05:14:10.122Z] [Express] Mounted API routes at /api
[2025-04-25T05:14:10.122Z] [Express] Registered Not Found handler.
[2025-04-25T05:14:10.122Z] [Express] Registered Global Error handler.
[2025-04-25T05:14:10.123Z] [Express] Express app configured.
[2025-04-25T05:14:10.124Z] [Loader] Express loaded.
[2025-04-25T05:14:10.125Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:14:10.129Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:14:10.130Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:14:10.130Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:14:10.130Z] [Loader] Socket.IO loaded.
[2025-04-25T05:14:10.131Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:14:10.131Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:14:10.179Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:14:10.180Z] [Loader] Jobs scheduled.
[2025-04-25T05:14:10.180Z] [Loader] Performing initial log analysis...
[2025-04-25T05:14:10.182Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:14:10.282Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:14:10.283Z] [Loader] Initial log analysis completed.
[2025-04-25T05:14:10.283Z] [Loader] All loaders completed successfully.
[2025-04-25T05:14:10.287Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:14:10.287Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:14:10.287Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:14:10.288Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:14:29.888Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:14:29.890Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:14:29.890Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:14:29.890Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:14:29.891Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:14:38.710Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:14:38.710Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:14:39.212Z] [Server Start] Initializing loaders...
[2025-04-25T05:14:39.213Z] [Loader] Starting application loading process...
[2025-04-25T05:14:39.214Z] [Loader DB] Attempting database connection...
[2025-04-25T05:14:39.214Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:14:40.006Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:14:40.007Z] [Loader DB] Database connection successful.
[2025-04-25T05:14:40.007Z] [Loader] Database loaded.
[2025-04-25T05:14:40.007Z] [History Service] Initialized.
[2025-04-25T05:14:40.008Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:14:40.009Z] [Loader] Services initialized.
[2025-04-25T05:14:40.015Z] [Express] Mounted API routes at /api
[2025-04-25T05:14:40.015Z] [Express] Registered Not Found handler.
[2025-04-25T05:14:40.016Z] [Express] Registered Global Error handler.
[2025-04-25T05:14:40.016Z] [Express] Express app configured.
[2025-04-25T05:14:40.017Z] [Loader] Express loaded.
[2025-04-25T05:14:40.018Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:14:40.023Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:14:40.024Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:14:40.024Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:14:40.024Z] [Loader] Socket.IO loaded.
[2025-04-25T05:14:40.025Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:14:40.025Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:14:40.066Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:14:40.067Z] [Loader] Jobs scheduled.
[2025-04-25T05:14:40.067Z] [Loader] Performing initial log analysis...
[2025-04-25T05:14:40.068Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:14:40.211Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:14:40.212Z] [Loader] Initial log analysis completed.
[2025-04-25T05:14:40.213Z] [Loader] All loaders completed successfully.
[2025-04-25T05:14:40.218Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:14:40.219Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:14:40.220Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:14:40.220Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:15:25.735Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:15:25.739Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:15:25.741Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:15:25.742Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:15:25.743Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:15:34.149Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:15:34.152Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:15:34.735Z] [Server Start] Initializing loaders...
[2025-04-25T05:15:34.736Z] [Loader] Starting application loading process...
[2025-04-25T05:15:34.737Z] [Loader DB] Attempting database connection...
[2025-04-25T05:15:34.738Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:15:35.519Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:15:35.520Z] [Loader DB] Database connection successful.
[2025-04-25T05:15:35.520Z] [Loader] Database loaded.
[2025-04-25T05:15:35.520Z] [History Service] Initialized.
[2025-04-25T05:15:35.521Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:15:35.522Z] [Loader] Services initialized.
[2025-04-25T05:15:35.529Z] [Express] Mounted API routes at /api
[2025-04-25T05:15:35.529Z] [Express] Registered Not Found handler.
[2025-04-25T05:15:35.529Z] [Express] Registered Global Error handler.
[2025-04-25T05:15:35.530Z] [Express] Express app configured.
[2025-04-25T05:15:35.531Z] [Loader] Express loaded.
[2025-04-25T05:15:35.531Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:15:35.540Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:15:35.540Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:15:35.540Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:15:35.541Z] [Loader] Socket.IO loaded.
[2025-04-25T05:15:35.541Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:15:35.541Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:15:35.597Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:15:35.598Z] [Loader] Jobs scheduled.
[2025-04-25T05:15:35.609Z] [Loader] Performing initial log analysis...
[2025-04-25T05:15:35.611Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:15:35.834Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:15:35.834Z] [Loader] Initial log analysis completed.
[2025-04-25T05:15:35.834Z] [Loader] All loaders completed successfully.
[2025-04-25T05:15:35.842Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:15:35.843Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:15:35.843Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:15:35.843Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:17:22.659Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:17:22.662Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:17:22.663Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:17:22.663Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:17:22.664Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:17:25.391Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:17:25.393Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:17:25.393Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:17:25.393Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:17:25.394Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:23:14.880Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:23:14.882Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:23:14.882Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:23:14.882Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:23:14.882Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:24:25.111Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:24:25.113Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:24:25.113Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:24:25.114Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:24:25.114Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:24:32.749Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:24:32.750Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:24:33.174Z] [Server Start] Initializing loaders...
[2025-04-25T05:24:33.175Z] [Loader] Starting application loading process...
[2025-04-25T05:24:33.175Z] [Loader DB] Attempting database connection...
[2025-04-25T05:24:33.175Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:24:33.965Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:24:33.965Z] [Loader DB] Database connection successful.
[2025-04-25T05:24:33.965Z] [Loader] Database loaded.
[2025-04-25T05:24:33.966Z] [History Service] Initialized.
[2025-04-25T05:24:33.966Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:24:33.967Z] [Loader] Services initialized.
[2025-04-25T05:24:33.973Z] [Express] Mounted API routes at /api
[2025-04-25T05:24:33.973Z] [Express] Registered Not Found handler.
[2025-04-25T05:24:33.974Z] [Express] Registered Global Error handler.
[2025-04-25T05:24:33.974Z] [Express] Express app configured.
[2025-04-25T05:24:33.975Z] [Loader] Express loaded.
[2025-04-25T05:24:33.976Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:24:33.980Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:24:33.980Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:24:33.980Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:24:33.981Z] [Loader] Socket.IO loaded.
[2025-04-25T05:24:33.981Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:24:33.981Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:24:34.015Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:24:34.015Z] [Loader] Jobs scheduled.
[2025-04-25T05:24:34.016Z] [Loader] Performing initial log analysis...
[2025-04-25T05:24:34.017Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:24:34.108Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:24:34.108Z] [Loader] Initial log analysis completed.
[2025-04-25T05:24:34.109Z] [Loader] All loaders completed successfully.
[2025-04-25T05:24:34.113Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:24:34.113Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:24:34.113Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:24:34.114Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:24:50.449Z] [Socket Auth MW] Attempting auth for socket tdcwfZQgiEh9z_goAAAD. Token provided: true
[2025-04-25T05:24:50.456Z] [Socket Auth MW] Token signature validated successfully for socket tdcwfZQgiEh9z_goAAAD.
[2025-04-25T05:24:50.458Z] [Socket.IO tdcwfZQgiEh9z_goAAAD] Client connected. Token present: true
[2025-04-25T05:24:50.458Z] [Socket.IO tdcwfZQgiEh9z_goAAAD] Attempting to fetch user info using token...
[2025-04-25T05:24:50.460Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T05:24:50.607Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:24:50.607Z] [Socket.IO tdcwfZQgiEh9z_goAAAD] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T05:24:50.607Z] [Socket.IO tdcwfZQgiEh9z_goAAAD] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T05:24:50.608Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:24:50.813Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:24:50.816Z] [Socket.IO tdcwfZQgiEh9z_goAAAD] Sent initial conversation list (8 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T05:24:50.817Z] [Socket.IO tdcwfZQgiEh9z_goAAAD] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T05:24:50.819Z] [Socket tdcwfZQgiEh9z_goAAAD] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:24:50.819Z] [Socket tdcwfZQgiEh9z_goAAAD] Core event handlers registered.
[2025-04-25T05:24:58.598Z] [Socket tdcwfZQgiEh9z_goAAAD] Event 'start_new_conversation' received for user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T05:24:58.598Z] [History Service] Explicitly creating new conversation for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:24:58.676Z] [History Service] Created new conversationId: 680b1caa22af144be8351f37 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:24:58.677Z] [Socket tdcwfZQgiEh9z_goAAAD] Started new conversation 680b1caa22af144be8351f37. Set as active.
[2025-04-25T05:24:58.679Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:24:58.835Z] [History Service] Found 9 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:24:58.836Z] [Socket tdcwfZQgiEh9z_goAAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after new conversation start.
[2025-04-25T05:25:07.854Z] [Socket tdcwfZQgiEh9z_goAAAD MsgHandler-1745558707854] Event 'send_message' received: UserInput="Hello...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b1caa22af144be8351f37
[2025-04-25T05:25:07.855Z] [History Service] Getting history for conversationId: 680b1caa22af144be8351f37, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T05:25:07.856Z] [History Service] Applying message limit: 50
[2025-04-25T05:25:07.910Z] [History Service] Found history for conversationId: 680b1caa22af144be8351f37. Message count: 0
[2025-04-25T05:25:07.911Z] [Socket tdcwfZQgiEh9z_goAAAD MsgHandler-1745558707854] Fetched 0 history items for conv 680b1caa22af144be8351f37.
[2025-04-25T05:25:07.914Z] --- [MsgHandler-1745558707854 Socket tdcwfZQgiEh9z_goAAAD] Handling STREAMING input: "Hello", Lang: vi ---
[2025-04-25T05:25:07.914Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T05:25:07.915Z] [MsgHandler-1745558707854] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T05:25:07.916Z] [MsgHandler-1745558707854 Emit Sent - tdcwfZQgiEh9z_goAAAD] Event: status_update, Type: status
[2025-04-25T05:25:07.916Z] [MsgHandler-1745558707854 History Init - tdcwfZQgiEh9z_goAAAD] Added user turn. Size: 1
[2025-04-25T05:25:07.917Z] --- [MsgHandler-1745558707854 HostAgent Turn 1 Start - tdcwfZQgiEh9z_goAAAD] Requesting initial response from HostAgent ---
[2025-04-25T05:25:07.917Z] [MsgHandler-1745558707854 Emit Sent - tdcwfZQgiEh9z_goAAAD] Event: status_update, Type: status
[2025-04-25T05:25:07.917Z] [MsgHandler-1745558707854 History T1 Send - tdcwfZQgiEh9z_goAAAD] Host History Size: 1
[2025-04-25T05:25:07.919Z] [GeminiService] Received history with 1 items before mapping (for stream).
[2025-04-25T05:25:07.919Z] [GeminiService] Mapped history (SDK Content[]) with 1 items (for stream).
[2025-04-25T05:25:07.919Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:25:07.920Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:25:07.920Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:25:07.920Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:25:07.920Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:25:07.921Z] [GeminiService Stream] Preparing stream request with 1 Content items.
[2025-04-25T05:25:07.921Z]   - No valid next turn added, sending only history.
[2025-04-25T05:25:08.717Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T05:25:08.718Z] [MsgHandler-1745558707854 Stream T1 Direct - tdcwfZQgiEh9z_goAAAD] HostAgent provided stream directly. Processing...
[2025-04-25T05:25:08.718Z] [MsgHandler-1745558707854 Stream Processing - tdcwfZQgiEh9z_goAAAD] Starting... (Emit final: true)
[2025-04-25T05:25:08.719Z] [MsgHandler-1745558707854 Emit Sent - tdcwfZQgiEh9z_goAAAD] Event: status_update, Type: status
[2025-04-25T05:25:08.720Z] [MsgHandler-1745558707854 Emit Sent - tdcwfZQgiEh9z_goAAAD] Event: chat_update, Type: partial_result
[2025-04-25T05:25:08.768Z] [MsgHandler-1745558707854 Emit Sent - tdcwfZQgiEh9z_goAAAD] Event: chat_update, Type: partial_result
[2025-04-25T05:25:08.831Z] [MsgHandler-1745558707854 Emit Sent - tdcwfZQgiEh9z_goAAAD] Event: chat_update, Type: partial_result
[2025-04-25T05:25:08.844Z] [MsgHandler-1745558707854 Stream Processing - tdcwfZQgiEh9z_goAAAD] Finished. Length: 149
[2025-04-25T05:25:08.845Z] [MsgHandler-1745558707854 Stream Processing - tdcwfZQgiEh9z_goAAAD] Emitting final chat_result via safeEmit.
[2025-04-25T05:25:08.846Z] [MsgHandler-1745558707854 Emit Sent - tdcwfZQgiEh9z_goAAAD] Event: chat_result, Type: result
[2025-04-25T05:25:08.847Z] [MsgHandler-1745558707854 History T1 Direct Done - tdcwfZQgiEh9z_goAAAD] Appended initial HostAgent response. Size: 2
[2025-04-25T05:25:08.847Z] --- [MsgHandler-1745558707854 tdcwfZQgiEh9z_goAAAD Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T05:25:08.847Z] [MsgHandler-1745558707854 Save History Check] History to save. Size: 2.
[2025-04-25T05:25:08.848Z] [History Service] Updating history for conversationId: 680b1caa22af144be8351f37, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 2
[2025-04-25T05:25:08.922Z] [History Service] Successfully updated history for conversationId: 680b1caa22af144be8351f37. Modified: true
[2025-04-25T05:25:08.922Z] [Socket tdcwfZQgiEh9z_goAAAD MsgHandler-1745558707854] Successfully updated history in DB for conv 680b1caa22af144be8351f37.
[2025-04-25T05:25:08.922Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:25:09.072Z] [History Service] Found 9 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:25:09.073Z] [Socket tdcwfZQgiEh9z_goAAAD] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T05:25:32.733Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:25:32.735Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:25:32.735Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:25:32.735Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:25:32.736Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:25:41.605Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:25:41.606Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:25:42.178Z] [Server Start] Initializing loaders...
[2025-04-25T05:25:42.178Z] [Loader] Starting application loading process...
[2025-04-25T05:25:42.179Z] [Loader DB] Attempting database connection...
[2025-04-25T05:25:42.179Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:25:42.928Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:25:42.928Z] [Loader DB] Database connection successful.
[2025-04-25T05:25:42.929Z] [Loader] Database loaded.
[2025-04-25T05:25:42.929Z] [History Service] Initialized.
[2025-04-25T05:25:42.929Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:25:42.930Z] [Loader] Services initialized.
[2025-04-25T05:25:42.936Z] [Express] Mounted API routes at /api
[2025-04-25T05:25:42.936Z] [Express] Registered Not Found handler.
[2025-04-25T05:25:42.936Z] [Express] Registered Global Error handler.
[2025-04-25T05:25:42.936Z] [Express] Express app configured.
[2025-04-25T05:25:42.938Z] [Loader] Express loaded.
[2025-04-25T05:25:42.938Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:25:42.944Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:25:42.945Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:25:42.945Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:25:42.945Z] [Loader] Socket.IO loaded.
[2025-04-25T05:25:42.946Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:25:42.946Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:25:42.995Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:25:42.996Z] [Loader] Jobs scheduled.
[2025-04-25T05:25:42.996Z] [Loader] Performing initial log analysis...
[2025-04-25T05:25:42.997Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:25:43.134Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:25:43.135Z] [Loader] Initial log analysis completed.
[2025-04-25T05:25:43.135Z] [Loader] All loaders completed successfully.
[2025-04-25T05:25:43.144Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:25:43.144Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:25:43.146Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:25:43.146Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:25:45.015Z] [Socket Auth MW] Attempting auth for socket xBTWIFPK1P8dQDBVAAAB. Token provided: true
[2025-04-25T05:25:45.021Z] [Socket Auth MW] Token signature validated successfully for socket xBTWIFPK1P8dQDBVAAAB.
[2025-04-25T05:25:45.023Z] [Socket.IO xBTWIFPK1P8dQDBVAAAB] Client connected. Token present: true
[2025-04-25T05:25:45.023Z] [Socket.IO xBTWIFPK1P8dQDBVAAAB] Attempting to fetch user info using token...
[2025-04-25T05:25:45.024Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T05:25:45.150Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:25:45.151Z] [Socket.IO xBTWIFPK1P8dQDBVAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T05:25:45.151Z] [Socket.IO xBTWIFPK1P8dQDBVAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T05:25:45.152Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:25:45.323Z] [History Service] Found 9 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:25:45.324Z] [Socket.IO xBTWIFPK1P8dQDBVAAAB] Sent initial conversation list (9 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T05:25:45.325Z] [Socket.IO xBTWIFPK1P8dQDBVAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T05:25:45.326Z] [Socket xBTWIFPK1P8dQDBVAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:25:45.326Z] [Socket xBTWIFPK1P8dQDBVAAAB] Core event handlers registered.
[2025-04-25T05:26:30.805Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:26:30.807Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:26:30.808Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:26:30.808Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:26:30.809Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:26:38.078Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:26:38.080Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:26:38.080Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:26:38.080Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:26:38.081Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:26:45.914Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:26:45.915Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:26:46.379Z] [Server Start] Initializing loaders...
[2025-04-25T05:26:46.380Z] [Loader] Starting application loading process...
[2025-04-25T05:26:46.381Z] [Loader DB] Attempting database connection...
[2025-04-25T05:26:46.382Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:26:47.038Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:26:47.038Z] [Loader DB] Database connection successful.
[2025-04-25T05:26:47.039Z] [Loader] Database loaded.
[2025-04-25T05:26:47.039Z] [History Service] Initialized.
[2025-04-25T05:26:47.041Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:26:47.041Z] [Loader] Services initialized.
[2025-04-25T05:26:47.048Z] [Express] Mounted API routes at /api
[2025-04-25T05:26:47.049Z] [Express] Registered Not Found handler.
[2025-04-25T05:26:47.049Z] [Express] Registered Global Error handler.
[2025-04-25T05:26:47.049Z] [Express] Express app configured.
[2025-04-25T05:26:47.051Z] [Loader] Express loaded.
[2025-04-25T05:26:47.051Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:26:47.058Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:26:47.058Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:26:47.058Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:26:47.058Z] [Loader] Socket.IO loaded.
[2025-04-25T05:26:47.060Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:26:47.060Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:26:47.094Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:26:47.095Z] [Loader] Jobs scheduled.
[2025-04-25T05:26:47.097Z] [Loader] Performing initial log analysis...
[2025-04-25T05:26:47.098Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:26:47.204Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:26:47.205Z] [Loader] Initial log analysis completed.
[2025-04-25T05:26:47.205Z] [Loader] All loaders completed successfully.
[2025-04-25T05:26:47.210Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:26:47.210Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:26:47.211Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:26:47.211Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:26:47.300Z] [Socket Auth MW] Attempting auth for socket 9YnfUp2-ENxhXhOZAAAB. Token provided: true
[2025-04-25T05:26:47.306Z] [Socket Auth MW] Token signature validated successfully for socket 9YnfUp2-ENxhXhOZAAAB.
[2025-04-25T05:26:47.309Z] [Socket.IO 9YnfUp2-ENxhXhOZAAAB] Client connected. Token present: true
[2025-04-25T05:26:47.309Z] [Socket.IO 9YnfUp2-ENxhXhOZAAAB] Attempting to fetch user info using token...
[2025-04-25T05:26:47.309Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T05:26:47.420Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:26:47.421Z] [Socket.IO 9YnfUp2-ENxhXhOZAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T05:26:47.421Z] [Socket.IO 9YnfUp2-ENxhXhOZAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T05:26:47.422Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:26:47.618Z] [History Service] Found 9 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:26:47.620Z] [Socket.IO 9YnfUp2-ENxhXhOZAAAB] Sent initial conversation list (9 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T05:26:47.621Z] [Socket.IO 9YnfUp2-ENxhXhOZAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T05:26:47.622Z] [Socket 9YnfUp2-ENxhXhOZAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:26:47.623Z] [Socket 9YnfUp2-ENxhXhOZAAAB] Core event handlers registered.
[2025-04-25T05:27:11.164Z] [Server Config] Loaded PORT: 3001
[2025-04-25T05:27:11.165Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T05:27:11.166Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T05:27:11.173Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:27:11.175Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:27:18.466Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T05:27:18.466Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:27:18.816Z] [Server Start] Initializing loaders...
[2025-04-25T05:27:18.817Z] [Loader] Starting application loading process...
[2025-04-25T05:27:18.818Z] [Loader DB] Attempting database connection...
[2025-04-25T05:27:18.819Z] [Database] Attempting MongoDB connection...
[2025-04-25T05:27:19.459Z] [Database] MongoDB Connected Successfully.
[2025-04-25T05:27:19.459Z] [Loader DB] Database connection successful.
[2025-04-25T05:27:19.460Z] [Loader] Database loaded.
[2025-04-25T05:27:19.460Z] [History Service] Initialized.
[2025-04-25T05:27:19.461Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T05:27:19.461Z] [Loader] Services initialized.
[2025-04-25T05:27:19.466Z] [Express] Mounted API routes at /api
[2025-04-25T05:27:19.467Z] [Express] Registered Not Found handler.
[2025-04-25T05:27:19.467Z] [Express] Registered Global Error handler.
[2025-04-25T05:27:19.468Z] [Express] Express app configured.
[2025-04-25T05:27:19.469Z] [Loader] Express loaded.
[2025-04-25T05:27:19.469Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T05:27:19.474Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T05:27:19.474Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T05:27:19.474Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T05:27:19.474Z] [Loader] Socket.IO loaded.
[2025-04-25T05:27:19.475Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T05:27:19.475Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T05:27:19.508Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T05:27:19.508Z] [Loader] Jobs scheduled.
[2025-04-25T05:27:19.509Z] [Loader] Performing initial log analysis...
[2025-04-25T05:27:19.510Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:27:19.602Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:27:19.603Z] [Loader] Initial log analysis completed.
[2025-04-25T05:27:19.603Z] [Loader] All loaders completed successfully.
[2025-04-25T05:27:19.608Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T05:27:19.608Z] üîó Access the server at: http://localhost:3001
[2025-04-25T05:27:19.609Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T05:27:19.609Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T05:27:21.350Z] [Socket Auth MW] Attempting auth for socket PEJO9giIDBoOJm2NAAAB. Token provided: true
[2025-04-25T05:27:21.354Z] [Socket Auth MW] Token signature validated successfully for socket PEJO9giIDBoOJm2NAAAB.
[2025-04-25T05:27:21.356Z] [Socket.IO PEJO9giIDBoOJm2NAAAB] Client connected. Token present: true
[2025-04-25T05:27:21.356Z] [Socket.IO PEJO9giIDBoOJm2NAAAB] Attempting to fetch user info using token...
[2025-04-25T05:27:21.357Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T05:27:21.471Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:27:21.471Z] [Socket.IO PEJO9giIDBoOJm2NAAAB] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T05:27:21.471Z] [Socket.IO PEJO9giIDBoOJm2NAAAB] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T05:27:21.472Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:27:21.643Z] [History Service] Found 9 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:27:21.645Z] [Socket.IO PEJO9giIDBoOJm2NAAAB] Sent initial conversation list (9 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T05:27:21.645Z] [Socket.IO PEJO9giIDBoOJm2NAAAB] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T05:27:21.647Z] [Socket PEJO9giIDBoOJm2NAAAB] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:27:21.647Z] [Socket PEJO9giIDBoOJm2NAAAB] Core event handlers registered.
[2025-04-25T05:28:10.434Z] [Socket PEJO9giIDBoOJm2NAAAB] Event 'start_new_conversation' received for user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T05:28:10.435Z] [History Service] Explicitly creating new conversation for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:28:10.512Z] [History Service] Created new conversationId: 680b1d6aacff3a287a68e17c for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:28:10.512Z] [Socket PEJO9giIDBoOJm2NAAAB] Started new conversation 680b1d6aacff3a287a68e17c. Set as active.
[2025-04-25T05:28:10.513Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:28:10.656Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:28:10.657Z] [Socket PEJO9giIDBoOJm2NAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after new conversation start.
[2025-04-25T05:28:18.086Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558898086] Event 'send_message' received: UserInput="hello...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b1d6aacff3a287a68e17c
[2025-04-25T05:28:18.087Z] [History Service] Getting history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T05:28:18.089Z] [History Service] Applying message limit: 50
[2025-04-25T05:28:18.140Z] [History Service] Found history for conversationId: 680b1d6aacff3a287a68e17c. Message count: 0
[2025-04-25T05:28:18.141Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558898086] Fetched 0 history items for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:28:18.142Z] --- [MsgHandler-1745558898086 Socket PEJO9giIDBoOJm2NAAAB] Handling STREAMING input: "hello", Lang: vi ---
[2025-04-25T05:28:18.143Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T05:28:18.143Z] [MsgHandler-1745558898086] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T05:28:18.144Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:18.145Z] [MsgHandler-1745558898086 History Init - PEJO9giIDBoOJm2NAAAB] Added user turn. Size: 1
[2025-04-25T05:28:18.145Z] --- [MsgHandler-1745558898086 HostAgent Turn 1 Start - PEJO9giIDBoOJm2NAAAB] Requesting initial response from HostAgent ---
[2025-04-25T05:28:18.146Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:18.146Z] [MsgHandler-1745558898086 History T1 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 1
[2025-04-25T05:28:18.147Z] [GeminiService] Received history with 1 items before mapping (for stream).
[2025-04-25T05:28:18.148Z] [GeminiService] Mapped history (SDK Content[]) with 1 items (for stream).
[2025-04-25T05:28:18.148Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:28:18.148Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:28:18.148Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:28:18.149Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:28:18.149Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:28:18.150Z] [GeminiService Stream] Preparing stream request with 1 Content items.
[2025-04-25T05:28:18.151Z]   - No valid next turn added, sending only history.
[2025-04-25T05:28:18.863Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T05:28:18.864Z] [MsgHandler-1745558898086 Stream T1 Direct - PEJO9giIDBoOJm2NAAAB] HostAgent provided stream directly. Processing...
[2025-04-25T05:28:18.864Z] [MsgHandler-1745558898086 Stream Processing - PEJO9giIDBoOJm2NAAAB] Starting... (Emit final: true)
[2025-04-25T05:28:18.865Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:18.867Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:18.983Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:19.048Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:19.075Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:19.097Z] [MsgHandler-1745558898086 Stream Processing - PEJO9giIDBoOJm2NAAAB] Finished. Length: 132
[2025-04-25T05:28:19.098Z] [MsgHandler-1745558898086 Stream Processing - PEJO9giIDBoOJm2NAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T05:28:19.098Z] [MsgHandler-1745558898086 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_result, Type: result
[2025-04-25T05:28:19.099Z] [MsgHandler-1745558898086 History T1 Direct Done - PEJO9giIDBoOJm2NAAAB] Appended initial HostAgent response. Size: 2
[2025-04-25T05:28:19.099Z] --- [MsgHandler-1745558898086 PEJO9giIDBoOJm2NAAAB Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T05:28:19.100Z] [MsgHandler-1745558898086 Save History Check] History to save. Size: 2.
[2025-04-25T05:28:19.101Z] [History Service] Updating history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 2
[2025-04-25T05:28:19.175Z] [History Service] Successfully updated history for conversationId: 680b1d6aacff3a287a68e17c. Modified: true
[2025-04-25T05:28:19.175Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558898086] Successfully updated history in DB for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:28:19.176Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:28:19.323Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:28:19.323Z] [Socket PEJO9giIDBoOJm2NAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T05:28:31.730Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558911730] Event 'send_message' received: UserInput="what thing you can d...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b1d6aacff3a287a68e17c
[2025-04-25T05:28:31.731Z] [History Service] Getting history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T05:28:31.731Z] [History Service] Applying message limit: 50
[2025-04-25T05:28:31.782Z] [History Service] Found history for conversationId: 680b1d6aacff3a287a68e17c. Message count: 2
[2025-04-25T05:28:31.783Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558911730] Fetched 2 history items for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:28:31.783Z] --- [MsgHandler-1745558911730 Socket PEJO9giIDBoOJm2NAAAB] Handling STREAMING input: "what thing you can do ?", Lang: vi ---
[2025-04-25T05:28:31.783Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T05:28:31.784Z] [MsgHandler-1745558911730] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T05:28:31.786Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:31.786Z] [MsgHandler-1745558911730 History Init - PEJO9giIDBoOJm2NAAAB] Added user turn. Size: 3
[2025-04-25T05:28:31.786Z] --- [MsgHandler-1745558911730 HostAgent Turn 1 Start - PEJO9giIDBoOJm2NAAAB] Requesting initial response from HostAgent ---
[2025-04-25T05:28:31.787Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:31.788Z] [MsgHandler-1745558911730 History T1 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 3
[2025-04-25T05:28:31.789Z] [GeminiService] Received history with 3 items before mapping (for stream).
[2025-04-25T05:28:31.791Z] [GeminiService] Mapped history (SDK Content[]) with 3 items (for stream).
[2025-04-25T05:28:31.791Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:28:31.792Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:28:31.792Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:28:31.792Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:28:31.792Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:28:31.793Z] [GeminiService Stream] Preparing stream request with 3 Content items.
[2025-04-25T05:28:31.793Z]   - No valid next turn added, sending only history.
[2025-04-25T05:28:32.490Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T05:28:32.490Z] [MsgHandler-1745558911730 Stream T1 Direct - PEJO9giIDBoOJm2NAAAB] HostAgent provided stream directly. Processing...
[2025-04-25T05:28:32.490Z] [MsgHandler-1745558911730 Stream Processing - PEJO9giIDBoOJm2NAAAB] Starting... (Emit final: true)
[2025-04-25T05:28:32.491Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:32.491Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:32.569Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:32.644Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:32.786Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:32.905Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:33.069Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:33.084Z] [MsgHandler-1745558911730 Stream Processing - PEJO9giIDBoOJm2NAAAB] Finished. Length: 404
[2025-04-25T05:28:33.084Z] [MsgHandler-1745558911730 Stream Processing - PEJO9giIDBoOJm2NAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T05:28:33.086Z] [MsgHandler-1745558911730 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_result, Type: result
[2025-04-25T05:28:33.086Z] [MsgHandler-1745558911730 History T1 Direct Done - PEJO9giIDBoOJm2NAAAB] Appended initial HostAgent response. Size: 4
[2025-04-25T05:28:33.086Z] --- [MsgHandler-1745558911730 PEJO9giIDBoOJm2NAAAB Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T05:28:33.086Z] [MsgHandler-1745558911730 Save History Check] History to save. Size: 4.
[2025-04-25T05:28:33.087Z] [History Service] Updating history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 4
[2025-04-25T05:28:33.151Z] [History Service] Successfully updated history for conversationId: 680b1d6aacff3a287a68e17c. Modified: true
[2025-04-25T05:28:33.152Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558911730] Successfully updated history in DB for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:28:33.152Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:28:33.289Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:28:33.290Z] [Socket PEJO9giIDBoOJm2NAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T05:28:48.393Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558928393] Event 'send_message' received: UserInput="Theo d√µi h·ªôi ngh·ªã AC...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b1d6aacff3a287a68e17c
[2025-04-25T05:28:48.394Z] [History Service] Getting history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T05:28:48.394Z] [History Service] Applying message limit: 50
[2025-04-25T05:28:48.446Z] [History Service] Found history for conversationId: 680b1d6aacff3a287a68e17c. Message count: 4
[2025-04-25T05:28:48.447Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558928393] Fetched 4 history items for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:28:48.447Z] --- [MsgHandler-1745558928393 Socket PEJO9giIDBoOJm2NAAAB] Handling STREAMING input: "Theo d√µi h·ªôi ngh·ªã ACCV cho t√¥i", Lang: vi ---
[2025-04-25T05:28:48.447Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T05:28:48.448Z] [MsgHandler-1745558928393] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T05:28:48.449Z] [MsgHandler-1745558928393 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:48.449Z] [MsgHandler-1745558928393 History Init - PEJO9giIDBoOJm2NAAAB] Added user turn. Size: 5
[2025-04-25T05:28:48.449Z] --- [MsgHandler-1745558928393 HostAgent Turn 1 Start - PEJO9giIDBoOJm2NAAAB] Requesting initial response from HostAgent ---
[2025-04-25T05:28:48.449Z] [MsgHandler-1745558928393 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:48.450Z] [MsgHandler-1745558928393 History T1 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 5
[2025-04-25T05:28:48.450Z] [GeminiService] Received history with 5 items before mapping (for stream).
[2025-04-25T05:28:48.450Z] [GeminiService] Mapped history (SDK Content[]) with 5 items (for stream).
[2025-04-25T05:28:48.451Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:28:48.451Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:28:48.451Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:28:48.451Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:28:48.451Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:28:48.452Z] [GeminiService Stream] Preparing stream request with 5 Content items.
[2025-04-25T05:28:48.452Z]   - No valid next turn added, sending only history.
[2025-04-25T05:28:50.158Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T05:28:50.159Z] [MsgHandler-1745558928393 Stream T1 Direct - PEJO9giIDBoOJm2NAAAB] HostAgent provided stream directly. Processing...
[2025-04-25T05:28:50.159Z] [MsgHandler-1745558928393 Stream Processing - PEJO9giIDBoOJm2NAAAB] Starting... (Emit final: true)
[2025-04-25T05:28:50.159Z] [MsgHandler-1745558928393 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:28:50.160Z] [MsgHandler-1745558928393 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:50.251Z] [MsgHandler-1745558928393 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:28:50.378Z] [MsgHandler-1745558928393 Stream Processing - PEJO9giIDBoOJm2NAAAB] Finished. Length: 40
[2025-04-25T05:28:50.378Z] [MsgHandler-1745558928393 Stream Processing - PEJO9giIDBoOJm2NAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T05:28:50.379Z] [MsgHandler-1745558928393 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_result, Type: result
[2025-04-25T05:28:50.379Z] [MsgHandler-1745558928393 History T1 Direct Done - PEJO9giIDBoOJm2NAAAB] Appended initial HostAgent response. Size: 6
[2025-04-25T05:28:50.379Z] --- [MsgHandler-1745558928393 PEJO9giIDBoOJm2NAAAB Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T05:28:50.380Z] [MsgHandler-1745558928393 Save History Check] History to save. Size: 6.
[2025-04-25T05:28:50.380Z] [History Service] Updating history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 6
[2025-04-25T05:28:50.444Z] [History Service] Successfully updated history for conversationId: 680b1d6aacff3a287a68e17c. Modified: true
[2025-04-25T05:28:50.444Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558928393] Successfully updated history in DB for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:28:50.445Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:28:50.598Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:28:50.599Z] [Socket PEJO9giIDBoOJm2NAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T05:29:09.156Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558949156] Event 'send_message' received: UserInput="Oke h√£y theo d√µi cho...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b1d6aacff3a287a68e17c
[2025-04-25T05:29:09.157Z] [History Service] Getting history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T05:29:09.157Z] [History Service] Applying message limit: 50
[2025-04-25T05:29:09.206Z] [History Service] Found history for conversationId: 680b1d6aacff3a287a68e17c. Message count: 6
[2025-04-25T05:29:09.206Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558949156] Fetched 6 history items for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:29:09.207Z] --- [MsgHandler-1745558949156 Socket PEJO9giIDBoOJm2NAAAB] Handling STREAMING input: "Oke h√£y theo d√µi cho toio", Lang: vi ---
[2025-04-25T05:29:09.207Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T05:29:09.207Z] [MsgHandler-1745558949156] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T05:29:09.208Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:09.208Z] [MsgHandler-1745558949156 History Init - PEJO9giIDBoOJm2NAAAB] Added user turn. Size: 7
[2025-04-25T05:29:09.209Z] --- [MsgHandler-1745558949156 HostAgent Turn 1 Start - PEJO9giIDBoOJm2NAAAB] Requesting initial response from HostAgent ---
[2025-04-25T05:29:09.209Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:09.209Z] [MsgHandler-1745558949156 History T1 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 7
[2025-04-25T05:29:09.209Z] [GeminiService] Received history with 7 items before mapping (for stream).
[2025-04-25T05:29:09.210Z] [GeminiService] Mapped history (SDK Content[]) with 7 items (for stream).
[2025-04-25T05:29:09.210Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:29:09.210Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:29:09.211Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:29:09.211Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:29:09.211Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:29:09.211Z] [GeminiService Stream] Preparing stream request with 7 Content items.
[2025-04-25T05:29:09.211Z]   - No valid next turn added, sending only history.
[2025-04-25T05:29:10.040Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T05:29:10.040Z] [MsgHandler-1745558949156 HostAgent T1 - PEJO9giIDBoOJm2NAAAB] HostAgent requested function call: routeToAgent
[2025-04-25T05:29:10.040Z] [MsgHandler-1745558949156 History T1 Prep - PEJO9giIDBoOJm2NAAAB] Appended HostAgent FC request. Size: 8
[2025-04-25T05:29:10.041Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:10.042Z] --- [MsgHandler-1745558949156 SubAgent Call Start - PEJO9giIDBoOJm2NAAAB] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T05:29:10.043Z] --- [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Socket PEJO9giIDBoOJm2NAAAB] Calling Sub Agent: ConferenceAgent, Task: 1dd43c75-0c6b-4077-af96-ff160b097c40 ---
[2025-04-25T05:29:10.043Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: vi
[2025-04-25T05:29:10.044Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043] Sending request to ConferenceAgent LLM.
[2025-04-25T05:29:10.045Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T05:29:10.045Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T05:29:10.045Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:29:10.045Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:29:10.046Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:29:10.046Z] Tools provided: ["getConferences","followUnfollowItem","drawChart"]
[2025-04-25T05:29:10.047Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:29:10.047Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T05:29:10.048Z]   - No valid next turn added, sending only history.
[2025-04-25T05:29:11.810Z] Model Finish Reason: STOP
[2025-04-25T05:29:11.811Z] Model requested function call: followUnfollowItem
[2025-04-25T05:29:11.811Z] Arguments: {"identifier":"ACCV","action":"follow","identifierType":"acronym","itemType":"conference"}
[2025-04-25T05:29:11.811Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T05:29:11.811Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043] ConferenceAgent requested function call: followUnfollowItem
[2025-04-25T05:29:11.812Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 PEJO9giIDBoOJm2NAAAB] FunctionRegistry: Attempting execution: followUnfollowItem
[2025-04-25T05:29:11.812Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: function_call, Msg: Received request to call function: followUnfollowItem
[2025-04-25T05:29:11.814Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 PEJO9giIDBoOJm2NAAAB] Handler: FollowUnfollowItem, Args: {"identifier":"ACCV","action":"follow","identifierType":"acronym","itemType":"conference"} Auth: true
[2025-04-25T05:29:11.814Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: validating_function_args, Msg: Validating follow/unfollow arguments...
[2025-04-25T05:29:11.815Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: checking_authentication, Msg: Checking authentication status...
[2025-04-25T05:29:11.815Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: processing_request, Msg: Processing follow request for conference: "ACCV"...
[2025-04-25T05:29:11.815Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: finding_item_id, Msg: Searching for conference with acronym: "ACCV"...
[2025-04-25T05:29:11.816Z] Finding ID for conference with identifier: "ACCV" (type: acronym)
[2025-04-25T05:29:11.817Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=ACCV&perPage=1&page=1
[2025-04-25T05:29:11.953Z] Backend API Success for conference. Data length: 1642
[2025-04-25T05:29:11.954Z] Transforming conference data with Markdown. Search query: acronym=ACCV&perPage=1&page=1
[2025-04-25T05:29:11.957Z] Conference data transformed successfully.
[2025-04-25T05:29:11.957Z] Found conference ID: e76fd867-789c-47d9-abfa-79986f4a2478 for identifier "ACCV"
[2025-04-25T05:29:11.958Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: item_id_found, Msg: Found conference (ID: e76fd867-789c-47d9-abfa-79986f4a2478).
[2025-04-25T05:29:11.958Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: checking_follow_status, Msg: Checking your follow status for item e76fd867-789c-47d9-abfa-79986f4a2478...
[2025-04-25T05:29:11.958Z] Fetching followed conferences: GET http://confhub.engineer/api/v1/follow-conference/followed (using provided token)
[2025-04-25T05:29:12.095Z] Successfully fetched 5 followed conference(s).
[2025-04-25T05:29:12.095Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: follow_status_checked, Msg: Current follow status: Following.
[2025-04-25T05:29:12.096Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: determining_follow_action, Msg: Determining required action based on request ('follow') and status...
[2025-04-25T05:29:12.096Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: follow_action_determined, Msg: No API call needed (action: 'follow', current status: true).
[2025-04-25T05:29:12.096Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 PEJO9giIDBoOJm2NAAAB] FollowUnfollow: No API call executed for action 'follow'. Current status: true
[2025-04-25T05:29:12.096Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 PEJO9giIDBoOJm2NAAAB] FunctionRegistry: Execution finished for followUnfollowItem.
[2025-04-25T05:29:12.097Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043 Status Stub] Step: processing_function_result, Msg: Received result from followUnfollowItem.
[2025-04-25T05:29:12.097Z] [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043] Function followUnfollowItem executed. Result: You are already following the conference "ACCV" (ID: e76fd867-789c-47d9-abfa-79986f4a2478)....
[2025-04-25T05:29:12.097Z] --- [MsgHandler-1745558949156-Sub-ConferenceAgent-1745558950043] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T05:29:12.097Z] --- [MsgHandler-1745558949156 SubAgent Call End - PEJO9giIDBoOJm2NAAAB] ConferenceAgent finished. Status: success ---
[2025-04-25T05:29:12.098Z] [MsgHandler-1745558949156 History T1 Done - PEJO9giIDBoOJm2NAAAB] Appended function/routing response to Host history. Size: 9
[2025-04-25T05:29:12.098Z] --- [MsgHandler-1745558949156 HostAgent Turn 2 Start - PEJO9giIDBoOJm2NAAAB] Requesting final stream from HostAgent ---
[2025-04-25T05:29:12.098Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:12.099Z] [MsgHandler-1745558949156 History T2 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 9
[2025-04-25T05:29:12.099Z] [GeminiService] Received history with 9 items before mapping (for stream).
[2025-04-25T05:29:12.101Z] [GeminiService] Mapped history (SDK Content[]) with 9 items (for stream).
[2025-04-25T05:29:12.101Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T05:29:12.101Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:29:12.102Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:29:12.102Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:29:12.103Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:29:12.103Z] [GeminiService Stream] Preparing stream request with 9 Content items.
[2025-04-25T05:29:12.103Z]   - No valid next turn added, sending only history.
[2025-04-25T05:29:12.726Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T05:29:12.727Z] [MsgHandler-1745558949156 Stream T2 - PEJO9giIDBoOJm2NAAAB] Processing final stream from HostAgent...
[2025-04-25T05:29:12.727Z] [MsgHandler-1745558949156 Stream Processing - PEJO9giIDBoOJm2NAAAB] Starting... (Emit final: true)
[2025-04-25T05:29:12.728Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:12.728Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:12.811Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:12.892Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:12.956Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:12.976Z] [MsgHandler-1745558949156 Stream Processing - PEJO9giIDBoOJm2NAAAB] Finished. Length: 80
[2025-04-25T05:29:12.976Z] [MsgHandler-1745558949156 Stream Processing - PEJO9giIDBoOJm2NAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T05:29:12.977Z] [MsgHandler-1745558949156 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_result, Type: result
[2025-04-25T05:29:12.977Z] [MsgHandler-1745558949156 History T2 Done - PEJO9giIDBoOJm2NAAAB] Appended final HostAgent response. Size: 10
[2025-04-25T05:29:12.978Z] --- [MsgHandler-1745558949156 PEJO9giIDBoOJm2NAAAB Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T05:29:12.978Z] [MsgHandler-1745558949156 Save History Check] History to save. Size: 10.
[2025-04-25T05:29:12.978Z] [History Service] Updating history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 10
[2025-04-25T05:29:13.038Z] [History Service] Successfully updated history for conversationId: 680b1d6aacff3a287a68e17c. Modified: true
[2025-04-25T05:29:13.039Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558949156] Successfully updated history in DB for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:29:13.039Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:29:13.187Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:29:13.188Z] [Socket PEJO9giIDBoOJm2NAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T05:29:41.890Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558981890] Event 'send_message' received: UserInput="V√¢y h√£y b·ªè theo d√µi ...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b1d6aacff3a287a68e17c
[2025-04-25T05:29:41.891Z] [History Service] Getting history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T05:29:41.891Z] [History Service] Applying message limit: 50
[2025-04-25T05:29:41.939Z] [History Service] Found history for conversationId: 680b1d6aacff3a287a68e17c. Message count: 10
[2025-04-25T05:29:41.940Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558981890] Fetched 10 history items for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:29:41.940Z] --- [MsgHandler-1745558981890 Socket PEJO9giIDBoOJm2NAAAB] Handling STREAMING input: "V√¢y h√£y b·ªè theo d√µi cho t√¥i", Lang: vi ---
[2025-04-25T05:29:41.940Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T05:29:41.940Z] [MsgHandler-1745558981890] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T05:29:41.941Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:41.941Z] [MsgHandler-1745558981890 History Init - PEJO9giIDBoOJm2NAAAB] Added user turn. Size: 11
[2025-04-25T05:29:41.941Z] --- [MsgHandler-1745558981890 HostAgent Turn 1 Start - PEJO9giIDBoOJm2NAAAB] Requesting initial response from HostAgent ---
[2025-04-25T05:29:41.942Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:41.942Z] [MsgHandler-1745558981890 History T1 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 11
[2025-04-25T05:29:41.942Z] [GeminiService] Received history with 11 items before mapping (for stream).
[2025-04-25T05:29:41.942Z] [GeminiService] Mapped history (SDK Content[]) with 11 items (for stream).
[2025-04-25T05:29:41.943Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:29:41.943Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:29:41.943Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:29:41.944Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:29:41.944Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:29:41.944Z] [GeminiService Stream] Preparing stream request with 11 Content items.
[2025-04-25T05:29:41.944Z]   - No valid next turn added, sending only history.
[2025-04-25T05:29:42.806Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T05:29:42.806Z] [MsgHandler-1745558981890 HostAgent T1 - PEJO9giIDBoOJm2NAAAB] HostAgent requested function call: routeToAgent
[2025-04-25T05:29:42.806Z] [MsgHandler-1745558981890 History T1 Prep - PEJO9giIDBoOJm2NAAAB] Appended HostAgent FC request. Size: 12
[2025-04-25T05:29:42.807Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:42.807Z] --- [MsgHandler-1745558981890 SubAgent Call Start - PEJO9giIDBoOJm2NAAAB] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T05:29:42.808Z] --- [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Socket PEJO9giIDBoOJm2NAAAB] Calling Sub Agent: ConferenceAgent, Task: 87f44be0-7958-4c26-a0a0-83626ce15dc2 ---
[2025-04-25T05:29:42.808Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: vi
[2025-04-25T05:29:42.808Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808] Sending request to ConferenceAgent LLM.
[2025-04-25T05:29:42.808Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T05:29:42.809Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T05:29:42.809Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:29:42.809Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:29:42.809Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:29:42.809Z] Tools provided: ["getConferences","followUnfollowItem","drawChart"]
[2025-04-25T05:29:42.810Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:29:42.810Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T05:29:42.810Z]   - No valid next turn added, sending only history.
[2025-04-25T05:29:43.752Z] Model Finish Reason: STOP
[2025-04-25T05:29:43.753Z] Model requested function call: followUnfollowItem
[2025-04-25T05:29:43.753Z] Arguments: {"action":"unfollow","identifierType":"acronym","itemType":"conference","identifier":"ACCV"}
[2025-04-25T05:29:43.753Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T05:29:43.753Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808] ConferenceAgent requested function call: followUnfollowItem
[2025-04-25T05:29:43.754Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 PEJO9giIDBoOJm2NAAAB] FunctionRegistry: Attempting execution: followUnfollowItem
[2025-04-25T05:29:43.754Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: function_call, Msg: Received request to call function: followUnfollowItem
[2025-04-25T05:29:43.754Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 PEJO9giIDBoOJm2NAAAB] Handler: FollowUnfollowItem, Args: {"action":"unfollow","identifierType":"acronym","itemType":"conference","identifier":"ACCV"} Auth: true
[2025-04-25T05:29:43.754Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: validating_function_args, Msg: Validating follow/unfollow arguments...
[2025-04-25T05:29:43.754Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: checking_authentication, Msg: Checking authentication status...
[2025-04-25T05:29:43.755Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: processing_request, Msg: Processing unfollow request for conference: "ACCV"...
[2025-04-25T05:29:43.755Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: finding_item_id, Msg: Searching for conference with acronym: "ACCV"...
[2025-04-25T05:29:43.755Z] Finding ID for conference with identifier: "ACCV" (type: acronym)
[2025-04-25T05:29:43.755Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=ACCV&perPage=1&page=1
[2025-04-25T05:29:43.908Z] Backend API Success for conference. Data length: 1642
[2025-04-25T05:29:43.908Z] Transforming conference data with Markdown. Search query: acronym=ACCV&perPage=1&page=1
[2025-04-25T05:29:43.910Z] Conference data transformed successfully.
[2025-04-25T05:29:43.911Z] Found conference ID: e76fd867-789c-47d9-abfa-79986f4a2478 for identifier "ACCV"
[2025-04-25T05:29:43.911Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: item_id_found, Msg: Found conference (ID: e76fd867-789c-47d9-abfa-79986f4a2478).
[2025-04-25T05:29:43.911Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: checking_follow_status, Msg: Checking your follow status for item e76fd867-789c-47d9-abfa-79986f4a2478...
[2025-04-25T05:29:43.912Z] Fetching followed conferences: GET http://confhub.engineer/api/v1/follow-conference/followed (using provided token)
[2025-04-25T05:29:44.055Z] Successfully fetched 5 followed conference(s).
[2025-04-25T05:29:44.055Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: follow_status_checked, Msg: Current follow status: Following.
[2025-04-25T05:29:44.056Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: determining_follow_action, Msg: Determining required action based on request ('unfollow') and status...
[2025-04-25T05:29:44.056Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: follow_action_determined, Msg: API call required to unfollow item e76fd867-789c-47d9-abfa-79986f4a2478.
[2025-04-25T05:29:44.056Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: preparing_follow_api_call, Msg: Unfollowing item e76fd867-789c-47d9-abfa-79986f4a2478...
[2025-04-25T05:29:44.057Z] Executing unfollow action for conference e76fd867-789c-47d9-abfa-79986f4a2478: POST http://confhub.engineer/api/v1/follow-conference/remove (using provided token)
[2025-04-25T05:29:44.127Z] Successfully executed unfollow for conference e76fd867-789c-47d9-abfa-79986f4a2478.
[2025-04-25T05:29:44.128Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 PEJO9giIDBoOJm2NAAAB] FollowUnfollow: API call for unfollow successful.
[2025-04-25T05:29:44.128Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: follow_update_success, Msg: Successfully unfollowed conference.
[2025-04-25T05:29:44.128Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 PEJO9giIDBoOJm2NAAAB] FunctionRegistry: Execution finished for followUnfollowItem.
[2025-04-25T05:29:44.128Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808 Status Stub] Step: processing_function_result, Msg: Received result from followUnfollowItem.
[2025-04-25T05:29:44.128Z] [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808] Function followUnfollowItem executed. Result: Successfully unfollowed the conference "ACCV" (ID: e76fd867-789c-47d9-abfa-79986f4a2478)....
[2025-04-25T05:29:44.129Z] --- [MsgHandler-1745558981890-Sub-ConferenceAgent-1745558982808] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T05:29:44.129Z] --- [MsgHandler-1745558981890 SubAgent Call End - PEJO9giIDBoOJm2NAAAB] ConferenceAgent finished. Status: success ---
[2025-04-25T05:29:44.129Z] [MsgHandler-1745558981890 History T1 Done - PEJO9giIDBoOJm2NAAAB] Appended function/routing response to Host history. Size: 13
[2025-04-25T05:29:44.130Z] --- [MsgHandler-1745558981890 HostAgent Turn 2 Start - PEJO9giIDBoOJm2NAAAB] Requesting final stream from HostAgent ---
[2025-04-25T05:29:44.130Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:44.130Z] [MsgHandler-1745558981890 History T2 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 13
[2025-04-25T05:29:44.131Z] [GeminiService] Received history with 13 items before mapping (for stream).
[2025-04-25T05:29:44.131Z] [GeminiService] Mapped history (SDK Content[]) with 13 items (for stream).
[2025-04-25T05:29:44.132Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T05:29:44.132Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:29:44.133Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:29:44.133Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:29:44.133Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:29:44.134Z] [GeminiService Stream] Preparing stream request with 13 Content items.
[2025-04-25T05:29:44.134Z]   - No valid next turn added, sending only history.
[2025-04-25T05:29:44.630Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T05:29:44.631Z] [MsgHandler-1745558981890 Stream T2 - PEJO9giIDBoOJm2NAAAB] Processing final stream from HostAgent...
[2025-04-25T05:29:44.632Z] [MsgHandler-1745558981890 Stream Processing - PEJO9giIDBoOJm2NAAAB] Starting... (Emit final: true)
[2025-04-25T05:29:44.633Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:29:44.634Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:44.737Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:44.805Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:44.887Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:29:44.902Z] [MsgHandler-1745558981890 Stream Processing - PEJO9giIDBoOJm2NAAAB] Finished. Length: 86
[2025-04-25T05:29:44.902Z] [MsgHandler-1745558981890 Stream Processing - PEJO9giIDBoOJm2NAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T05:29:44.903Z] [MsgHandler-1745558981890 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_result, Type: result
[2025-04-25T05:29:44.903Z] [MsgHandler-1745558981890 History T2 Done - PEJO9giIDBoOJm2NAAAB] Appended final HostAgent response. Size: 14
[2025-04-25T05:29:44.903Z] --- [MsgHandler-1745558981890 PEJO9giIDBoOJm2NAAAB Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T05:29:44.904Z] [MsgHandler-1745558981890 Save History Check] History to save. Size: 14.
[2025-04-25T05:29:44.904Z] [History Service] Updating history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 14
[2025-04-25T05:29:44.971Z] [History Service] Successfully updated history for conversationId: 680b1d6aacff3a287a68e17c. Modified: true
[2025-04-25T05:29:44.972Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745558981890] Successfully updated history in DB for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:29:44.972Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:29:45.108Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:29:45.109Z] [Socket PEJO9giIDBoOJm2NAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T05:30:00.001Z] [Cron] Running scheduled log analysis...
[2025-04-25T05:30:00.001Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T05:30:00.162Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T05:30:00.166Z] [Cron] Log analysis finished and results broadcasted.
[2025-04-25T05:30:10.258Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745559010258] Event 'send_message' received: UserInput="Theo d√µi h·ªôi ngh·ªã SI...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b1d6aacff3a287a68e17c
[2025-04-25T05:30:10.259Z] [History Service] Getting history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T05:30:10.259Z] [History Service] Applying message limit: 50
[2025-04-25T05:30:10.310Z] [History Service] Found history for conversationId: 680b1d6aacff3a287a68e17c. Message count: 14
[2025-04-25T05:30:10.310Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745559010258] Fetched 14 history items for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:30:10.311Z] --- [MsgHandler-1745559010258 Socket PEJO9giIDBoOJm2NAAAB] Handling STREAMING input: "Theo d√µi h·ªôi ngh·ªã SIROCCO cho t√¥i ƒëi", Lang: vi ---
[2025-04-25T05:30:10.311Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T05:30:10.311Z] [MsgHandler-1745559010258] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T05:30:10.312Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:30:10.312Z] [MsgHandler-1745559010258 History Init - PEJO9giIDBoOJm2NAAAB] Added user turn. Size: 15
[2025-04-25T05:30:10.313Z] --- [MsgHandler-1745559010258 HostAgent Turn 1 Start - PEJO9giIDBoOJm2NAAAB] Requesting initial response from HostAgent ---
[2025-04-25T05:30:10.313Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:30:10.314Z] [MsgHandler-1745559010258 History T1 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 15
[2025-04-25T05:30:10.314Z] [GeminiService] Received history with 15 items before mapping (for stream).
[2025-04-25T05:30:10.315Z] [GeminiService] Mapped history (SDK Content[]) with 15 items (for stream).
[2025-04-25T05:30:10.315Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:30:10.315Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:30:10.315Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:30:10.316Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:30:10.316Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:30:10.316Z] [GeminiService Stream] Preparing stream request with 15 Content items.
[2025-04-25T05:30:10.334Z]   - No valid next turn added, sending only history.
[2025-04-25T05:30:11.172Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T05:30:11.173Z] [MsgHandler-1745559010258 HostAgent T1 - PEJO9giIDBoOJm2NAAAB] HostAgent requested function call: routeToAgent
[2025-04-25T05:30:11.173Z] [MsgHandler-1745559010258 History T1 Prep - PEJO9giIDBoOJm2NAAAB] Appended HostAgent FC request. Size: 16
[2025-04-25T05:30:11.174Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:30:11.174Z] --- [MsgHandler-1745559010258 SubAgent Call Start - PEJO9giIDBoOJm2NAAAB] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T05:30:11.174Z] --- [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Socket PEJO9giIDBoOJm2NAAAB] Calling Sub Agent: ConferenceAgent, Task: 8b12f7d1-bb84-4ccf-918f-ed55fb86ab20 ---
[2025-04-25T05:30:11.174Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: vi
[2025-04-25T05:30:11.175Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174] Sending request to ConferenceAgent LLM.
[2025-04-25T05:30:11.175Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T05:30:11.175Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T05:30:11.176Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T05:30:11.176Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:30:11.176Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:30:11.176Z] Tools provided: ["getConferences","followUnfollowItem","drawChart"]
[2025-04-25T05:30:11.177Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:30:11.177Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T05:30:11.177Z]   - No valid next turn added, sending only history.
[2025-04-25T05:30:12.089Z] Model Finish Reason: STOP
[2025-04-25T05:30:12.090Z] Model requested function call: followUnfollowItem
[2025-04-25T05:30:12.090Z] Arguments: {"action":"follow","identifierType":"acronym","identifier":"SIROCCO","itemType":"conference"}
[2025-04-25T05:30:12.090Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T05:30:12.091Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174] ConferenceAgent requested function call: followUnfollowItem
[2025-04-25T05:30:12.091Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 PEJO9giIDBoOJm2NAAAB] FunctionRegistry: Attempting execution: followUnfollowItem
[2025-04-25T05:30:12.091Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: function_call, Msg: Received request to call function: followUnfollowItem
[2025-04-25T05:30:12.091Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 PEJO9giIDBoOJm2NAAAB] Handler: FollowUnfollowItem, Args: {"action":"follow","identifierType":"acronym","identifier":"SIROCCO","itemType":"conference"} Auth: true
[2025-04-25T05:30:12.092Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: validating_function_args, Msg: Validating follow/unfollow arguments...
[2025-04-25T05:30:12.092Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: checking_authentication, Msg: Checking authentication status...
[2025-04-25T05:30:12.092Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: processing_request, Msg: Processing follow request for conference: "SIROCCO"...
[2025-04-25T05:30:12.092Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: finding_item_id, Msg: Searching for conference with acronym: "SIROCCO"...
[2025-04-25T05:30:12.093Z] Finding ID for conference with identifier: "SIROCCO" (type: acronym)
[2025-04-25T05:30:12.093Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=SIROCCO&perPage=1&page=1
[2025-04-25T05:30:12.301Z] Backend API Success for conference. Data length: 1546
[2025-04-25T05:30:12.301Z] Transforming conference data with Markdown. Search query: acronym=SIROCCO&perPage=1&page=1
[2025-04-25T05:30:12.303Z] Conference data transformed successfully.
[2025-04-25T05:30:12.304Z] Found conference ID: 1628ee69-dcb2-4cd5-b086-248a848e16c3 for identifier "SIROCCO"
[2025-04-25T05:30:12.304Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: item_id_found, Msg: Found conference (ID: 1628ee69-dcb2-4cd5-b086-248a848e16c3).
[2025-04-25T05:30:12.304Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: checking_follow_status, Msg: Checking your follow status for item 1628ee69-dcb2-4cd5-b086-248a848e16c3...
[2025-04-25T05:30:12.304Z] Fetching followed conferences: GET http://confhub.engineer/api/v1/follow-conference/followed (using provided token)
[2025-04-25T05:30:12.481Z] Successfully fetched 4 followed conference(s).
[2025-04-25T05:30:12.481Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: follow_status_checked, Msg: Current follow status: Not Following.
[2025-04-25T05:30:12.481Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: determining_follow_action, Msg: Determining required action based on request ('follow') and status...
[2025-04-25T05:30:12.482Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: follow_action_determined, Msg: API call required to follow item 1628ee69-dcb2-4cd5-b086-248a848e16c3.
[2025-04-25T05:30:12.482Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: preparing_follow_api_call, Msg: Following item 1628ee69-dcb2-4cd5-b086-248a848e16c3...
[2025-04-25T05:30:12.482Z] Executing follow action for conference 1628ee69-dcb2-4cd5-b086-248a848e16c3: POST http://confhub.engineer/api/v1/follow-conference/add (using provided token)
[2025-04-25T05:30:12.564Z] Successfully executed follow for conference 1628ee69-dcb2-4cd5-b086-248a848e16c3.
[2025-04-25T05:30:12.565Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 PEJO9giIDBoOJm2NAAAB] FollowUnfollow: API call for follow successful.
[2025-04-25T05:30:12.565Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: follow_update_success, Msg: Successfully followed conference.
[2025-04-25T05:30:12.565Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 PEJO9giIDBoOJm2NAAAB] FunctionRegistry: Execution finished for followUnfollowItem.
[2025-04-25T05:30:12.565Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174 Status Stub] Step: processing_function_result, Msg: Received result from followUnfollowItem.
[2025-04-25T05:30:12.566Z] [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174] Function followUnfollowItem executed. Result: Successfully followed the conference "SIROCCO" (ID: 1628ee69-dcb2-4cd5-b086-248a848e16c3)....
[2025-04-25T05:30:12.566Z] --- [MsgHandler-1745559010258-Sub-ConferenceAgent-1745559011174] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T05:30:12.566Z] --- [MsgHandler-1745559010258 SubAgent Call End - PEJO9giIDBoOJm2NAAAB] ConferenceAgent finished. Status: success ---
[2025-04-25T05:30:12.567Z] [MsgHandler-1745559010258 History T1 Done - PEJO9giIDBoOJm2NAAAB] Appended function/routing response to Host history. Size: 17
[2025-04-25T05:30:12.567Z] --- [MsgHandler-1745559010258 HostAgent Turn 2 Start - PEJO9giIDBoOJm2NAAAB] Requesting final stream from HostAgent ---
[2025-04-25T05:30:12.567Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:30:12.568Z] [MsgHandler-1745559010258 History T2 Send - PEJO9giIDBoOJm2NAAAB] Host History Size: 17
[2025-04-25T05:30:12.568Z] [GeminiService] Received history with 17 items before mapping (for stream).
[2025-04-25T05:30:12.568Z] [GeminiService] Mapped history (SDK Content[]) with 17 items (for stream).
[2025-04-25T05:30:12.568Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T05:30:12.569Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T05:30:12.569Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T05:30:12.569Z] Tools provided: ["routeToAgent"]
[2025-04-25T05:30:12.569Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T05:30:12.569Z] [GeminiService Stream] Preparing stream request with 17 Content items.
[2025-04-25T05:30:12.570Z]   - No valid next turn added, sending only history.
[2025-04-25T05:30:13.224Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T05:30:13.224Z] [MsgHandler-1745559010258 Stream T2 - PEJO9giIDBoOJm2NAAAB] Processing final stream from HostAgent...
[2025-04-25T05:30:13.224Z] [MsgHandler-1745559010258 Stream Processing - PEJO9giIDBoOJm2NAAAB] Starting... (Emit final: true)
[2025-04-25T05:30:13.225Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: status_update, Type: status
[2025-04-25T05:30:13.225Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:30:13.315Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:30:13.364Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:30:13.433Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_update, Type: partial_result
[2025-04-25T05:30:13.448Z] [MsgHandler-1745559010258 Stream Processing - PEJO9giIDBoOJm2NAAAB] Finished. Length: 86
[2025-04-25T05:30:13.448Z] [MsgHandler-1745559010258 Stream Processing - PEJO9giIDBoOJm2NAAAB] Emitting final chat_result via safeEmit.
[2025-04-25T05:30:13.449Z] [MsgHandler-1745559010258 Emit Sent - PEJO9giIDBoOJm2NAAAB] Event: chat_result, Type: result
[2025-04-25T05:30:13.450Z] [MsgHandler-1745559010258 History T2 Done - PEJO9giIDBoOJm2NAAAB] Appended final HostAgent response. Size: 18
[2025-04-25T05:30:13.450Z] --- [MsgHandler-1745559010258 PEJO9giIDBoOJm2NAAAB Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T05:30:13.450Z] [MsgHandler-1745559010258 Save History Check] History to save. Size: 18.
[2025-04-25T05:30:13.450Z] [History Service] Updating history for conversationId: 680b1d6aacff3a287a68e17c, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 18
[2025-04-25T05:30:13.513Z] [History Service] Successfully updated history for conversationId: 680b1d6aacff3a287a68e17c. Modified: true
[2025-04-25T05:30:13.514Z] [Socket PEJO9giIDBoOJm2NAAAB MsgHandler-1745559010258] Successfully updated history in DB for conv 680b1d6aacff3a287a68e17c.
[2025-04-25T05:30:13.514Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T05:30:13.651Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T05:30:13.652Z] [Socket PEJO9giIDBoOJm2NAAAB] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T09:18:25.650Z] [Server Config] Loaded PORT: 3001
[2025-04-25T09:18:25.652Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T09:18:25.652Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T09:18:25.652Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T09:18:25.652Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T09:18:33.276Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T09:18:33.276Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T09:18:33.801Z] [Server Start] Initializing loaders...
[2025-04-25T09:18:33.802Z] [Loader] Starting application loading process...
[2025-04-25T09:18:33.803Z] [Loader DB] Attempting database connection...
[2025-04-25T09:18:33.804Z] [Database] Attempting MongoDB connection...
[2025-04-25T09:18:34.557Z] [Database] MongoDB Connected Successfully.
[2025-04-25T09:18:34.557Z] [Loader DB] Database connection successful.
[2025-04-25T09:18:34.558Z] [Loader] Database loaded.
[2025-04-25T09:18:34.558Z] [History Service] Initialized.
[2025-04-25T09:18:34.558Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T09:18:34.559Z] [Loader] Services initialized.
[2025-04-25T09:18:34.564Z] [Express] Mounted API routes at /api
[2025-04-25T09:18:34.564Z] [Express] Registered Not Found handler.
[2025-04-25T09:18:34.565Z] [Express] Registered Global Error handler.
[2025-04-25T09:18:34.565Z] [Express] Express app configured.
[2025-04-25T09:18:34.566Z] [Loader] Express loaded.
[2025-04-25T09:18:34.567Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T09:18:34.571Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T09:18:34.572Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T09:18:34.572Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T09:18:34.572Z] [Loader] Socket.IO loaded.
[2025-04-25T09:18:34.573Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T09:18:34.573Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T09:18:34.607Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T09:18:34.607Z] [Loader] Jobs scheduled.
[2025-04-25T09:18:34.607Z] [Loader] Performing initial log analysis...
[2025-04-25T09:18:34.608Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T09:18:34.696Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T09:18:34.697Z] [Loader] Initial log analysis completed.
[2025-04-25T09:18:34.697Z] [Loader] All loaders completed successfully.
[2025-04-25T09:18:34.701Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T09:18:34.702Z] üîó Access the server at: http://localhost:3001
[2025-04-25T09:18:34.702Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T09:18:34.702Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T09:30:00.903Z] [Cron] Running scheduled log analysis...
[2025-04-25T09:30:00.904Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T09:30:00.992Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T09:30:00.995Z] [Cron] Log analysis finished and results broadcasted.
[2025-04-25T10:30:00.228Z] [Cron] Running scheduled log analysis...
[2025-04-25T10:30:00.230Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T10:30:00.492Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T10:30:00.493Z] [Cron] Log analysis finished and results broadcasted.
[2025-04-25T10:55:14.705Z] [Server Config] Loaded PORT: 3001
[2025-04-25T10:55:14.707Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T10:55:14.707Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T10:55:14.707Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T10:55:14.708Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T10:55:21.921Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T10:55:21.922Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T10:55:22.337Z] [Server Start] Initializing loaders...
[2025-04-25T10:55:22.338Z] [Loader] Starting application loading process...
[2025-04-25T10:55:22.338Z] [Loader DB] Attempting database connection...
[2025-04-25T10:55:22.339Z] [Database] Attempting MongoDB connection...
[2025-04-25T10:55:23.113Z] [Database] MongoDB Connected Successfully.
[2025-04-25T10:55:23.113Z] [Loader DB] Database connection successful.
[2025-04-25T10:55:23.114Z] [Loader] Database loaded.
[2025-04-25T10:55:23.114Z] [History Service] Initialized.
[2025-04-25T10:55:23.114Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T10:55:23.115Z] [Loader] Services initialized.
[2025-04-25T10:55:23.121Z] [Express] Mounted API routes at /api
[2025-04-25T10:55:23.121Z] [Express] Registered Not Found handler.
[2025-04-25T10:55:23.122Z] [Express] Registered Global Error handler.
[2025-04-25T10:55:23.122Z] [Express] Express app configured.
[2025-04-25T10:55:23.123Z] [Loader] Express loaded.
[2025-04-25T10:55:23.124Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T10:55:23.128Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T10:55:23.129Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T10:55:23.129Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T10:55:23.129Z] [Loader] Socket.IO loaded.
[2025-04-25T10:55:23.129Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T10:55:23.130Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T10:55:23.161Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T10:55:23.162Z] [Loader] Jobs scheduled.
[2025-04-25T10:55:23.162Z] [Loader] Performing initial log analysis...
[2025-04-25T10:55:23.163Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T10:55:23.269Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T10:55:23.269Z] [Loader] Initial log analysis completed.
[2025-04-25T10:55:23.270Z] [Loader] All loaders completed successfully.
[2025-04-25T10:55:23.274Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T10:55:23.275Z] üîó Access the server at: http://localhost:3001
[2025-04-25T10:55:23.275Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T10:55:23.276Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T10:55:29.187Z] [HTTP Request] --> POST /api/v2/crawl-journals?CRAWL_MODE=csv from ::1 (User-Agent: axios/1.7.9)
[2025-04-25T10:55:35.888Z] [HTTP Response] <-- POST /api/v2/crawl-journals?CRAWL_MODE=csv 200 6701ms
[2025-04-25T11:06:13.966Z] [Socket Auth MW] Attempting auth for socket D2t2NmVv0UXlGd-DAAAC. Token provided: false
[2025-04-25T11:06:13.966Z] [Socket Auth MW] No token provided for socket D2t2NmVv0UXlGd-DAAAC. Treating as anonymous.
[2025-04-25T11:06:13.969Z] [Socket.IO D2t2NmVv0UXlGd-DAAAC] Client connected. Token present: false
[2025-04-25T11:06:13.971Z] [Socket.IO D2t2NmVv0UXlGd-DAAAC] Anonymous user connected.
[2025-04-25T11:06:13.974Z] [Socket D2t2NmVv0UXlGd-DAAAC] Registering core event handlers. UserID: Anonymous
[2025-04-25T11:06:13.974Z] [Socket D2t2NmVv0UXlGd-DAAAC] Core event handlers registered.
[2025-04-25T11:06:13.976Z] [Socket.IO D2t2NmVv0UXlGd-DAAAC] Client disconnected. Reason: transport close. UserID: Anonymous. ActiveConvID: N/A
[2025-04-25T11:06:13.998Z] [Socket Auth MW] Attempting auth for socket DU4uM4vAv6EoQfakAAAE. Token provided: true
[2025-04-25T11:06:14.009Z] [Socket Auth MW] Token signature validated successfully for socket DU4uM4vAv6EoQfakAAAE.
[2025-04-25T11:06:14.009Z] [Socket.IO DU4uM4vAv6EoQfakAAAE] Client connected. Token present: true
[2025-04-25T11:06:14.010Z] [Socket.IO DU4uM4vAv6EoQfakAAAE] Attempting to fetch user info using token...
[2025-04-25T11:06:14.012Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T11:06:14.250Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:06:14.250Z] [Socket.IO DU4uM4vAv6EoQfakAAAE] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T11:06:14.251Z] [Socket.IO DU4uM4vAv6EoQfakAAAE] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T11:06:14.251Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T11:06:14.423Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:06:14.424Z] [Socket.IO DU4uM4vAv6EoQfakAAAE] Sent initial conversation list (10 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T11:06:14.424Z] [Socket.IO DU4uM4vAv6EoQfakAAAE] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T11:06:14.425Z] [Socket DU4uM4vAv6EoQfakAAAE] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:06:14.425Z] [Socket DU4uM4vAv6EoQfakAAAE] Core event handlers registered.
[2025-04-25T11:06:22.243Z] [Socket DU4uM4vAv6EoQfakAAAE] Event 'start_new_conversation' received for user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T11:06:22.244Z] [History Service] Explicitly creating new conversation for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:06:22.334Z] [History Service] Created new conversationId: 680b6cae046f6a68f2c043f2 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:06:22.335Z] [Socket DU4uM4vAv6EoQfakAAAE] Started new conversation 680b6cae046f6a68f2c043f2. Set as active.
[2025-04-25T11:06:22.335Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T11:06:22.498Z] [History Service] Found 11 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:06:22.499Z] [Socket DU4uM4vAv6EoQfakAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after new conversation start.
[2025-04-25T11:07:35.082Z] [Socket DU4uM4vAv6EoQfakAAAE MsgHandler-1745579255081] Event 'send_message' received: UserInput="b·ªè theo d√µi h·ªôi ngh·ªã...", Streaming=true, Lang=vi, UserID=c0d9d488-3fee-4dda-98f3-5df278ed0e82, ActiveConvID=680b6cae046f6a68f2c043f2
[2025-04-25T11:07:35.082Z] [History Service] Getting history for conversationId: 680b6cae046f6a68f2c043f2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 50
[2025-04-25T11:07:35.083Z] [History Service] Applying message limit: 50
[2025-04-25T11:07:35.142Z] [History Service] Found history for conversationId: 680b6cae046f6a68f2c043f2. Message count: 0
[2025-04-25T11:07:35.142Z] [Socket DU4uM4vAv6EoQfakAAAE MsgHandler-1745579255081] Fetched 0 history items for conv 680b6cae046f6a68f2c043f2.
[2025-04-25T11:07:35.145Z] --- [MsgHandler-1745579255081 Socket DU4uM4vAv6EoQfakAAAE] Handling STREAMING input: "b·ªè theo d√µi h·ªôi ngh·ªã SIROCCO cho t√¥i", Lang: vi ---
[2025-04-25T11:07:35.146Z] [Language Config] Using configuration for Agent: HostAgent, Language: vi
[2025-04-25T11:07:35.146Z] [MsgHandler-1745579255081] Using HostAgent Config (Lang: vi). Tools: routeToAgent
[2025-04-25T11:07:35.148Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: status_update, Type: status
[2025-04-25T11:07:35.148Z] [MsgHandler-1745579255081 History Init - DU4uM4vAv6EoQfakAAAE] Added user turn. Size: 1
[2025-04-25T11:07:35.148Z] --- [MsgHandler-1745579255081 HostAgent Turn 1 Start - DU4uM4vAv6EoQfakAAAE] Requesting initial response from HostAgent ---
[2025-04-25T11:07:35.149Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: status_update, Type: status
[2025-04-25T11:07:35.150Z] [MsgHandler-1745579255081 History T1 Send - DU4uM4vAv6EoQfakAAAE] Host History Size: 1
[2025-04-25T11:07:35.151Z] [GeminiService] Received history with 1 items before mapping (for stream).
[2025-04-25T11:07:35.151Z] [GeminiService] Mapped history (SDK Content[]) with 1 items (for stream).
[2025-04-25T11:07:35.152Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T11:07:35.152Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T11:07:35.152Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T11:07:35.153Z] Tools provided: ["routeToAgent"]
[2025-04-25T11:07:35.153Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T11:07:35.153Z] [GeminiService Stream] Preparing stream request with 1 Content items.
[2025-04-25T11:07:35.154Z]   - No valid next turn added, sending only history.
[2025-04-25T11:07:36.106Z] [GeminiService Stream] Received function call in first chunk: routeToAgent
[2025-04-25T11:07:36.107Z] [MsgHandler-1745579255081 HostAgent T1 - DU4uM4vAv6EoQfakAAAE] HostAgent requested function call: routeToAgent
[2025-04-25T11:07:36.107Z] [MsgHandler-1745579255081 History T1 Prep - DU4uM4vAv6EoQfakAAAE] Appended HostAgent FC request. Size: 2
[2025-04-25T11:07:36.109Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: status_update, Type: status
[2025-04-25T11:07:36.110Z] --- [MsgHandler-1745579255081 SubAgent Call Start - DU4uM4vAv6EoQfakAAAE] Calling ConferenceAgent via callSubAgent ---
[2025-04-25T11:07:36.111Z] --- [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Socket DU4uM4vAv6EoQfakAAAE] Calling Sub Agent: ConferenceAgent, Task: 391430cf-3578-463e-be48-6739fe7b1881 ---
[2025-04-25T11:07:36.112Z] [Language Config] Using configuration for Agent: ConferenceAgent, Language: vi
[2025-04-25T11:07:36.112Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111] Sending request to ConferenceAgent LLM.
[2025-04-25T11:07:36.113Z] [GeminiService] Received history with 1 items before mapping.
[2025-04-25T11:07:36.113Z] [GeminiService] Mapped to effectiveHistory (SDK Content[]) with 1 items.
[2025-04-25T11:07:36.114Z] [GeminiService] Last item role in effectiveHistory: user
[2025-04-25T11:07:36.114Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T11:07:36.114Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T11:07:36.114Z] Tools provided: ["getConferences","followUnfollowItem","drawChart"]
[2025-04-25T11:07:36.115Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T11:07:36.115Z] [GeminiService] Sending total 1 Content items to API.
[2025-04-25T11:07:36.115Z]   - No valid next turn added, sending only history.
[2025-04-25T11:07:37.927Z] Model Finish Reason: STOP
[2025-04-25T11:07:37.928Z] Model requested function call: followUnfollowItem
[2025-04-25T11:07:37.928Z] Arguments: {"identifier":"SIROCCO","itemType":"conference","action":"unfollow","identifierType":"acronym"}
[2025-04-25T11:07:37.928Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111] Received result from ConferenceAgent LLM: Status requires_function_call
[2025-04-25T11:07:37.928Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111] ConferenceAgent requested function call: followUnfollowItem
[2025-04-25T11:07:37.929Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 DU4uM4vAv6EoQfakAAAE] FunctionRegistry: Attempting execution: followUnfollowItem
[2025-04-25T11:07:37.929Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: function_call, Msg: Received request to call function: followUnfollowItem
[2025-04-25T11:07:37.931Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 DU4uM4vAv6EoQfakAAAE] Handler: FollowUnfollowItem, Args: {"identifier":"SIROCCO","itemType":"conference","action":"unfollow","identifierType":"acronym"} Auth: true
[2025-04-25T11:07:37.931Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: validating_function_args, Msg: Validating follow/unfollow arguments...
[2025-04-25T11:07:37.932Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: checking_authentication, Msg: Checking authentication status...
[2025-04-25T11:07:37.932Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: processing_request, Msg: Processing unfollow request for conference: "SIROCCO"...
[2025-04-25T11:07:37.932Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: finding_item_id, Msg: Searching for conference with acronym: "SIROCCO"...
[2025-04-25T11:07:37.933Z] Finding ID for conference with identifier: "SIROCCO" (type: acronym)
[2025-04-25T11:07:37.933Z] Executing backend API call: GET http://confhub.engineer/api/v1/conference?acronym=SIROCCO&perPage=1&page=1
[2025-04-25T11:07:38.077Z] Backend API Success for conference. Data length: 1546
[2025-04-25T11:07:38.078Z] Transforming conference data with Markdown. Search query: acronym=SIROCCO&perPage=1&page=1
[2025-04-25T11:07:38.081Z] Conference data transformed successfully.
[2025-04-25T11:07:38.082Z] Found conference ID: 1628ee69-dcb2-4cd5-b086-248a848e16c3 for identifier "SIROCCO"
[2025-04-25T11:07:38.082Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: item_id_found, Msg: Found conference (ID: 1628ee69-dcb2-4cd5-b086-248a848e16c3).
[2025-04-25T11:07:38.082Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: checking_follow_status, Msg: Checking your follow status for item 1628ee69-dcb2-4cd5-b086-248a848e16c3...
[2025-04-25T11:07:38.083Z] Fetching followed conferences: GET http://confhub.engineer/api/v1/follow-conference/followed (using provided token)
[2025-04-25T11:07:38.214Z] Successfully fetched 5 followed conference(s).
[2025-04-25T11:07:38.215Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: follow_status_checked, Msg: Current follow status: Following.
[2025-04-25T11:07:38.215Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: determining_follow_action, Msg: Determining required action based on request ('unfollow') and status...
[2025-04-25T11:07:38.215Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: follow_action_determined, Msg: API call required to unfollow item 1628ee69-dcb2-4cd5-b086-248a848e16c3.
[2025-04-25T11:07:38.215Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: preparing_follow_api_call, Msg: Unfollowing item 1628ee69-dcb2-4cd5-b086-248a848e16c3...
[2025-04-25T11:07:38.216Z] Executing unfollow action for conference 1628ee69-dcb2-4cd5-b086-248a848e16c3: POST http://confhub.engineer/api/v1/follow-conference/remove (using provided token)
[2025-04-25T11:07:38.293Z] Successfully executed unfollow for conference 1628ee69-dcb2-4cd5-b086-248a848e16c3.
[2025-04-25T11:07:38.293Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 DU4uM4vAv6EoQfakAAAE] FollowUnfollow: API call for unfollow successful.
[2025-04-25T11:07:38.294Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: follow_update_success, Msg: Successfully unfollowed conference.
[2025-04-25T11:07:38.294Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 DU4uM4vAv6EoQfakAAAE] FunctionRegistry: Execution finished for followUnfollowItem.
[2025-04-25T11:07:38.294Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111 Status Stub] Step: processing_function_result, Msg: Received result from followUnfollowItem.
[2025-04-25T11:07:38.295Z] [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111] Function followUnfollowItem executed. Result: Successfully unfollowed the conference "SIROCCO" (ID: 1628ee69-dcb2-4cd5-b086-248a848e16c3)....
[2025-04-25T11:07:38.295Z] --- [MsgHandler-1745579255081-Sub-ConferenceAgent-1745579256111] Sub Agent ConferenceAgent finished. Status: success ---
[2025-04-25T11:07:38.296Z] --- [MsgHandler-1745579255081 SubAgent Call End - DU4uM4vAv6EoQfakAAAE] ConferenceAgent finished. Status: success ---
[2025-04-25T11:07:38.297Z] [MsgHandler-1745579255081 History T1 Done - DU4uM4vAv6EoQfakAAAE] Appended function/routing response to Host history. Size: 3
[2025-04-25T11:07:38.297Z] --- [MsgHandler-1745579255081 HostAgent Turn 2 Start - DU4uM4vAv6EoQfakAAAE] Requesting final stream from HostAgent ---
[2025-04-25T11:07:38.298Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: status_update, Type: status
[2025-04-25T11:07:38.299Z] [MsgHandler-1745579255081 History T2 Send - DU4uM4vAv6EoQfakAAAE] Host History Size: 3
[2025-04-25T11:07:38.299Z] [GeminiService] Received history with 3 items before mapping (for stream).
[2025-04-25T11:07:38.300Z] [GeminiService] Mapped history (SDK Content[]) with 3 items (for stream).
[2025-04-25T11:07:38.300Z] [GeminiService] Last item role in effectiveHistory: function
[2025-04-25T11:07:38.300Z] Calling generateContent for model: gemini-2.0-flash
[2025-04-25T11:07:38.301Z] Generation Config: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T11:07:38.301Z] Tools provided: ["routeToAgent"]
[2025-04-25T11:07:38.301Z] [GeminiService] Received empty array or unexpected type as nextTurnInput, skipping adding this turn.
[2025-04-25T11:07:38.301Z] [GeminiService Stream] Preparing stream request with 3 Content items.
[2025-04-25T11:07:38.301Z]   - No valid next turn added, sending only history.
[2025-04-25T11:07:38.882Z] [GeminiService Stream] No function call in first chunk. Returning stream generator.
[2025-04-25T11:07:38.882Z] [MsgHandler-1745579255081 Stream T2 - DU4uM4vAv6EoQfakAAAE] Processing final stream from HostAgent...
[2025-04-25T11:07:38.883Z] [MsgHandler-1745579255081 Stream Processing - DU4uM4vAv6EoQfakAAAE] Starting... (Emit final: true)
[2025-04-25T11:07:38.883Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: status_update, Type: status
[2025-04-25T11:07:38.884Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: chat_update, Type: partial_result
[2025-04-25T11:07:38.996Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: chat_update, Type: partial_result
[2025-04-25T11:07:39.004Z] [MsgHandler-1745579255081 Stream Processing - DU4uM4vAv6EoQfakAAAE] Finished. Length: 47
[2025-04-25T11:07:39.004Z] [MsgHandler-1745579255081 Stream Processing - DU4uM4vAv6EoQfakAAAE] Emitting final chat_result via safeEmit.
[2025-04-25T11:07:39.005Z] [MsgHandler-1745579255081 Emit Sent - DU4uM4vAv6EoQfakAAAE] Event: chat_result, Type: result
[2025-04-25T11:07:39.005Z] [MsgHandler-1745579255081 History T2 Done - DU4uM4vAv6EoQfakAAAE] Appended final HostAgent response. Size: 4
[2025-04-25T11:07:39.006Z] --- [MsgHandler-1745579255081 DU4uM4vAv6EoQfakAAAE Lang: vi] STREAMING Handler execution finished. (Socket connected: true) ---
[2025-04-25T11:07:39.006Z] [MsgHandler-1745579255081 Save History Check] History to save. Size: 4.
[2025-04-25T11:07:39.008Z] [History Service] Updating history for conversationId: 680b6cae046f6a68f2c043f2, userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82. New history length: 4
[2025-04-25T11:07:39.093Z] [History Service] Successfully updated history for conversationId: 680b6cae046f6a68f2c043f2. Modified: true
[2025-04-25T11:07:39.093Z] [Socket DU4uM4vAv6EoQfakAAAE MsgHandler-1745579255081] Successfully updated history in DB for conv 680b6cae046f6a68f2c043f2.
[2025-04-25T11:07:39.093Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T11:07:39.256Z] [History Service] Found 11 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:07:39.257Z] [Socket DU4uM4vAv6EoQfakAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after message save.
[2025-04-25T11:20:14.339Z] [Socket.IO DU4uM4vAv6EoQfakAAAE] Client disconnected. Reason: transport close. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82. ActiveConvID: 680b6cae046f6a68f2c043f2
[2025-04-25T11:20:17.966Z] [Socket Auth MW] Attempting auth for socket baEgKY2gGwqBFMx1AAAI. Token provided: true
[2025-04-25T11:20:17.971Z] [Socket Auth MW] Token signature validated successfully for socket baEgKY2gGwqBFMx1AAAI.
[2025-04-25T11:20:17.972Z] [Socket.IO baEgKY2gGwqBFMx1AAAI] Client connected. Token present: true
[2025-04-25T11:20:17.972Z] [Socket.IO baEgKY2gGwqBFMx1AAAI] Attempting to fetch user info using token...
[2025-04-25T11:20:17.973Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T11:20:18.211Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:20:18.212Z] [Socket.IO baEgKY2gGwqBFMx1AAAI] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T11:20:18.212Z] [Socket.IO baEgKY2gGwqBFMx1AAAI] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T11:20:18.212Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T11:20:18.358Z] [History Service] Found 11 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:20:18.359Z] [Socket.IO baEgKY2gGwqBFMx1AAAI] Sent initial conversation list (11 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T11:20:18.359Z] [Socket.IO baEgKY2gGwqBFMx1AAAI] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T11:20:18.360Z] [Socket baEgKY2gGwqBFMx1AAAI] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:20:18.360Z] [Socket baEgKY2gGwqBFMx1AAAI] Core event handlers registered.
[2025-04-25T11:24:37.840Z] [Socket.IO baEgKY2gGwqBFMx1AAAI] Client disconnected. Reason: transport close. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82. ActiveConvID: N/A
[2025-04-25T11:24:44.820Z] [Socket Auth MW] Attempting auth for socket MF2_Vc51iOGuG2BGAAAM. Token provided: true
[2025-04-25T11:24:44.823Z] [Socket Auth MW] Token signature validated successfully for socket MF2_Vc51iOGuG2BGAAAM.
[2025-04-25T11:24:44.824Z] [Socket.IO MF2_Vc51iOGuG2BGAAAM] Client connected. Token present: true
[2025-04-25T11:24:44.824Z] [Socket.IO MF2_Vc51iOGuG2BGAAAM] Attempting to fetch user info using token...
[2025-04-25T11:24:44.824Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T11:24:44.943Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:24:44.944Z] [Socket.IO MF2_Vc51iOGuG2BGAAAM] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T11:24:44.944Z] [Socket.IO MF2_Vc51iOGuG2BGAAAM] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T11:24:44.944Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T11:24:45.090Z] [History Service] Found 11 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:24:45.091Z] [Socket.IO MF2_Vc51iOGuG2BGAAAM] Sent initial conversation list (11 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T11:24:45.091Z] [Socket.IO MF2_Vc51iOGuG2BGAAAM] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T11:24:45.092Z] [Socket MF2_Vc51iOGuG2BGAAAM] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T11:24:45.092Z] [Socket MF2_Vc51iOGuG2BGAAAM] Core event handlers registered.
[2025-04-25T11:30:00.943Z] [Cron] Running scheduled log analysis...
[2025-04-25T11:30:00.945Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T11:30:01.114Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T11:30:01.117Z] [Cron] Log analysis finished and results broadcasted.
[2025-04-25T13:33:22.894Z] [Server Config] Loaded PORT: 3001
[2025-04-25T13:33:22.895Z] [Server Config] Loaded MONGODB_URI: Set
[2025-04-25T13:33:22.895Z] [Server Config] Loaded JWT_SECRET: Set
[2025-04-25T13:33:22.896Z] [Server Config] Allowed CORS Origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T13:33:22.896Z] [Server Config] Loaded LOG_FILE_PATH: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T13:33:31.241Z] GeminiService initialized for model: gemini-2.0-flash
[2025-04-25T13:33:31.242Z] Loaded model config for CHATBOT: {"temperature":1,"topP":0.95,"topK":40,"maxOutputTokens":8192,"responseMimeType":"text/plain"}
[2025-04-25T13:33:31.771Z] [Server Start] Initializing loaders...
[2025-04-25T13:33:31.772Z] [Loader] Starting application loading process...
[2025-04-25T13:33:31.773Z] [Loader DB] Attempting database connection...
[2025-04-25T13:33:31.773Z] [Database] Attempting MongoDB connection...
[2025-04-25T13:33:34.623Z] [Database] MongoDB Connected Successfully.
[2025-04-25T13:33:34.623Z] [Loader DB] Database connection successful.
[2025-04-25T13:33:34.624Z] [Loader] Database loaded.
[2025-04-25T13:33:34.624Z] [History Service] Initialized.
[2025-04-25T13:33:34.624Z] [LogAnalysis Service] Initialized. Log file path: D:\NEW-SERVER-TS\logs\app.log
[2025-04-25T13:33:34.625Z] [Loader] Services initialized.
[2025-04-25T13:33:34.629Z] [Express] Mounted API routes at /api
[2025-04-25T13:33:34.630Z] [Express] Registered Not Found handler.
[2025-04-25T13:33:34.630Z] [Express] Registered Global Error handler.
[2025-04-25T13:33:34.630Z] [Express] Express app configured.
[2025-04-25T13:33:34.632Z] [Loader] Express loaded.
[2025-04-25T13:33:34.632Z] [Loader Socket] Initializing Socket.IO server...
[2025-04-25T13:33:34.636Z] [Loader Socket] Socket.IO authentication middleware applied.
[2025-04-25T13:33:34.636Z] [Loader Socket] Socket.IO connection handler registered.
[2025-04-25T13:33:34.637Z] [Loader Socket] Socket.IO server initialized successfully.
[2025-04-25T13:33:34.637Z] [Loader] Socket.IO loaded.
[2025-04-25T13:33:34.637Z] [Loader Jobs] Scheduling background jobs...
[2025-04-25T13:33:34.638Z] [Cron] Scheduling log analysis job with schedule: "30 * * * *"
[2025-04-25T13:33:34.671Z] [Loader Jobs] Background jobs scheduled.
[2025-04-25T13:33:34.671Z] [Loader] Jobs scheduled.
[2025-04-25T13:33:34.671Z] [Loader] Performing initial log analysis...
[2025-04-25T13:33:34.672Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T13:33:34.771Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T13:33:34.772Z] [Loader] Initial log analysis completed.
[2025-04-25T13:33:34.772Z] [Loader] All loaders completed successfully.
[2025-04-25T13:33:34.776Z] üöÄ Server (HTTP + Socket.IO) listening on port 3001
[2025-04-25T13:33:34.776Z] üîó Access the server at: http://localhost:3001
[2025-04-25T13:33:34.776Z] üåê Allowed CORS origins: http://localhost:8386,  http://confhub.ddns.net
[2025-04-25T13:33:34.777Z] [Server Start] Server listening on port 3001. Access at http://localhost:3001
[2025-04-25T13:46:30.660Z] [Socket Auth MW] Attempting auth for socket zitSqxXQb7zYzhDyAAAC. Token provided: false
[2025-04-25T13:46:30.660Z] [Socket Auth MW] No token provided for socket zitSqxXQb7zYzhDyAAAC. Treating as anonymous.
[2025-04-25T13:46:30.663Z] [Socket.IO zitSqxXQb7zYzhDyAAAC] Client connected. Token present: false
[2025-04-25T13:46:30.663Z] [Socket.IO zitSqxXQb7zYzhDyAAAC] Anonymous user connected.
[2025-04-25T13:46:30.665Z] [Socket zitSqxXQb7zYzhDyAAAC] Registering core event handlers. UserID: Anonymous
[2025-04-25T13:46:30.666Z] [Socket zitSqxXQb7zYzhDyAAAC] Core event handlers registered.
[2025-04-25T13:46:30.680Z] [Socket.IO zitSqxXQb7zYzhDyAAAC] Client disconnected. Reason: transport close. UserID: Anonymous. ActiveConvID: N/A
[2025-04-25T13:46:30.700Z] [Socket Auth MW] Attempting auth for socket J8auGE_wi46qjDGRAAAE. Token provided: true
[2025-04-25T13:46:30.708Z] [Socket Auth MW] Token signature validated successfully for socket J8auGE_wi46qjDGRAAAE.
[2025-04-25T13:46:30.712Z] [Socket.IO J8auGE_wi46qjDGRAAAE] Client connected. Token present: true
[2025-04-25T13:46:30.712Z] [Socket.IO J8auGE_wi46qjDGRAAAE] Attempting to fetch user info using token...
[2025-04-25T13:46:30.713Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T13:46:30.921Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:30.922Z] [Socket.IO J8auGE_wi46qjDGRAAAE] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T13:46:30.922Z] [Socket.IO J8auGE_wi46qjDGRAAAE] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T13:46:30.922Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T13:46:31.111Z] [History Service] Found 11 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:31.112Z] [Socket.IO J8auGE_wi46qjDGRAAAE] Sent initial conversation list (11 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T13:46:31.113Z] [Socket.IO J8auGE_wi46qjDGRAAAE] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T13:46:31.113Z] [Socket J8auGE_wi46qjDGRAAAE] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:31.113Z] [Socket J8auGE_wi46qjDGRAAAE] Core event handlers registered.
[2025-04-25T13:46:45.962Z] [Socket J8auGE_wi46qjDGRAAAE] Event 'delete_conversation' received for ID: 6808bff8af360b2a2e0d3f78, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T13:46:45.962Z] [History Service] Attempting to delete conversationId: 6808bff8af360b2a2e0d3f78 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:46.025Z] [History Service] Successfully deleted conversationId: 6808bff8af360b2a2e0d3f78
[2025-04-25T13:46:46.025Z] [Socket J8auGE_wi46qjDGRAAAE] Successfully processed deletion for conversation 6808bff8af360b2a2e0d3f78.
[2025-04-25T13:46:46.027Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T13:46:46.165Z] [History Service] Found 10 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:46.167Z] [Socket J8auGE_wi46qjDGRAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after deletion of 6808bff8af360b2a2e0d3f78.
[2025-04-25T13:46:47.995Z] [Socket J8auGE_wi46qjDGRAAAE] Event 'delete_conversation' received for ID: 680895650497292069e640a6, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T13:46:47.996Z] [History Service] Attempting to delete conversationId: 680895650497292069e640a6 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:48.045Z] [History Service] Successfully deleted conversationId: 680895650497292069e640a6
[2025-04-25T13:46:48.046Z] [Socket J8auGE_wi46qjDGRAAAE] Successfully processed deletion for conversation 680895650497292069e640a6.
[2025-04-25T13:46:48.046Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T13:46:48.182Z] [History Service] Found 9 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:48.183Z] [Socket J8auGE_wi46qjDGRAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after deletion of 680895650497292069e640a6.
[2025-04-25T13:46:50.733Z] [Socket J8auGE_wi46qjDGRAAAE] Event 'delete_conversation' received for ID: 68084e07a42b3899efcb6608, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T13:46:50.733Z] [History Service] Attempting to delete conversationId: 68084e07a42b3899efcb6608 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:50.781Z] [History Service] Successfully deleted conversationId: 68084e07a42b3899efcb6608
[2025-04-25T13:46:50.781Z] [Socket J8auGE_wi46qjDGRAAAE] Successfully processed deletion for conversation 68084e07a42b3899efcb6608.
[2025-04-25T13:46:50.782Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T13:46:50.922Z] [History Service] Found 8 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:50.923Z] [Socket J8auGE_wi46qjDGRAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after deletion of 68084e07a42b3899efcb6608.
[2025-04-25T13:46:53.089Z] [Socket J8auGE_wi46qjDGRAAAE] Event 'delete_conversation' received for ID: 6808c37faf360b2a2e0d3f99, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T13:46:53.090Z] [History Service] Attempting to delete conversationId: 6808c37faf360b2a2e0d3f99 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:53.138Z] [History Service] Successfully deleted conversationId: 6808c37faf360b2a2e0d3f99
[2025-04-25T13:46:53.139Z] [Socket J8auGE_wi46qjDGRAAAE] Successfully processed deletion for conversation 6808c37faf360b2a2e0d3f99.
[2025-04-25T13:46:53.139Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T13:46:53.281Z] [History Service] Found 7 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:53.282Z] [Socket J8auGE_wi46qjDGRAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after deletion of 6808c37faf360b2a2e0d3f99.
[2025-04-25T13:46:55.171Z] [Socket J8auGE_wi46qjDGRAAAE] Event 'delete_conversation' received for ID: 6808c6b8af360b2a2e0d3fb2, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T13:46:55.171Z] [History Service] Attempting to delete conversationId: 6808c6b8af360b2a2e0d3fb2 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:55.219Z] [History Service] Successfully deleted conversationId: 6808c6b8af360b2a2e0d3fb2
[2025-04-25T13:46:55.219Z] [Socket J8auGE_wi46qjDGRAAAE] Successfully processed deletion for conversation 6808c6b8af360b2a2e0d3fb2.
[2025-04-25T13:46:55.220Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T13:46:55.307Z] [History Service] Found 6 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:55.308Z] [Socket J8auGE_wi46qjDGRAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after deletion of 6808c6b8af360b2a2e0d3fb2.
[2025-04-25T13:46:59.633Z] [Socket J8auGE_wi46qjDGRAAAE] Event 'delete_conversation' received for ID: 680b0a7a267cbec76631b556, User: c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T13:46:59.633Z] [History Service] Attempting to delete conversationId: 680b0a7a267cbec76631b556 for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:59.694Z] [History Service] Successfully deleted conversationId: 680b0a7a267cbec76631b556
[2025-04-25T13:46:59.694Z] [Socket J8auGE_wi46qjDGRAAAE] Successfully processed deletion for conversation 680b0a7a267cbec76631b556.
[2025-04-25T13:46:59.695Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T13:46:59.788Z] [History Service] Found 5 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T13:46:59.789Z] [Socket J8auGE_wi46qjDGRAAAE] Emitted updated conversation list to user c0d9d488-3fee-4dda-98f3-5df278ed0e82 after deletion of 680b0a7a267cbec76631b556.
[2025-04-25T14:30:00.677Z] [Cron] Running scheduled log analysis...
[2025-04-25T14:30:00.679Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T14:30:00.808Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T14:30:00.811Z] [Cron] Log analysis finished and results broadcasted.
[2025-04-25T14:36:38.558Z] [Socket.IO J8auGE_wi46qjDGRAAAE] Client disconnected. Reason: transport close. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82. ActiveConvID: N/A
[2025-04-25T14:36:45.462Z] [Socket Auth MW] Attempting auth for socket PK15VMfhGpclq3P8AAAI. Token provided: true
[2025-04-25T14:36:45.471Z] [Socket Auth MW] Token signature validated successfully for socket PK15VMfhGpclq3P8AAAI.
[2025-04-25T14:36:45.471Z] [Socket.IO PK15VMfhGpclq3P8AAAI] Client connected. Token present: true
[2025-04-25T14:36:45.472Z] [Socket.IO PK15VMfhGpclq3P8AAAI] Attempting to fetch user info using token...
[2025-04-25T14:36:45.472Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T14:36:45.655Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T14:36:45.656Z] [Socket.IO PK15VMfhGpclq3P8AAAI] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T14:36:45.656Z] [Socket.IO PK15VMfhGpclq3P8AAAI] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T14:36:45.656Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T14:36:45.750Z] [History Service] Found 5 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T14:36:45.751Z] [Socket.IO PK15VMfhGpclq3P8AAAI] Sent initial conversation list (5 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T14:36:45.751Z] [Socket.IO PK15VMfhGpclq3P8AAAI] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T14:36:45.752Z] [Socket PK15VMfhGpclq3P8AAAI] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T14:36:45.752Z] [Socket PK15VMfhGpclq3P8AAAI] Core event handlers registered.
[2025-04-25T14:37:34.537Z] [Socket.IO PK15VMfhGpclq3P8AAAI] Client disconnected. Reason: transport close. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82. ActiveConvID: N/A
[2025-04-25T14:37:42.439Z] [Socket Auth MW] Attempting auth for socket hCSS3vlXwW14K9DOAAAM. Token provided: true
[2025-04-25T14:37:42.442Z] [Socket Auth MW] Token signature validated successfully for socket hCSS3vlXwW14K9DOAAAM.
[2025-04-25T14:37:42.443Z] [Socket.IO hCSS3vlXwW14K9DOAAAM] Client connected. Token present: true
[2025-04-25T14:37:42.443Z] [Socket.IO hCSS3vlXwW14K9DOAAAM] Attempting to fetch user info using token...
[2025-04-25T14:37:42.443Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T14:37:42.529Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T14:37:42.529Z] [Socket.IO hCSS3vlXwW14K9DOAAAM] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T14:37:42.529Z] [Socket.IO hCSS3vlXwW14K9DOAAAM] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T14:37:42.530Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T14:37:42.618Z] [History Service] Found 5 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T14:37:42.619Z] [Socket.IO hCSS3vlXwW14K9DOAAAM] Sent initial conversation list (5 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T14:37:42.619Z] [Socket.IO hCSS3vlXwW14K9DOAAAM] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T14:37:42.620Z] [Socket hCSS3vlXwW14K9DOAAAM] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T14:37:42.620Z] [Socket hCSS3vlXwW14K9DOAAAM] Core event handlers registered.
[2025-04-25T15:13:05.972Z] [Socket.IO hCSS3vlXwW14K9DOAAAM] Client disconnected. Reason: transport close. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82. ActiveConvID: N/A
[2025-04-25T15:13:08.554Z] [Socket Auth MW] Attempting auth for socket qsNwhq5yA1jpBVMkAAAQ. Token provided: true
[2025-04-25T15:13:08.557Z] [Socket Auth MW] Token validation failed for socket qsNwhq5yA1jpBVMkAAAQ. Reason: jwt expired
[2025-04-25T15:16:44.063Z] [Socket Auth MW] Attempting auth for socket bb9o8rShiQJpVwQCAAAT. Token provided: false
[2025-04-25T15:16:44.064Z] [Socket Auth MW] No token provided for socket bb9o8rShiQJpVwQCAAAT. Treating as anonymous.
[2025-04-25T15:16:44.065Z] [Socket.IO bb9o8rShiQJpVwQCAAAT] Client connected. Token present: false
[2025-04-25T15:16:44.065Z] [Socket.IO bb9o8rShiQJpVwQCAAAT] Anonymous user connected.
[2025-04-25T15:16:44.066Z] [Socket bb9o8rShiQJpVwQCAAAT] Registering core event handlers. UserID: Anonymous
[2025-04-25T15:16:44.066Z] [Socket bb9o8rShiQJpVwQCAAAT] Core event handlers registered.
[2025-04-25T15:16:44.080Z] [Socket.IO bb9o8rShiQJpVwQCAAAT] Client disconnected. Reason: transport close. UserID: Anonymous. ActiveConvID: N/A
[2025-04-25T15:16:44.091Z] [Socket Auth MW] Attempting auth for socket nnhBheWvIaykN4oTAAAV. Token provided: true
[2025-04-25T15:16:44.094Z] [Socket Auth MW] Token signature validated successfully for socket nnhBheWvIaykN4oTAAAV.
[2025-04-25T15:16:44.094Z] [Socket.IO nnhBheWvIaykN4oTAAAV] Client connected. Token present: true
[2025-04-25T15:16:44.095Z] [Socket.IO nnhBheWvIaykN4oTAAAV] Attempting to fetch user info using token...
[2025-04-25T15:16:44.095Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T15:16:44.357Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T15:16:44.358Z] [Socket.IO nnhBheWvIaykN4oTAAAV] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T15:16:44.358Z] [Socket.IO nnhBheWvIaykN4oTAAAV] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T15:16:44.358Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T15:16:44.455Z] [History Service] Found 5 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T15:16:44.456Z] [Socket.IO nnhBheWvIaykN4oTAAAV] Sent initial conversation list (5 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T15:16:44.457Z] [Socket.IO nnhBheWvIaykN4oTAAAV] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T15:16:44.457Z] [Socket nnhBheWvIaykN4oTAAAV] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T15:16:44.458Z] [Socket nnhBheWvIaykN4oTAAAV] Core event handlers registered.
[2025-04-25T15:20:42.022Z] [Socket.IO nnhBheWvIaykN4oTAAAV] Client disconnected. Reason: transport close. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82. ActiveConvID: N/A
[2025-04-25T15:20:45.049Z] [Socket Auth MW] Attempting auth for socket uK029sxEIKwJgGbnAAAZ. Token provided: true
[2025-04-25T15:20:45.052Z] [Socket Auth MW] Token signature validated successfully for socket uK029sxEIKwJgGbnAAAZ.
[2025-04-25T15:20:45.052Z] [Socket.IO uK029sxEIKwJgGbnAAAZ] Client connected. Token present: true
[2025-04-25T15:20:45.052Z] [Socket.IO uK029sxEIKwJgGbnAAAZ] Attempting to fetch user info using token...
[2025-04-25T15:20:45.052Z] [API Client] Fetching user info from: http://confhub.engineer/api/v1/user/me
[2025-04-25T15:20:45.162Z] [API Client] Successfully fetched user info for ID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T15:20:45.163Z] [Socket.IO uK029sxEIKwJgGbnAAAZ] User info fetched successfully. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82, Email: loicute5fps@gmail.com, Role: user
[2025-04-25T15:20:45.163Z] [Socket.IO uK029sxEIKwJgGbnAAAZ] Fetching initial conversation list for user c0d9d488-3fee-4dda-98f3-5df278ed0e82...
[2025-04-25T15:20:45.163Z] [History Service] Getting conversation list for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82, limit: 20
[2025-04-25T15:20:45.250Z] [History Service] Found 5 conversations for userId: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T15:20:45.251Z] [Socket.IO uK029sxEIKwJgGbnAAAZ] Sent initial conversation list (5 items) to user c0d9d488-3fee-4dda-98f3-5df278ed0e82.
[2025-04-25T15:20:45.251Z] [Socket.IO uK029sxEIKwJgGbnAAAZ] Authenticated user c0d9d488-3fee-4dda-98f3-5df278ed0e82 session ready.
[2025-04-25T15:20:45.252Z] [Socket uK029sxEIKwJgGbnAAAZ] Registering core event handlers. UserID: c0d9d488-3fee-4dda-98f3-5df278ed0e82
[2025-04-25T15:20:45.252Z] [Socket uK029sxEIKwJgGbnAAAZ] Core event handlers registered.
[2025-04-25T15:30:00.253Z] [Cron] Running scheduled log analysis...
[2025-04-25T15:30:00.255Z] [LogAnalysis Service] Starting analysis. Filters: Start=undefined, End=undefined
[2025-04-25T15:30:00.393Z] [LogAnalysis Service] Analysis completed successfully. Requests: 0, Errors: 0
[2025-04-25T15:30:00.394Z] [Cron] Log analysis finished and results broadcasted.
